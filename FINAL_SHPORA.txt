

// === FILE: \app\src\androidTest\java\com\aiden3630\chempionat\ExampleInstrumentedTest.kt ===

package com.aiden3630.chempionat

import androidx.test.platform.app.InstrumentationRegistry
import androidx.test.ext.junit.runners.AndroidJUnit4

import org.junit.Test
import org.junit.runner.RunWith

import org.junit.Assert.*

/**
 * Instrumented test, which will execute on an Android device.
 *
 * See [testing documentation](http://d.android.com/tools/testing).
 */
@RunWith(AndroidJUnit4::class)
class ExampleInstrumentedTest {
    @Test
    fun useAppContext() {
        // Context of the app under test.
        val appContext = InstrumentationRegistry.getInstrumentation().targetContext
        assertEquals("com.aiden3630.chempionat", appContext.packageName)
    }
}


// === FILE: \app\src\main\java\com\aiden3630\chempionat\App.kt ===

package com.aiden3630.chempionat

import android.app.Application
import dagger.hilt.android.HiltAndroidApp

@HiltAndroidApp
class App : Application()


// === FILE: \app\src\main\java\com\aiden3630\chempionat\MainActivity.kt ===

package com.aiden3630.chempionat

import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.activity.enableEdgeToEdge
import androidx.navigation.compose.NavHost
import androidx.navigation.compose.composable
import androidx.navigation.compose.rememberNavController
import com.aiden3630.presentation.Route
import com.aiden3630.presentation.main.CreateProjectScreen
import com.aiden3630.presentation.auth.SignInScreen
import com.aiden3630.presentation.splash.SplashScreen
import com.aiden3630.presentation.auth.CreatePasswordScreen
import com.aiden3630.presentation.auth.CreatePinScreen
import com.aiden3630.presentation.auth.SignInPinScreen
import com.aiden3630.presentation.auth.SignUpScreen
import com.aiden3630.presentation.main.CartScreen
import com.aiden3630.presentation.main.MainScreen
import com.aiden3630.presentation.main.ProjectsScreen
import dagger.hilt.android.AndroidEntryPoint
import androidx.navigation.NavType
import androidx.navigation.navArgument
import android.Manifest
import android.os.Build
import androidx.activity.result.contract.ActivityResultContracts


@AndroidEntryPoint
class MainActivity : ComponentActivity() {
    private val requestPermissionLauncher = registerForActivityResult(
        ActivityResultContracts.RequestPermission()
    ) { isGranted: Boolean ->

    }
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.TIRAMISU) {
            requestPermissionLauncher.launch(Manifest.permission.POST_NOTIFICATIONS)
        }

        enableEdgeToEdge()
        setContent {
            val navController = rememberNavController()

            NavHost(
                navController = navController,
                startDestination = Route.SPLASH
            ) {

                composable(Route.SPLASH) {
                    SplashScreen(navController = navController)
                }

                composable(Route.SIGN_IN) {
                    SignInScreen(
                        onSignInClick = {
                            navController.navigate(Route.HOME) {
                                popUpTo(Route.SIGN_IN) { inclusive = true }
                            }
                        },
                        onSignUpClick = {
                            navController.navigate(Route.SIGN_UP)
                        }
                    )
                }

                composable(Route.SIGN_UP) {
                    SignUpScreen(
                        onNextClick = {
                            navController.navigate(Route.CREATE_PASSWORD)
                        },
                        onBackClick = {
                            navController.popBackStack()
                        }
                    )
                }

                composable(Route.CREATE_PASSWORD) {
                    CreatePasswordScreen(
                        onSaveClick = {
                            navController.navigate(Route.CREATE_PIN)
                        }
                    )
                }

                composable(Route.CREATE_PIN) {
                    CreatePinScreen(
                        onPinCreated = {
                            navController.navigate(Route.HOME) {
                                // РћС‡РёС‰Р°РµРј РІСЃС‘ РґРѕ РІС…РѕРґР°, С‡С‚РѕР±С‹ РЅРµР»СЊР·СЏ Р±С‹Р»Рѕ РІРµСЂРЅСѓС‚СЊСЃСЏ РЅР°Р·Р°Рґ
                                popUpTo(Route.SIGN_IN) { inclusive = true }
                            }
                        }
                    )
                }
                composable(Route.SIGN_IN_PIN) {
                    SignInPinScreen(
                        onAuthSuccess = {
                            // РџРёРЅ РІРµСЂРЅС‹Р№ = РџСѓСЃРєР°РµРј РІ РїСЂРёР»РѕР¶РµРЅРёРµ
                            navController.navigate(Route.HOME) {
                                popUpTo(Route.SIGN_IN_PIN) { inclusive = true }
                            }
                        }
                    )
                }

                composable(Route.HOME) {
                    MainScreen(
                        onNavigateToCart = {
                            navController.navigate(Route.CART)
                        },
                        onNavigateToCreateProject = {
                            navController.navigate(Route.CREATE_PROJECT)
                        },
                        // Р›РѕРіРёРєР° РІС‹С…РѕРґР°
                        onLogout = {
                            navController.navigate(Route.SIGN_IN) {
                                // РЈРґР°Р»СЏРµРј РІСЃС‘ РёР· СЃС‚РµРєР°, С‡С‚РѕР±С‹ РЅРµР»СЊР·СЏ Р±С‹Р»Рѕ РІРµСЂРЅСѓС‚СЊСЃСЏ РЅР°Р·Р°Рґ
                                popUpTo(0) { inclusive = true }
                            }
                        },
                        onNavigateToProjectDetails = { projectId ->
                            navController.navigate("${Route.PROJECT_DETAILS}/$projectId")
                        }
                    )

                }
                composable(Route.CART) {
                    com.aiden3630.presentation.main.CartScreen(
                        onBackClick = { navController.popBackStack() },
                        // Р•СЃР»Рё Р·Р°РєР°Р· РѕС„РѕСЂРјР»РµРЅ = РёРґРµРј РЅР° Р“Р›РђР’РќРЈР®
                        onGoHome = {
                            navController.navigate(Route.HOME) {
                                // РћС‡РёС‰Р°РµРј СЃС‚РµРє, С‡С‚РѕР±С‹ РїРѕ РєРЅРѕРїРєРµ "РќР°Р·Р°Рґ" РЅРµ РІРµСЂРЅСѓС‚СЊСЃСЏ РІ РєРѕСЂР·РёРЅСѓ
                                popUpTo(Route.HOME) { inclusive = true }
                            }
                        }
                    )
                }
                composable(Route.PROJECTS_TAB) {
                    ProjectsScreen(
                        onAddProjectClick = {
                            navController.navigate(Route.CREATE_PROJECT)
                        }
                    )
                }

                // Р­РєСЂР°РЅ РЎРѕР·РґР°РЅРёСЏ РџСЂРѕРµРєС‚Р°
                composable(Route.CREATE_PROJECT) {
                    CreateProjectScreen(
                        onBackClick = {
                            navController.popBackStack()
                        }
                    )
                }
                composable(
                    route = Route.PROJECT_DETAILS,
                    arguments = listOf(androidx.navigation.navArgument("projectId") {
                        type = androidx.navigation.NavType.StringType
                    })
                ) { backStackEntry ->
                    val projectId = backStackEntry.arguments?.getString("projectId") ?: ""
                    com.aiden3630.presentation.main.ProjectDetailsScreen(
                        projectId = projectId,
                        onBackClick = { navController.popBackStack() }
                    )
                }
                composable(
                    route = "${Route.PROJECT_DETAILS}/{projectId}",
                    arguments = listOf(navArgument("projectId") { type = NavType.StringType })
                ) { backStackEntry ->
                    // Р”РѕСЃС‚Р°РµРј ID РёР· Р°СЂРіСѓРјРµРЅС‚РѕРІ
                    val projectId = backStackEntry.arguments?.getString("projectId") ?: ""

                    com.aiden3630.presentation.main.ProjectDetailsScreen(
                        projectId = projectId,
                        onBackClick = { navController.popBackStack() }
                    )
                }

            }
        }
    }
}


// === FILE: \app\src\test\java\com\aiden3630\chempionat\ExampleUnitTest.kt ===

package com.aiden3630.chempionat

import org.junit.Test

import org.junit.Assert.*

/**
 * Example local unit test, which will execute on the development machine (host).
 *
 * See [testing documentation](http://d.android.com/tools/testing).
 */
class ExampleUnitTest {
    @Test
    fun addition_isCorrect() {
        assertEquals(4, 2 + 2)
    }
}


// === FILE: \app\build.gradle.kts ===

plugins {
    alias(libs.plugins.android.application)
    alias(libs.plugins.kotlin.android)
    alias(libs.plugins.compose.compiler) // Р’РєР»СЋС‡Р°РµРј РїР»Р°РіРёРЅ Compose
    alias(libs.plugins.hilt.android) // Hilt (РїСЂРёРіРѕРґРёС‚СЃСЏ РїРѕР·Р¶Рµ)
    alias(libs.plugins.google.devtools.ksp)
}

android {
    namespace = "com.aiden3630.chempionat"
    compileSdk = 35

    defaultConfig {
        applicationId = "com.aiden3630.chempionat"
        minSdk = 33 // РџРѕ Р·Р°РґР°РЅРёСЋ
        targetSdk = 34
        versionCode = 1
        versionName = "1.0"

        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
    }

    buildTypes {
        release {
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
    kotlinOptions {
        jvmTarget = "11"
    }
    // Р’РєР»СЋС‡Р°РµРј Compose
    buildFeatures {
        compose = true
    }
}

dependencies {
    implementation(project(":presentation"))
    implementation(project(":data"))
    implementation(project(":domain"))

    implementation(libs.androidx.core.ktx)
    implementation(libs.androidx.lifecycle.runtime.ktx)
    implementation(libs.androidx.activity.compose)
    implementation(platform(libs.androidx.compose.bom))
    implementation(libs.androidx.ui)
    implementation(libs.androidx.ui.graphics)
    implementation(libs.androidx.ui.tooling.preview)
    implementation(libs.androidx.material3)
    implementation(libs.androidx.navigation.compose)


    // Hilt
    implementation(libs.hilt.android)
    ksp(libs.hilt.compiler)

    debugImplementation(libs.androidx.ui.tooling)
}


// === FILE: \data\src\androidTest\java\com\aiden3630\data\ExampleInstrumentedTest.kt ===

package com.aiden3630.data

import androidx.test.platform.app.InstrumentationRegistry
import androidx.test.ext.junit.runners.AndroidJUnit4

import org.junit.Test
import org.junit.runner.RunWith

import org.junit.Assert.*

/**
 * Instrumented test, which will execute on an Android device.
 *
 * See [testing documentation](http://d.android.com/tools/testing).
 */
@RunWith(AndroidJUnit4::class)
class ExampleInstrumentedTest {
    @Test
    fun useAppContext() {
        // Context of the app under test.
        val appContext = InstrumentationRegistry.getInstrumentation().targetContext
        assertEquals("com.aiden3630.data.test", appContext.packageName)
    }
}


// === FILE: \data\src\main\java\com\aiden3630\data\di\AuthModule.kt ===

package com.aiden3630.data.di

import android.content.Context
import com.aiden3630.data.manager.JsonDbManager
import com.aiden3630.data.manager.TokenManager
import com.aiden3630.data.network.AuthApi
import com.aiden3630.data.repository.AuthRepositoryImpl
import com.aiden3630.data.repository.ProjectRepositoryImpl
import com.aiden3630.data.repository.ShopRepositoryImpl
import com.aiden3630.domain.repository.AuthRepository
import com.aiden3630.domain.repository.ProjectRepository
import com.aiden3630.domain.repository.ShopRepository
import dagger.Module
import dagger.Provides
import dagger.hilt.InstallIn
import dagger.hilt.android.qualifiers.ApplicationContext
import dagger.hilt.components.SingletonComponent
import retrofit2.Retrofit
import javax.inject.Singleton

@Module
@InstallIn(SingletonComponent::class)
object AuthModule {

    @Provides
    @Singleton
    fun provideAuthApi(retrofit: Retrofit): AuthApi {
        return retrofit.create(AuthApi::class.java)
    }

    @Provides
    @Singleton
    fun provideAuthRepository(
        api: AuthApi,
        tokenManager: TokenManager,
        jsonDbManager: JsonDbManager
    ): AuthRepository {
        return AuthRepositoryImpl(api, tokenManager, jsonDbManager)
    }

    @Provides
    @Singleton
    fun provideShopRepository(
        @ApplicationContext context: Context
    ): ShopRepository {
        return ShopRepositoryImpl(context)
    }
}


// === FILE: \data\src\main\java\com\aiden3630\data\di\NetworkModule.kt ===

package com.aiden3630.data.di

import dagger.Module
import dagger.Provides
import dagger.hilt.InstallIn
import dagger.hilt.components.SingletonComponent
import kotlinx.serialization.json.Json
import okhttp3.MediaType.Companion.toMediaType
import okhttp3.OkHttpClient
import okhttp3.logging.HttpLoggingInterceptor
import retrofit2.Retrofit
import retrofit2.converter.kotlinx.serialization.asConverterFactory
import javax.inject.Singleton

@Module
@InstallIn(SingletonComponent::class)
object NetworkModule {

    // РЎСЃС‹Р»РєР° РЅР° СЃРµСЂРІРµСЂ (РїРѕРєР° Р·Р°РіР»СѓС€РєР°, РїРѕС‚РѕРј РїРѕРјРµРЅСЏРµРј РЅР° СЂРµР°Р»СЊРЅС‹Р№ IP)
    private const val BASE_URL = "https://api.matule.ru/api/"

    @Provides
    @Singleton
    fun provideJson(): Json {
        return Json {
            ignoreUnknownKeys = true // РРіРЅРѕСЂРёСЂРѕРІР°С‚СЊ Р»РёС€РЅРёРµ РїРѕР»СЏ РІ РѕС‚РІРµС‚Рµ СЃРµСЂРІРµСЂР°
            isLenient = true
        }
    }

    @Provides
    @Singleton
    fun provideOkHttpClient(): OkHttpClient {
        return OkHttpClient.Builder()
            .addInterceptor(
                HttpLoggingInterceptor().apply {
                    level = HttpLoggingInterceptor.Level.BODY // Р›РѕРіРёСЂРѕРІР°С‚СЊ РІСЃС‘ (РґР»СЏ РѕС‚Р»Р°РґРєРё)
                }
            )
            .build()
    }

    @Provides
    @Singleton
    fun provideRetrofit(okHttpClient: OkHttpClient, json: Json): Retrofit {
        return Retrofit.Builder()
            .baseUrl(BASE_URL)
            .client(okHttpClient)
            .addConverterFactory(json.asConverterFactory("application/json".toMediaType()))
            .build()
    }
}


// === FILE: \data\src\main\java\com\aiden3630\data\di\ProjectModule.kt ===

package com.aiden3630.data.di

import com.aiden3630.data.manager.TokenManager
import com.aiden3630.data.repository.ProjectRepositoryImpl
import com.aiden3630.domain.repository.ProjectRepository
import dagger.Module
import dagger.Provides
import dagger.hilt.InstallIn
import dagger.hilt.components.SingletonComponent
import javax.inject.Singleton

@Module
@InstallIn(SingletonComponent::class)
object ProjectModule {
    @Provides
    @Singleton
    fun provideProjectRepository(tokenManager: TokenManager): ProjectRepository {
        return ProjectRepositoryImpl(tokenManager)
    }
}


// === FILE: \data\src\main\java\com\aiden3630\data\manager\CartManager.kt ===

package com.aiden3630.data.manager

import com.aiden3630.domain.model.CartItemModel
import com.aiden3630.domain.model.Product
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.flow.map
import javax.inject.Inject
import javax.inject.Singleton

@Singleton
class CartManager @Inject constructor() {

    // РЎРїРёСЃРѕРє С‚РѕРІР°СЂРѕРІ
    private val _cartItems = MutableStateFlow<List<CartItemModel>>(emptyList())
    val cartItems = _cartItems.asStateFlow()

    // РЎСѓРјРјР°
    val totalPrice = _cartItems.map { list ->
        list.sumOf { it.product.price * it.quantity }
    }

    // Р”РѕР±Р°РІРёС‚СЊ С‚РѕРІР°СЂ (РёР»Рё СѓРІРµР»РёС‡РёС‚СЊ РєРѕР»РёС‡РµСЃС‚РІРѕ)
    fun addToCart(product: Product) {
        val currentList = _cartItems.value

        // РџСЂРѕРІРµСЂСЏРµРј, РµСЃС‚СЊ Р»Рё С‚РѕРІР°СЂ
        val existingItem = currentList.find { it.product.id == product.id }

        val newList = if (existingItem != null) {
            // Р•СЃР»Рё С‚РѕРІР°СЂ РµСЃС‚СЊ = РЎРѕР·РґР°РµРј РќРћР’Р«Р™ СЃРїРёСЃРѕРє, РіРґРµ Сѓ РЅСѓР¶РЅРѕРіРѕ С‚РѕРІР°СЂР° РѕР±РЅРѕРІР»РµРЅРѕ РєРѕР»РёС‡РµСЃС‚РІРѕ
            currentList.map { item ->
                if (item.product.id == product.id) {
                    item.copy(quantity = item.quantity + 1)
                } else {
                    item
                }
            }
        } else {
            // Р•СЃР»Рё С‚РѕРІР°СЂР° РЅРµС‚ = Р”РѕР±Р°РІР»СЏРµРј РЅРѕРІС‹Р№ РІ РєРѕРЅРµС†
            currentList + CartItemModel(product, 1)
        }

        _cartItems.value = newList
    }

    // РЈРјРµРЅСЊС€РёС‚СЊ РєРѕР»РёС‡РµСЃС‚РІРѕ
    fun decreaseQuantity(product: Product) {
        val currentList = _cartItems.value
        val item = currentList.find { it.product.id == product.id } ?: return

        if (item.quantity > 1) {
            // РЈРјРµРЅСЊС€Р°РµРј РєРѕРїРёСЂРѕРІР°РЅРёРµРј
            val newList = currentList.map { cartItem ->
                if (cartItem.product.id == product.id) {
                    cartItem.copy(quantity = cartItem.quantity - 1)
                } else {
                    cartItem
                }
            }
            _cartItems.value = newList
        } else {
            // Р•СЃР»Рё 1 С€С‚ = СѓРґР°Р»СЏРµРј
            removeFromCart(product)
        }
    }

    // РЈРґР°Р»РёС‚СЊ С‚РѕРІР°СЂ
    fun removeFromCart(product: Product) {
        val currentList = _cartItems.value
        // filter СЃРѕР·РґР°РµС‚ РЅРѕРІС‹Р№ СЃРїРёСЃРѕРє Р±РµР· СѓРґР°Р»РµРЅРЅРѕРіРѕ СЌР»РµРјРµРЅС‚Р°
        val newList = currentList.filter { it.product.id != product.id }
        _cartItems.value = newList
    }

    // РџСЂРѕРІРµСЂРєР° РЅР°Р»РёС‡РёСЏ
    fun isInCart(productId: Int): Boolean {
        return _cartItems.value.any { it.product.id == productId }
    }
    fun clearCart() {
        _cartItems.value = emptyList()
    }
}


// === FILE: \data\src\main\java\com\aiden3630\data\manager\JsonDbManager.kt ===

package com.aiden3630.data.manager

import android.content.Context
import com.aiden3630.data.model.UserDto
import dagger.hilt.android.qualifiers.ApplicationContext
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.sync.Mutex
import kotlinx.coroutines.sync.withLock
import kotlinx.coroutines.withContext
import kotlinx.serialization.encodeToString
import kotlinx.serialization.json.Json
import java.io.File
import javax.inject.Inject
import javax.inject.Singleton

@Singleton
class JsonDbManager @Inject constructor(
    @ApplicationContext private val context: Context
) {
    // РРјСЏ РЅР°С€РµРіРѕ С„Р°Р№Р»Р°
    private val fileName = "matule_users_db.json"

    // JSON РєРѕРЅС„РёРіСѓСЂР°С†РёСЏ
    private val json = Json {
        ignoreUnknownKeys = true
        prettyPrint = true
        encodeDefaults = true
    }

    // РњСЊСЋС‚РµРєСЃ, С‡С‚РѕР±С‹ РЅРµ Р±С‹Р»Рѕ РѕС€РёР±РѕРє, РµСЃР»Рё РґРІР° РїРѕС‚РѕРєР° РїРёС€СѓС‚ РѕРґРЅРѕРІСЂРµРјРµРЅРЅРѕ
    private val mutex = Mutex()

    // РџРѕР»СѓС‡РёС‚СЊ С„Р°Р№Р» (РёР»Рё СЃРѕР·РґР°С‚СЊ, РµСЃР»Рё РЅРµС‚)
    private fun getFile(): File {
        val file = File(context.filesDir, fileName)
        if (!file.exists()) {
            file.createNewFile()
            file.writeText("[]") // Р—Р°РїРёСЃС‹РІР°РµРј РїСѓСЃС‚РѕР№ РјР°СЃСЃРёРІ
        }
        return file
    }

    // Р§РёС‚Р°РµРј РїРѕР»СЊР·РѕРІР°С‚РµР»РµР№
    suspend fun getAllUsers(): List<UserDto> = withContext(Dispatchers.IO) {
        mutex.withLock {
            try {
                val file = getFile()
                val content = file.readText()
                if (content.isBlank()) return@withLock emptyList()

                json.decodeFromString<List<UserDto>>(content)
            } catch (e: Exception) {
                e.printStackTrace()
                emptyList()
            }
        }
    }

    // РЎРѕС…СЂР°РЅСЏРµРј СЃРїРёСЃРѕРє
    suspend fun saveAllUsers(users: List<UserDto>) = withContext(Dispatchers.IO) {
        mutex.withLock {
            try {
                val file = getFile()
                val jsonString = json.encodeToString(users)
                file.writeText(jsonString)
            } catch (e: Exception) {
                e.printStackTrace()
            }
        }
    }

    // Р”РѕР±Р°РІРёС‚СЊ РѕРґРЅРѕРіРѕ
    suspend fun addUser(user: UserDto) {
        val currentList = getAllUsers().toMutableList()
        currentList.add(user)
        saveAllUsers(currentList)
    }
}


// === FILE: \data\src\main\java\com\aiden3630\data\manager\TokenManager.kt ===

package com.aiden3630.data.manager

import android.content.Context
import androidx.datastore.preferences.core.edit
import androidx.datastore.preferences.core.stringPreferencesKey
import androidx.datastore.preferences.preferencesDataStore
import dagger.hilt.android.qualifiers.ApplicationContext
import kotlinx.coroutines.flow.Flow
import kotlinx.coroutines.flow.map
import javax.inject.Inject
import javax.inject.Singleton
import androidx.datastore.preferences.core.booleanPreferencesKey

// РЎРѕР·РґР°РµРј С…СЂР°РЅРёР»РёС‰Рµ
private val Context.dataStore by preferencesDataStore("auth_prefs")

@Singleton
class TokenManager @Inject constructor(
    @ApplicationContext private val context: Context
) {

    companion object {
        private val TOKEN_KEY = stringPreferencesKey("jwt_token")
        private val EMAIL_KEY = stringPreferencesKey("user_email")
        private val PASSWORD_KEY = stringPreferencesKey("user_password")

        // Р”Р°РЅРЅС‹Рµ РїСЂРѕС„РёР»СЏ
        private val NAME_KEY = stringPreferencesKey("user_name")
        private val SURNAME_KEY = stringPreferencesKey("user_surname")
        private val AVATAR_KEY = stringPreferencesKey("user_avatar")

        // Р‘Р°Р·Р° РІСЃРµС… РїРѕР»СЊР·РѕРІР°С‚РµР»РµР№ (JSON)
        private val ALL_USERS_DB_KEY = stringPreferencesKey("all_users_db_json")
        private val PROJECTS_DB_KEY = stringPreferencesKey("projects_db_json")

        private val NOTIFICATIONS_KEY = booleanPreferencesKey("notifications_enabled")

        private val USER_PIN_KEY = stringPreferencesKey("user_pin_code")
    }

    // Р‘Р°Р·Р° РґР°РЅРЅС‹С… РїРѕР»СЊР·РѕРІР°С‚РµР»РµР№ (JSON)
    fun getUsersDb(): Flow<String> = context.dataStore.data.map { it[ALL_USERS_DB_KEY] ?: "[]" }

    suspend fun saveUsersDb(json: String) {
        context.dataStore.edit { it[ALL_USERS_DB_KEY] = json }
    }
    fun getProjects(): Flow<String> = context.dataStore.data.map { it[PROJECTS_DB_KEY] ?: "[]" }

    // РЎРѕС…СЂР°РЅРёС‚СЊ СЃРїРёСЃРѕРє РїСЂРѕРµРєС‚РѕРІ
    suspend fun saveProjects(json: String) {
        context.dataStore.edit { it[PROJECTS_DB_KEY] = json }
    }

    // РўРѕРєРµРЅ
    fun getToken(): Flow<String?> = context.dataStore.data.map { it[TOKEN_KEY] }
    suspend fun saveToken(token: String) = context.dataStore.edit { it[TOKEN_KEY] = token }

    // Р”Р°РЅРЅС‹Рµ С‚РµРєСѓС‰РµРіРѕ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
    fun getEmail(): Flow<String> = context.dataStore.data.map { it[EMAIL_KEY] ?: "" }
    fun getPassword(): Flow<String> = context.dataStore.data.map { it[PASSWORD_KEY] ?: "" }
    fun getName(): Flow<String> = context.dataStore.data.map { it[NAME_KEY] ?: "РџРѕР»СЊР·РѕРІР°С‚РµР»СЊ" }
    fun getSurname(): Flow<String> = context.dataStore.data.map { it[SURNAME_KEY] ?: "" }
    fun getNotificationsEnabled(): Flow<Boolean> = context.dataStore.data
        .map { it[NOTIFICATIONS_KEY] ?: true }

    suspend fun saveNotificationsEnabled(enabled: Boolean) {
        context.dataStore.edit { it[NOTIFICATIONS_KEY] = enabled }
    }

    // РЎРѕС…СЂР°РЅРµРЅРёРµ РїРѕС‡С‚С‹ Рё РїР°СЂРѕР»СЏ
    suspend fun saveUserData(email: String, pass: String) {
        context.dataStore.edit { prefs ->
            prefs[EMAIL_KEY] = email
            prefs[PASSWORD_KEY] = pass
        }
    }

    // РЎРѕС…СЂР°РЅРµРЅРёРµ РїСЂРѕС„РёР»СЏ (РїРѕСЃР»Рµ РІС…РѕРґР°)
    suspend fun saveUserInfo(email: String, name: String, surname: String) {
        context.dataStore.edit { prefs ->
            prefs[EMAIL_KEY] = email
            prefs[NAME_KEY] = name
            prefs[SURNAME_KEY] = surname
        }
    }

    suspend fun savePin(pin: String) {
        context.dataStore.edit { it[USER_PIN_KEY] = pin }
    }

    fun getPin(): Flow<String?> = context.dataStore.data.map { it[USER_PIN_KEY] }

    // РћС‡РёСЃС‚РєР° (Р’С‹С…РѕРґ)
    suspend fun clearSession() {
        context.dataStore.edit { prefs ->
            prefs.remove(TOKEN_KEY)
            // prefs.remove(EMAIL_KEY)
            // prefs.remove(PASSWORD_KEY)
            prefs.remove(NAME_KEY)
            prefs.remove(SURNAME_KEY)
            prefs.remove(AVATAR_KEY)
        }
    }

}


// === FILE: \data\src\main\java\com\aiden3630\data\model\AuthModels.kt ===

package com.aiden3630.data.model

import kotlinx.serialization.SerialName
import kotlinx.serialization.Serializable

@Serializable
data class SignInRequest(
    @SerialName("identity") val identity: String,
    @SerialName("password") val password: String
)

@Serializable
data class SignInResponse(
    @SerialName("token") val token: String,
    @SerialName("record") val user: UserDto
)

@Serializable
data class SignUpRequest(
    @SerialName("email") val email: String,
    @SerialName("password") val password: String,
    @SerialName("passwordConfirm") val passwordConfirm: String,
    @SerialName("firstname") val name: String,
    @SerialName("lastname") val surname: String
)

@Serializable
data class UserDto(
    @SerialName("id") val id: String,
    @SerialName("email") val email: String? = null,
    @SerialName("password") val password: String? = null,
    @SerialName("firstname") val name: String,
    @SerialName("lastname") val surname: String,
    @SerialName("avatar") val avatar: String? = null
)


// === FILE: \data\src\main\java\com\aiden3630\data\network\AuthApi.kt ===

package com.aiden3630.data.network

import com.aiden3630.data.model.SignInRequest
import com.aiden3630.data.model.SignInResponse
import com.aiden3630.data.model.SignUpRequest
import com.aiden3630.data.model.UserDto
import retrofit2.http.Body
import retrofit2.http.POST

interface AuthApi {


    @POST("collections/users/auth-with-password")
    suspend fun signIn(@Body request: SignInRequest): SignInResponse

    @POST("collections/users/records")
    suspend fun signUp(@Body request: SignUpRequest): UserDto
}


// === FILE: \data\src\main\java\com\aiden3630\data\repository\AuthRepositoryImpl.kt ===

package com.aiden3630.data.repository

import android.util.Log
import com.aiden3630.data.manager.TokenManager
import com.aiden3630.data.manager.JsonDbManager
import com.aiden3630.data.model.UserDto
import com.aiden3630.data.network.AuthApi
import com.aiden3630.domain.repository.AuthRepository
import kotlinx.coroutines.delay
import kotlinx.coroutines.flow.first
import kotlinx.serialization.encodeToString
import kotlinx.serialization.json.Json
import java.util.UUID
import javax.inject.Inject

class AuthRepositoryImpl @Inject constructor(
    private val api: AuthApi,
    private val tokenManager: TokenManager,
    private val jsonDbManager: JsonDbManager
) : AuthRepository {

    private val jsonParser = Json {
        ignoreUnknownKeys = true
        coerceInputValues = true
    }

    override suspend fun signIn(email: String, password: String) {
        delay(1000) // РРјРёС‚Р°С†РёСЏ СЃРµС‚Рё

        // 1. Р§РёС‚Р°РµРј СЂРµР°Р»СЊРЅС‹Р№ С„Р°Р№Р»
        val usersList = jsonDbManager.getAllUsers()

        // 2. РС‰РµРј РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РїРѕ Email Р РџР°СЂРѕР»Рё
        val foundUser = usersList.find {
            it.email.equals(email, ignoreCase = true) && it.password == password
        }

        if (foundUser != null) {
            val fakeToken = "token_${foundUser.id}"

            // РЎРѕС…СЂР°РЅСЏРµРј СЃРµСЃСЃРёСЋ
            tokenManager.saveToken(fakeToken)
            tokenManager.saveUserInfo(
                email = foundUser.email ?: email,
                name = foundUser.name,
                surname = foundUser.surname
            )
            Log.d("AuthRepo", "Р’РҐРћР” РЈРЎРџР•РЁР•Рќ РёР· С„Р°Р№Р»Р°: ${foundUser.name}")
        } else {
            // РџСЂРѕРІРµСЂСЏРµРј, РјРѕР¶РµС‚ email РµСЃС‚СЊ, РЅРѕ РїР°СЂРѕР»СЊ РЅРµ С‚РѕС‚?
            val emailExists = usersList.any { it.email.equals(email, ignoreCase = true) }
            if (emailExists) {
                throw Exception("РќРµРІРµСЂРЅС‹Р№ РїР°СЂРѕР»СЊ")
            } else {
                throw Exception("РџРѕР»СЊР·РѕРІР°С‚РµР»СЊ РЅРµ РЅР°Р№РґРµРЅ")
            }
        }
    }

    override suspend fun signUp(email: String, password: String, name: String, surname: String) {
        delay(1000)

        // 1. Р§РёС‚Р°РµРј С„Р°Р№Р» РґР»СЏ РїСЂРѕРІРµСЂРєРё РґСѓР±Р»РёРєР°С‚РѕРІ
        val currentUsers = jsonDbManager.getAllUsers()

        if (currentUsers.any { it.email.equals(email, ignoreCase = true) }) {
            throw Exception("РџРѕС‡С‚Р° СѓР¶Рµ Р·Р°РЅСЏС‚Р°")
        }

        // 2. РЎРѕР·РґР°РµРј РѕР±СЉРµРєС‚
        val newUser = UserDto(
            id = UUID.randomUUID().toString(),
            email = email,
            password = password,
            name = name,
            surname = surname,
            avatar = null
        )

        // 3. РџРёС€РµРј РІ С„Р°Р№Р»
        jsonDbManager.addUser(newUser)

        // 4. РђРІС‚РѕРјР°С‚РёС‡РµСЃРєРёР№ РІС…РѕРґ
        tokenManager.saveToken("token_${newUser.id}")
        tokenManager.saveUserInfo(email, name, surname)

        Log.d("AuthRepo", "Р®Р·РµСЂ Р·Р°РїРёСЃР°РЅ РІ С„Р°Р№Р» users.json")
    }
}


// === FILE: \data\src\main\java\com\aiden3630\data\repository\ProjectRepositoryImpl.kt ===

package com.aiden3630.data.repository

import com.aiden3630.data.manager.TokenManager
import com.aiden3630.domain.model.UserProject
import com.aiden3630.domain.repository.ProjectRepository
import kotlinx.coroutines.flow.Flow
import kotlinx.coroutines.flow.first
import kotlinx.coroutines.flow.map
import kotlinx.serialization.encodeToString
import kotlinx.serialization.json.Json
import java.util.UUID
import javax.inject.Inject

class ProjectRepositoryImpl @Inject constructor(
    private val tokenManager: TokenManager
) : ProjectRepository {

    private val json = Json { ignoreUnknownKeys = true }

    override suspend fun createProject(name: String, type: String, dateStart: String, imageUri: String?) {
        // 1. Р§РёС‚Р°РµРј С‚РµРєСѓС‰РёР№ СЃРїРёСЃРѕРє
        val projectsJson = tokenManager.getProjects().first()
        val currentList = try {
            json.decodeFromString<MutableList<UserProject>>(projectsJson)
        } catch (e: Exception) {
            mutableListOf()
        }

        // 2. РЎРѕР·РґР°РµРј РЅРѕРІС‹Р№ РїСЂРѕРµРєС‚
        val newProject = UserProject(
            id = UUID.randomUUID().toString(),
            name = name,
            type = type,
            dateStart = dateStart,
            category = "РЎРІРѕС‘",
            imageUri = imageUri
        )

        // 3. Р”РѕР±Р°РІР»СЏРµРј Рё СЃРѕС…СЂР°РЅСЏРµРј
        currentList.add(0, newProject) // Р”РѕР±Р°РІР»СЏРµРј РІ РЅР°С‡Р°Р»Рѕ СЃРїРёСЃРєР°
        val newJson = json.encodeToString(currentList)

        tokenManager.saveProjects(newJson)
    }

    // РњРµС‚РѕРґ РґР»СЏ РїРѕР»СѓС‡РµРЅРёСЏ СЃРїРёСЃРєР°
    override fun getAllProjects(): Flow<List<UserProject>> {
        return tokenManager.getProjects().map { jsonString ->
            try {
                json.decodeFromString<List<UserProject>>(jsonString)
            } catch (e: Exception) {
                emptyList()
            }
        }
    }
    override suspend fun getProjectById(id: String): UserProject? {
        val projectsJson = tokenManager.getProjects().first()
        val list = try {
            json.decodeFromString<List<UserProject>>(projectsJson)
        } catch (e: Exception) { emptyList() }

        return list.find { it.id == id }
    }
}


// === FILE: \data\src\main\java\com\aiden3630\data\repository\ShopRepositoryImpl.kt ===

package com.aiden3630.data.repository

import android.content.Context
import com.aiden3630.domain.model.Product
import com.aiden3630.domain.repository.ShopRepository
import dagger.hilt.android.qualifiers.ApplicationContext
import kotlinx.coroutines.flow.Flow
import kotlinx.coroutines.flow.flow
import kotlinx.serialization.encodeToString
import kotlinx.serialization.json.Json
import java.io.File
import javax.inject.Inject

class ShopRepositoryImpl @Inject constructor(
    @ApplicationContext private val context: Context // РќР°Рј РЅСѓР¶РµРЅ РєРѕРЅС‚РµРєСЃС‚
) : ShopRepository {

    private val jsonParser = Json {
        ignoreUnknownKeys = true
        prettyPrint = true
    }

    private val fileName = "shop_products.json"

    // Р”РµС„РѕР»С‚РЅС‹Р№ СЃРїРёСЃРѕРє, РєРѕС‚РѕСЂС‹Р№ Р·Р°РїРёС€РµС‚СЃСЏ РїСЂРё РїРµСЂРІРѕРј Р·Р°РїСѓСЃРєРµ
    private fun getDefaultProducts(): List<Product> {
        return listOf(
            Product(
                id = 1,
                title = "Р СѓР±Р°С€РєР° Р’РѕСЃРєСЂРµСЃРµРЅСЊРµ",
                price = 300,
                category = "РњСѓР¶С‡РёРЅР°Рј",
                description = "РњРѕР№ РІС‹Р±РѕСЂ РґР»СЏ СЌС‚РёС… С€Р°РїРѕРє вЂ“ РєР°СЂРґРЅС‹Рµ СЃРѕСЃС‚Р°РІС‹, РєРѕС‚РѕСЂС‹Рµ СЂР°СЃРєСЂС‹РІР°СЋС‚СЃСЏ РґРµР»РёРєР°С‚РЅС‹Рј РїСѓС€РєРѕРј. РљР°С€РµРјРёСЂС‹, РјРµСЂРёРЅРѕСЃС‹, СЃРјРµСЃРѕРІРєРё СЃ РЅРёРјРё РѕС‚Р»РёС‡РЅРѕ РїРѕРґРѕР№РґСѓС‚ РЅР° С€Р°РїРєСѓ.\n" +
                        "РљР°СЂРґРЅС‹Рµ СЃРѕСЃС‚Р°РІС‹ Р±РµСЂРёС‚Рµ РІ Р±РѕР»СЊС€РѕРµ РєРѕР»РёС‡РµСЃС‚РІРѕ СЃР»РѕР¶РµРЅРёР№, РІСЏР·Р°С‚СЊ Р±СѓРґРµРј СЂРµР·РёРЅРєСѓ 1С…1, РїР»РѕС‚РЅРµРЅСЊРєРѕ.\n" +
                        "РџСЂРёРјРµСЂРЅС‹Р№ СЂР°СЃС…РѕРґ РЅР° С€Р°РїРєСѓ СЃ РїРѕРґРіРёР±РѕРј 70-90Рі."
            ),
            Product(
                id = 2,
                title = "РЁРѕСЂС‚С‹ Р’С‚РѕСЂРЅРёРє",
                price = 400,
                category = "РњСѓР¶С‡РёРЅР°Рј",
                description = "Р›РµРіРєРёРµ Рё СѓРґРѕР±РЅС‹Рµ С€РѕСЂС‚С‹ РґР»СЏ РґРѕРјР° Рё РѕС‚РґС‹С…Р°. \n" +
                        "Р РµРєРѕРјРµРЅРґСѓРµРјР°СЏ РїСЂСЏР¶Р°: С…Р»РѕРїРѕРє СЃ Р°РєСЂРёР»РѕРј (50/50) РёР»Рё С‡РёСЃС‚С‹Р№ С…Р»РѕРїРѕРє РјРµСЂСЃРµСЂРёР·РѕРІР°РЅРЅС‹Р№.\n" +
                        "РЎРїРёС†С‹: в„–3 РґР»СЏ СЂРµР·РёРЅРєРё, в„–4 РґР»СЏ РѕСЃРЅРѕРІРЅРѕРіРѕ РїРѕР»РѕС‚РЅР°.\n" +
                        "РџР»РѕС‚РЅРѕСЃС‚СЊ РІСЏР·Р°РЅРёСЏ: 20 РїРµС‚РµР»СЊ С… 28 СЂСЏРґРѕРІ = 10С…10 СЃРј.\n" +
                        "РћСЃРѕР±РµРЅРЅРѕСЃС‚Рё: РІСЏР¶СѓС‚СЃСЏ СЃРЅРёР·Сѓ РІРІРµСЂС…, Р±РµР· С€РІРѕРІ, РїРѕСЏСЃ РЅР° РєСѓР»РёСЃРєРµ."
            ),
            Product(
                id = 3,
                title = "РџР»Р°С‚СЊРµ РЎСЂРµРґР°",
                price = 800,
                category = "Р–РµРЅС‰РёРЅР°Рј",
                description = "Р­Р»РµРіР°РЅС‚РЅРѕРµ РїР»Р°С‚СЊРµ СЃРёР»СѓСЌС‚Р° С‚СЂР°РїРµС†РёСЏ.\n" +
                        "РРґРµР°Р»СЊРЅРѕ РїРѕРґС…РѕРґРёС‚ РґР»СЏ Р»РµС‚РЅРёС… РїСЂРѕРіСѓР»РѕРє. РСЃРїРѕР»СЊР·СѓР№С‚Рµ РЅР°С‚СѓСЂР°Р»СЊРЅС‹Р№ Р»РµРЅ РёР»Рё С€РµР»Рє.\n" +
                        "Р’Р°Рј РїРѕРЅР°РґРѕР±РёС‚СЃСЏ:\n" +
                        "- РўРєР°РЅСЊ: 2.5 РјРµС‚СЂР° РїСЂРё С€РёСЂРёРЅРµ 140 СЃРј.\n" +
                        "- РџРѕС‚Р°Р№РЅР°СЏ РјРѕР»РЅРёСЏ 50 СЃРј.\n" +
                        "- РќРёС‚РєРё РІ С‚РѕРЅ.\n" +
                        "РЎР»РѕР¶РЅРѕСЃС‚СЊ: РЎСЂРµРґРЅСЏСЏ (С‚СЂРµР±СѓРµС‚ РЅР°РІС‹РєРѕРІ РІС‚Р°С‡РёРІР°РЅРёСЏ РјРѕР»РЅРёРё)."
            ),
            Product(
                id = 4,
                title = "Р¤СѓС‚Р±РѕР»РєР° Р§РµС‚РІРµСЂРі",
                price = 450,
                category = "Р”РµС‚СЏРј",
                description = "Р‘Р°Р·РѕРІР°СЏ С„СѓС‚Р±РѕР»РєР° РѕРІРµСЂСЃР°Р№Р· РґР»СЏ СЂРµР±РµРЅРєР°.\n" +
                        "РњР°С‚РµСЂРёР°Р»: РљСѓР»РёСЂРЅР°СЏ РіР»Р°РґСЊ (100% С…Р»РѕРїРѕРє) РёР»Рё С„СѓС‚РµСЂ 2-С… РЅРёС‚РєР°.\n" +
                        "Р Р°СЃС…РѕРґ С‚РєР°РЅРё: 0.6 - 0.8 РјРµС‚СЂР° РІ Р·Р°РІРёСЃРёРјРѕСЃС‚Рё РѕС‚ СЂРѕСЃС‚Р°.\n" +
                        "Р’ РІС‹РєСЂРѕР№РєРµ СѓС‡С‚РµРЅС‹ РїСЂРёРїСѓСЃРєРё РЅР° С€РІС‹ 0.7 СЃРј.\n" +
                        "РћС‚Р»РёС‡РЅРѕ СЃРѕС‡РµС‚Р°РµС‚СЃСЏ СЃ РґР¶РёРЅСЃР°РјРё РёР»Рё СЃРїРѕСЂС‚РёРІРЅС‹РјРё С€С‚Р°РЅР°РјРё."
            ),
            Product(
                id = 5,
                title = "РљРµРїРєР° РџСЏС‚РЅРёС†Р°",
                price = 150,
                category = "РђРєСЃРµСЃСЃСѓР°СЂС‹",
                description = "РЎС‚РёР»СЊРЅС‹Р№ Р°РєСЃРµСЃСЃСѓР°СЂ РґР»СЏ Р·Р°РІРµСЂС€РµРЅРёСЏ РѕР±СЂР°Р·Р°.\n" +
                        "Р’СЏР·Р°РЅРёРµ РєСЂСЋС‡РєРѕРј в„–3.5.\n" +
                        "РџСЂСЏР¶Р°: Р Р°С„РёСЏ (РЅР°С‚СѓСЂР°Р»СЊРЅРѕРµ РІРѕР»РѕРєРЅРѕ РёР· Р»РёСЃС‚СЊРµРІ РїР°Р»СЊРјС‹).\n" +
                        "Р Р°СЃС…РѕРґ: 1.5 РјРѕС‚РєР° (РѕРєРѕР»Рѕ 150 РјРµС‚СЂРѕРІ).\n" +
                        "РљРµРїРєР° РґРµСЂР¶РёС‚ С„РѕСЂРјСѓ, РЅРµ Р±РѕРёС‚СЃСЏ РІР»Р°РіРё Рё РѕС‚Р»РёС‡РЅРѕ Р·Р°С‰РёС‰Р°РµС‚ РѕС‚ СЃРѕР»РЅС†Р°."
            )
        )
    }

    override fun getProducts(): Flow<List<Product>> = flow {
        try {
            val file = File(context.filesDir, fileName)

            // Р•СЃР»Рё С„Р°Р№Р»Р° РЅРµС‚ - СЃРѕР·РґР°РµРј
            if (!file.exists()) {
                file.createNewFile()
                val defaultData = getDefaultProducts()
                val jsonString = jsonParser.encodeToString(defaultData)
                file.writeText(jsonString)
            }

            // Р§РёС‚Р°РµРј РёР· С„Р°Р№Р»Р°
            val content = file.readText()
            val products = jsonParser.decodeFromString<List<Product>>(content)
            emit(products)

        } catch (e: Exception) {
            e.printStackTrace()
            emit(emptyList())
        }
    }
}


// === FILE: \data\src\test\java\com\aiden3630\data\AuthRepositoryTest.kt ===

package com.aiden3630.data

import com.aiden3630.data.manager.TokenManager
import com.aiden3630.data.network.AuthApi
import com.aiden3630.data.repository.AuthRepositoryImpl
import io.mockk.coEvery
import io.mockk.coVerify
import io.mockk.mockk
import kotlinx.coroutines.flow.flowOf
import kotlinx.coroutines.test.runTest
import org.junit.Test

class AuthRepositoryTest {

    // РЎРѕР·РґР°РµРј С„РµР№РєРѕРІС‹Рµ РєР»Р°СЃСЃС‹ (РїСѓСЃС‚С‹С€РєРё)
    private val api = mockk<AuthApi>(relaxed = true)
    private val tokenManager = mockk<TokenManager>(relaxed = true)

    // РЎРѕР·РґР°РµРј СЂРµР°Р»СЊРЅС‹Р№ СЂРµРїРѕР·РёС‚РѕСЂРёР№, РЅРѕ РґР°РµРј РµРјСѓ С„РµР№РєРё
    private val repository = AuthRepositoryImpl(api, tokenManager)

    @Test
    fun `signIn saves token and user info`() = runTest {
        // GIVEN (Р”Р°РЅРѕ)
        val email = "test@mail.ru"
        val password = "pass"

        // РћР±РјР°РЅС‹РІР°РµРј СЂРµРїРѕР·РёС‚РѕСЂРёР№: РіРѕРІРѕСЂРёРј, С‡С‚Рѕ РІ Р±Р°Р·Рµ РµСЃС‚СЊ С‚Р°РєРѕР№ СЋР·РµСЂ
        coEvery { tokenManager.getUsersDb() } returns flowOf(
            """[{"id":"1","email":"test@mail.ru","firstname":"Test","lastname":"User"}]"""
        )

        // WHEN (РљРѕРіРґР°)
        repository.signIn(email, password)

        // THEN (РўРѕРіРґР° РїСЂРѕРІРµСЂСЏРµРј)
        // РЈР±РµР¶РґР°РµРјСЃСЏ, С‡С‚Рѕ СЂРµРїРѕР·РёС‚РѕСЂРёР№ РІС‹Р·РІР°Р» РјРµС‚РѕРґ СЃРѕС…СЂР°РЅРµРЅРёСЏ
        coVerify { tokenManager.saveToken(any()) }
        coVerify { tokenManager.saveUserInfo(email, "Test", "User") }
    }
}


// === FILE: \data\build.gradle.kts ===

plugins {
    alias(libs.plugins.android.library)
    alias(libs.plugins.kotlin.android)
    alias(libs.plugins.google.devtools.ksp) // Hilt
    alias(libs.plugins.jetbrains.kotlin.serialization) // JSON
}

android {
    namespace = "com.aiden3630.data"
    compileSdk = 35
    defaultConfig { minSdk = 33 }
    compileOptions { sourceCompatibility = JavaVersion.VERSION_11; targetCompatibility = JavaVersion.VERSION_11 }
    kotlinOptions { jvmTarget = "11" }
    testOptions {
        unitTests.isReturnDefaultValues = true
    }
}

dependencies {
    implementation(project(":domain")) // рџ‘‡ Р—Р°РІРёСЃРёС‚ РѕС‚ Domain

    // РЎРµС‚СЊ
    implementation(libs.retrofit)
    implementation(libs.okhttp)
    implementation(libs.okhttp.logging)
    implementation(libs.retrofit.converter.kotlinx.serialization)
    implementation(libs.kotlinx.serialization.json)

    // DataStore
    implementation(libs.androidx.datastore.preferences)

    // Hilt
    implementation(libs.hilt.android)
    ksp(libs.hilt.compiler)
    testImplementation(libs.junit)
    testImplementation(libs.mockk)
    testImplementation(libs.kotlinx.coroutines.test)
}


// === FILE: \domain\src\androidTest\java\com\aiden3630\domain\ExampleInstrumentedTest.kt ===

package com.aiden3630.domain

import androidx.test.platform.app.InstrumentationRegistry
import androidx.test.ext.junit.runners.AndroidJUnit4

import org.junit.Test
import org.junit.runner.RunWith

import org.junit.Assert.*

/**
 * Instrumented test, which will execute on an Android device.
 *
 * See [testing documentation](http://d.android.com/tools/testing).
 */
@RunWith(AndroidJUnit4::class)
class ExampleInstrumentedTest {
    @Test
    fun useAppContext() {
        // Context of the app under test.
        val appContext = InstrumentationRegistry.getInstrumentation().targetContext
        assertEquals("com.aiden3630.domain.test", appContext.packageName)
    }
}


// === FILE: \domain\src\main\java\com\aiden3630\domain\model\Product.kt ===

package com.aiden3630.domain.model

import kotlinx.serialization.Serializable

@Serializable
data class Product(
    val id: Int,
    val title: String,
    val price: Int,
    val category: String,
    val description: String = ""
)
data class CartItemModel(
    val product: Product,
    var quantity: Int = 1
)


// === FILE: \domain\src\main\java\com\aiden3630\domain\model\UserProject.kt ===

package com.aiden3630.domain.model

import kotlinx.serialization.Serializable

@Serializable
data class UserProject(
    val id: String,
    val name: String,
    val type: String,
    val dateStart: String,
    val imageUri: String?,
    val category: String
)


// === FILE: \domain\src\main\java\com\aiden3630\domain\repository\AuthRepository.kt ===

package com.aiden3630.domain.repository

interface AuthRepository {
    suspend fun signIn(email: String, password: String)

    suspend fun signUp(email: String, password: String, name: String, surname: String)
}


// === FILE: \domain\src\main\java\com\aiden3630\domain\repository\ProjectRepository.kt ===

package com.aiden3630.domain.repository

import com.aiden3630.domain.model.UserProject
import kotlinx.coroutines.flow.Flow

interface ProjectRepository {
    suspend fun createProject(name: String, type: String, dateStart: String, imageUri: String?)
    fun getAllProjects(): Flow<List<UserProject>>
    suspend fun getProjectById(id: String): com.aiden3630.domain.model.UserProject?
}


// === FILE: \domain\src\main\java\com\aiden3630\domain\repository\ShopRepository.kt ===

package com.aiden3630.domain.repository

import com.aiden3630.domain.model.Product
import kotlinx.coroutines.flow.Flow

interface ShopRepository {
    fun getProducts(): Flow<List<Product>>
}


// === FILE: \domain\src\test\java\com\aiden3630\domain\ExampleUnitTest.kt ===

package com.aiden3630.domain

import org.junit.Test

import org.junit.Assert.*

/**
 * Example local unit test, which will execute on the development machine (host).
 *
 * See [testing documentation](http://d.android.com/tools/testing).
 */
class ExampleUnitTest {
    @Test
    fun addition_isCorrect() {
        assertEquals(4, 2 + 2)
    }
}


// === FILE: \domain\build.gradle.kts ===

plugins {
    alias(libs.plugins.android.library)
    alias(libs.plugins.kotlin.android)
    alias(libs.plugins.jetbrains.kotlin.serialization)
}

android {
    namespace = "com.aiden3630.domain"
    compileSdk = 35
    defaultConfig { minSdk = 33 }
    compileOptions { sourceCompatibility = JavaVersion.VERSION_11; targetCompatibility = JavaVersion.VERSION_11 }
    kotlinOptions { jvmTarget = "11" }
}

dependencies {

    implementation(libs.androidx.core.ktx)
    implementation(libs.androidx.appcompat)
    implementation(libs.material)
    testImplementation(libs.junit)
    androidTestImplementation(libs.androidx.junit)
    androidTestImplementation(libs.androidx.espresso.core)
    implementation(libs.kotlinx.serialization.json)
}


// === FILE: \gradle\libs.versions.toml ===

[versions]
agp = "8.12.3"
kotlin = "2.0.21"
coreKtx = "1.15.0"
junit = "4.13.2"
junitVersion = "1.2.1"
espressoCore = "3.6.1"
lifecycleRuntimeKtx = "2.8.7"
activityCompose = "1.9.3"
composeBom = "2024.11.00"
appcompat = "1.7.0"
material = "1.12.0"
mockk = "1.13.8"
coroutinesTest = "1.7.3"

# Network (РњРѕРґСѓР»СЊ Р’)
retrofit = "2.11.0"
okhttp = "4.12.0"
kotlinxSerialization = "1.7.3"

# DI (РњРѕРґСѓР»СЊ Рђ - РђСЂС…РёС‚РµРєС‚СѓСЂР°)
hilt = "2.51.1"
ksp = "2.0.21-1.0.27" # РџР»Р°РіРёРЅ РґР»СЏ РѕР±СЂР°Р±РѕС‚РєРё Р°РЅРЅРѕС‚Р°С†РёР№ (РІРјРµСЃС‚Рѕ kapt)

# Navigation (РњРѕРґСѓР»СЊ Р‘)
navigationCompose = "2.8.4"

# Image Loading (РљСЌС€РёСЂРѕРІР°РЅРёРµ РєР°СЂС‚РёРЅРѕРє - РњРѕРґСѓР»СЊ Р“)
coil = "2.7.0"

# Local Storage (РљСЌС€РёСЂРѕРІР°РЅРёРµ РґР°РЅРЅС‹С… - РњРѕРґСѓР»СЊ Р“)
room = "2.6.1"
datastore = "1.1.1"

[libraries]
androidx-core-ktx = { group = "androidx.core", name = "core-ktx", version.ref = "coreKtx" }
junit = { group = "junit", name = "junit", version.ref = "junit" }
androidx-junit = { group = "androidx.test.ext", name = "junit", version.ref = "junitVersion" }
androidx-espresso-core = { group = "androidx.test.espresso", name = "espresso-core", version.ref = "espressoCore" }
androidx-appcompat = { group = "androidx.appcompat", name = "appcompat", version.ref = "appcompat" }
material = { group = "com.google.android.material", name = "material", version.ref = "material" }

# --- Jetpack Compose (UI) ---
androidx-lifecycle-runtime-ktx = { group = "androidx.lifecycle", name = "lifecycle-runtime-ktx", version.ref = "lifecycleRuntimeKtx" }
androidx-activity-compose = { group = "androidx.activity", name = "activity-compose", version.ref = "activityCompose" }
androidx-compose-bom = { group = "androidx.compose", name = "compose-bom", version.ref = "composeBom" }
androidx-ui = { group = "androidx.compose.ui", name = "ui" }
androidx-ui-graphics = { group = "androidx.compose.ui", name = "ui-graphics" }
androidx-ui-tooling = { group = "androidx.compose.ui", name = "ui-tooling" }
androidx-ui-tooling-preview = { group = "androidx.compose.ui", name = "ui-tooling-preview" }
androidx-material3 = { group = "androidx.compose.material3", name = "material3" }
androidx-navigation-compose = { group = "androidx.navigation", name = "navigation-compose", version.ref = "navigationCompose" }

# --- Network (Retrofit + OkHttp) ---
retrofit = { group = "com.squareup.retrofit2", name = "retrofit", version.ref = "retrofit" }
retrofit-converter-kotlinx-serialization = { group = "com.squareup.retrofit2", name = "converter-kotlinx-serialization", version.ref = "retrofit" }
okhttp = { group = "com.squareup.okhttp3", name = "okhttp", version.ref = "okhttp" }
okhttp-logging = { group = "com.squareup.okhttp3", name = "logging-interceptor", version.ref = "okhttp" }
kotlinx-serialization-json = { group = "org.jetbrains.kotlinx", name = "kotlinx-serialization-json", version.ref = "kotlinxSerialization" }

# --- Dependency Injection (Hilt) ---
hilt-android = { group = "com.google.dagger", name = "hilt-android", version.ref = "hilt" }
hilt-compiler = { group = "com.google.dagger", name = "hilt-android-compiler", version.ref = "hilt" }
androidx-hilt-navigation-compose = { group = "androidx.hilt", name = "hilt-navigation-compose", version = "1.2.0" }

# --- Images (Coil) ---
coil-compose = { group = "io.coil-kt", name = "coil-compose", version.ref = "coil" }

# --- Local DB (Room) ---
androidx-room-runtime = { group = "androidx.room", name = "room-runtime", version.ref = "room" }
androidx-room-ktx = { group = "androidx.room", name = "room-ktx", version.ref = "room" }
androidx-room-compiler = { group = "androidx.room", name = "room-compiler", version.ref = "room" }
androidx-datastore-preferences = { group = "androidx.datastore", name = "datastore-preferences", version.ref = "datastore" }
# Unit Tests (Р›РѕРіРёРєР°)
mockk = { group = "io.mockk", name = "mockk", version.ref = "mockk" }
kotlinx-coroutines-test = { group = "org.jetbrains.kotlinx", name = "kotlinx-coroutines-test", version.ref = "coroutinesTest" }

# UI Tests (РРЅС‚РµСЂС„РµР№СЃ)
androidx-ui-test-junit4 = { group = "androidx.compose.ui", name = "ui-test-junit4" }
androidx-ui-test-manifest = { group = "androidx.compose.ui", name = "ui-test-manifest" }

[plugins]
android-application = { id = "com.android.application", version.ref = "agp" }
kotlin-android = { id = "org.jetbrains.kotlin.android", version.ref = "kotlin" }
android-library = { id = "com.android.library", version.ref = "agp" }
# РќРѕРІС‹Рµ РїР»Р°РіРёРЅС‹
jetbrains-kotlin-serialization = { id = "org.jetbrains.kotlin.plugin.serialization", version.ref = "kotlin" }
google-devtools-ksp = { id = "com.google.devtools.ksp", version.ref = "ksp" }
hilt-android = { id = "com.google.dagger.hilt.android", version.ref = "hilt" }
compose-compiler = { id = "org.jetbrains.kotlin.plugin.compose", version.ref = "kotlin" }


// === FILE: \presentation\src\androidTest\java\com\aiden3630\presentation\MatuleTextFieldTest.kt ===

package com.aiden3630.presentation

import androidx.compose.ui.test.assertIsDisplayed
import androidx.compose.ui.test.junit4.createComposeRule
import androidx.compose.ui.test.onNodeWithText
import com.aiden3630.presentation.components.MatuleTextField
import org.junit.Rule
import org.junit.Test

class MatuleTextFieldTest {

    @get:Rule
    val composeTestRule = createComposeRule()

    @Test
    fun textField_showsError() {
        // Р РёСЃСѓРµРј РєРѕРјРїРѕРЅРµРЅС‚ РЅР° РІРёСЂС‚СѓР°Р»СЊРЅРѕРј СЌРєСЂР°РЅРµ
        composeTestRule.setContent {
            MatuleTextField(
                value = "",
                onValueChange = {},
                placeholder = "Email",
                isError = true, // Р’РєР»СЋС‡Р°РµРј РѕС€РёР±РєСѓ
                errorMessage = "РћС€РёР±РєР° РІРІРѕРґР°" // РўРµРєСЃС‚ РѕС€РёР±РєРё
            )
        }

        // РС‰РµРј С‚РµРєСЃС‚ "РћС€РёР±РєР° РІРІРѕРґР°" Рё РїСЂРѕРІРµСЂСЏРµРј, С‡С‚Рѕ РѕРЅ РІРёРґРµРЅ
        composeTestRule.onNodeWithText("РћС€РёР±РєР° РІРІРѕРґР°").assertIsDisplayed()
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\auth\CreatePasswordScreen.kt ===

package com.aiden3630.presentation.auth

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Modifier
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import com.aiden3630.presentation.components.MatuleButton
import com.aiden3630.presentation.components.MatuleTextField
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.R as UiKitR
import androidx.hilt.navigation.compose.hiltViewModel
import android.widget.Toast
import androidx.compose.ui.platform.LocalContext

@Composable
fun CreatePasswordScreen(
    onSaveClick: () -> Unit = {},
    viewModel: CreatePasswordViewModel = hiltViewModel()
) {
    val context = LocalContext.current
    var password by remember { mutableStateOf("") }
    var confirmPassword by remember { mutableStateOf("") }
    LaunchedEffect(Unit) {
        viewModel.event.collect { event ->
            when (event) {
                is AuthEvent.Success -> {
                    Toast.makeText(context, "РџР°СЂРѕР»СЊ СѓСЃРїРµС€РЅРѕ СЃРѕР·РґР°РЅ!", Toast.LENGTH_SHORT).show()
                    onSaveClick() // РџРµСЂРµС…РѕРґ РЅР° СЃР»РµРґСѓСЋС‰РёР№ СЌРєСЂР°РЅ (РџРРќ РёР»Рё Р“Р»Р°РІРЅР°СЏ)
                }
                is AuthEvent.Error -> {
                    Toast.makeText(context, event.message, Toast.LENGTH_LONG).show()
                }
            }
        }
    }

    // РЎРѕСЃС‚РѕСЏРЅРёСЏ РѕС€РёР±РѕРє
    var isPasswordError by remember { mutableStateOf(false) }
    var passwordErrorText by remember { mutableStateOf<String?>(null) }

    // Р¤СѓРЅРєС†РёСЏ РїСЂРѕРІРµСЂРєРё РЅР°РґРµР¶РЅРѕСЃС‚Рё
    fun validatePassword(): Boolean {
        if (password != confirmPassword) {
            isPasswordError = true
            passwordErrorText = "РџР°СЂРѕР»Рё РЅРµ СЃРѕРІРїР°РґР°СЋС‚"
            return false
        }

        if (password.length < 8) {
            isPasswordError = true
            passwordErrorText = "РџР°СЂРѕР»СЊ РґРѕР»Р¶РµРЅ Р±С‹С‚СЊ РЅРµ РјРµРЅРµРµ 8 СЃРёРјРІРѕР»РѕРІ"
            return false
        }

        val passwordRegex = Regex("^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[@#\$%^&+=!])(?=\\S+\$).{8,}\$")

        if (!password.matches(passwordRegex)) {
            isPasswordError = true
            passwordErrorText = "РџР°СЂРѕР»СЊ РґРѕР»Р¶РµРЅ СЃРѕРґРµСЂР¶Р°С‚СЊ A-Z, a-z, 0-9 Рё СЃРёРјРІРѕР»С‹ @#$%^&+=!"
            return false
        }

        isPasswordError = false
        passwordErrorText = null
        return true
    }

    Column(
        modifier = Modifier
            .fillMaxSize()
            .background(MatuleWhite)
            .padding(horizontal = 20.dp)
    ) {
        // Р—Р°РіРѕР»РѕРІРѕРє
        Spacer(modifier = Modifier.height(103.dp))

        Row(verticalAlignment = androidx.compose.ui.Alignment.CenterVertically) {
            androidx.compose.foundation.Image(
                painter = painterResource(id = UiKitR.drawable.im_hand),
                contentDescription = null,
                modifier = Modifier.size(32.dp).padding(end = 8.dp)
            )
            Text("РЎРѕР·РґР°РЅРёРµ РїР°СЂРѕР»СЏ", style = Title1, color = MatuleBlack)
        }

        Spacer(modifier = Modifier.height(23.dp))

        Text(
            text = "Р’РІРµРґРёС‚Рµ РЅРѕРІС‹Р№ РїР°СЂРѕР»СЊ",
            style = BodyText,
            color = MatuleBlack
        )

        Spacer(modifier = Modifier.height(35.dp))

        // РџРѕР»СЏ РІРІРѕРґР°

        // РќРѕРІС‹Р№ РїР°СЂРѕР»СЊ
        Text("РќРѕРІС‹Р№ РџР°СЂРѕР»СЊ", style = Caption, color = MatuleBlack)
        Spacer(modifier = Modifier.height(4.dp))
        MatuleTextField(
            value = password,
            onValueChange = {
                password = it
                isPasswordError = false // РЎР±СЂРѕСЃ РѕС€РёР±РєРё РїСЂРё РІРІРѕРґРµ
            },
            placeholder = "********",
            isPassword = true,
            isError = isPasswordError,
            errorMessage = passwordErrorText
        )

        Spacer(modifier = Modifier.height(24.dp))

        // РџРѕРІС‚РѕСЂРёС‚Рµ РїР°СЂРѕР»СЊ
        Text("РџРѕРІС‚РѕСЂРёС‚Рµ РїР°СЂРѕР»СЊ", style = Caption, color = MatuleBlack)
        Spacer(modifier = Modifier.height(4.dp))
        MatuleTextField(
            value = confirmPassword,
            onValueChange = {
                confirmPassword = it
                isPasswordError = false
            },
            placeholder = "********",
            isPassword = true,
            isError = isPasswordError
        )

        Spacer(modifier = Modifier.height(40.dp))

        // РљРЅРѕРїРєР° "РЎРѕС…СЂР°РЅРёС‚СЊ"
        MatuleButton(
            text = "РЎРѕС…СЂР°РЅРёС‚СЊ",
            onClick = {
                if (validatePassword()) {
                    viewModel.finalizeRegistration(password)
                }
            },
            enabled = password.isNotEmpty() && confirmPassword.isNotEmpty()
        )
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\auth\CreatePasswordViewModel.kt ===

package com.aiden3630.presentation.auth

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.aiden3630.data.manager.TokenManager
import com.aiden3630.domain.repository.AuthRepository
import dagger.hilt.android.lifecycle.HiltViewModel
import kotlinx.coroutines.channels.Channel
import kotlinx.coroutines.flow.first
import kotlinx.coroutines.flow.receiveAsFlow
import kotlinx.coroutines.launch
import javax.inject.Inject

@HiltViewModel
class CreatePasswordViewModel @Inject constructor(
    private val repository: AuthRepository,
    private val tokenManager: TokenManager
) : ViewModel() {

    // РљР°РЅР°Р» РґР»СЏ РѕС‚РїСЂР°РІРєРё СЃРѕР±С‹С‚РёР№ СЌРєСЂР°РЅСѓ (РЈСЃРїРµС…/РћС€РёР±РєР°)
    private val _event = Channel<AuthEvent>()
    val event = _event.receiveAsFlow()

    fun finalizeRegistration(password: String) {
        viewModelScope.launch {
            try {
                // Р”РѕСЃС‚Р°РµРј РґР°РЅРЅС‹Рµ, РєРѕС‚РѕСЂС‹Рµ РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РІРІРµР» РЅР° РїСЂРѕС€Р»РѕРј СЌРєСЂР°РЅРµ
                val email = tokenManager.getEmail().first()
                val name = tokenManager.getName().first()
                val surname = tokenManager.getSurname().first()

                // Р’С‹Р·С‹РІР°РµРј СЂРµРіРёСЃС‚СЂР°С†РёСЋ РІ РЅР°С€РµРј JSON-С„Р°Р№Р»Рµ
                repository.signUp(
                    email = email,
                    password = password,
                    name = name,
                    surname = surname
                )

                // Р•СЃР»Рё РІСЃС‘ РѕРє вЂ” С€Р»РµРј СЃРёРіРЅР°Р» СѓСЃРїРµС…Р°
                _event.send(AuthEvent.Success)

            } catch (e: Exception) {
                // Р•СЃР»Рё РѕС€РёР±РєР° (РЅР°РїСЂРёРјРµСЂ, email СѓР¶Рµ Р·Р°РЅСЏС‚) вЂ” С€Р»РµРј С‚РµРєСЃС‚ РѕС€РёР±РєРё
                _event.send(AuthEvent.Error(e.message ?: "РћС€РёР±РєР° РїСЂРё СЃРѕС…СЂР°РЅРµРЅРёРё"))
            }
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\auth\CreatePinScreen.kt ===

package com.aiden3630.presentation.auth

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.dp
import androidx.hilt.navigation.compose.hiltViewModel
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.theme.MatuleBlack
import com.aiden3630.presentation.theme.MatuleTextGray
import com.aiden3630.presentation.theme.MatuleWhite
import kotlinx.coroutines.launch

@Composable
fun CreatePinScreen(
    onPinCreated: () -> Unit = {},  tokenManager: com.aiden3630.data.manager.TokenManager = hiltViewModel()
) {
    val scope = rememberCoroutineScope()
    // РЎРѕСЃС‚РѕСЏРЅРёРµ РІРІРµРґРµРЅРЅРѕРіРѕ РїРёРЅ-РєРѕРґР° (СЃС‚СЂРѕРєР°)
    var pinCode by remember { mutableStateOf("") }

    LaunchedEffect(pinCode) {
        if (pinCode.length == 4) {
            tokenManager.savePin(pinCode)
            onPinCreated()
        }
    }

    // Р¤СѓРЅРєС†РёСЏ РѕР±СЂР°Р±РѕС‚РєРё РЅР°Р¶Р°С‚РёР№
    @Composable
    fun onNumberClick(number: String) {
        if (pinCode.length < 4) {
            pinCode += number
        }
    }

    fun onDeleteClick() {
        if (pinCode.isNotEmpty()) {
            pinCode = pinCode.dropLast(1)
        }
    }

        Column(
            modifier = Modifier
                .fillMaxSize()
                .background(MatuleWhite)
                .padding(horizontal = 20.dp),
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            // Р—Р°РіРѕР»РѕРІРєРё
            Spacer(modifier = Modifier.height(103.dp))

            Text(
                text = "РЎРѕР·РґР°Р№С‚Рµ РїР°СЂРѕР»СЊ",
                style = Title1,
                color = MatuleBlack
            )

            Spacer(modifier = Modifier.height(8.dp))

            Text(
                text = "Р”Р»СЏ Р·Р°С‰РёС‚С‹ РІР°С€РёС… РїРµСЂСЃРѕРЅР°Р»СЊРЅС‹С… РґР°РЅРЅС‹С…",
                style = BodyText,
                color = MatuleTextGray,
                textAlign = TextAlign.Center
            )

            Spacer(modifier = Modifier.height(50.dp))

            // РРЅРґРёРєР°С‚РѕСЂ (С‚РѕС‡РєРё)
            PinIndicator(codeLength = pinCode.length)

            Spacer(modifier = Modifier.weight(1f)) // РўРѕР»РєР°РµРј РєР»Р°РІРёР°С‚СѓСЂСѓ РІРЅРёР·

            // РљР»Р°РІРёР°С‚СѓСЂР°
            NumberKeyboard(
                onNumberClick = { onNumberClick(it) },
                onDeleteClick = { onDeleteClick() }
            )

            Spacer(modifier = Modifier.height(50.dp))
        }
    }




// === FILE: \presentation\src\main\java\com\aiden3630\presentation\auth\PinComponents.kt ===

package com.aiden3630.presentation.auth

import androidx.compose.foundation.background
import androidx.compose.foundation.border
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.R as UiKitR

@Composable
fun PinIndicator(codeLength: Int) {
    Row(
        horizontalArrangement = Arrangement.spacedBy(12.dp),
        verticalAlignment = Alignment.CenterVertically
    ) {
        repeat(4) { index ->
            val isFilled = index < codeLength
            Box(
                modifier = Modifier
                    .size(16.dp)
                    .background(
                        color = if (isFilled) MatuleBlue else MatuleWhite,
                        shape = CircleShape
                    )
                    .then(
                        if (!isFilled) Modifier.border(1.dp, MatuleBlue, CircleShape) else Modifier
                    )
            )
        }
    }
}

@Composable
fun NumberKeyboard(
    onNumberClick: (String) -> Unit,
    onDeleteClick: () -> Unit
) {
    val keys = listOf(
        listOf("1", "2", "3"),
        listOf("4", "5", "6"),
        listOf("7", "8", "9"),
        listOf(null, "0", "del")
    )

    Column(
        verticalArrangement = Arrangement.spacedBy(24.dp),
        modifier = Modifier.fillMaxWidth()
    ) {
        keys.forEach { row ->
            Row(
                horizontalArrangement = Arrangement.SpaceEvenly,
                modifier = Modifier.fillMaxWidth(),
                verticalAlignment = Alignment.CenterVertically
            ) {
                row.forEach { key ->
                    when (key) {
                        null -> {
                            // РџСѓСЃС‚РѕРµ РјРµСЃС‚Рѕ РґР»СЏ РІС‹СЂР°РІРЅРёРІР°РЅРёСЏ
                            Spacer(modifier = Modifier.size(80.dp))
                        }
                        "del" -> {
                            // РљРЅРѕРїРєР° СѓРґР°Р»РµРЅРёСЏ
                            Box(
                                modifier = Modifier
                                    .size(80.dp)
                                    .clip(CircleShape)
                                    .clickable { onDeleteClick() },
                                contentAlignment = Alignment.Center
                            ) {
                                // UI
                                Icon(
                                    painter = painterResource(id = UiKitR.drawable.ic_delete),
                                    contentDescription = "Delete",
                                    tint = MatuleBlack,
                                    modifier = Modifier.size(32.dp)
                                )
                            }
                        }
                        else -> {
                            // РљРЅРѕРїРєР° СЃ С†РёС„СЂРѕР№
                            Box(
                                modifier = Modifier
                                    .size(80.dp)
                                    .clip(CircleShape)
                                    .background(MatuleInputBg)
                                    .clickable { onNumberClick(key) }, // РўРЈРў РўРћР›Р¬РљРћ Р›РћР“РРљРђ
                                contentAlignment = Alignment.Center
                            ) {

                                Text(
                                    text = key,
                                    style = Title1,
                                    color = MatuleBlack
                                )
                            }
                        }
                    }
                }
            }
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\auth\SignInPinScreen.kt ===

package com.aiden3630.presentation.auth

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.dp
import androidx.hilt.navigation.compose.hiltViewModel
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.theme.MatuleBlack
import com.aiden3630.presentation.theme.MatuleError
import com.aiden3630.presentation.theme.MatuleWhite

@Composable
fun SignInPinScreen(
    onAuthSuccess: () -> Unit = {},
    tokenManager: com.aiden3630.data.manager.TokenManager = hiltViewModel()
) {
    val savedPin by tokenManager.getPin().collectAsState(initial = null)
    var pinCode by remember { mutableStateOf("") }
    var isError by remember { mutableStateOf(false) }

    fun onNumberClick(number: String) {
        if (pinCode.length < 4) {
            isError = false // РЎР±СЂР°СЃС‹РІР°РµРј РѕС€РёР±РєСѓ РїСЂРё РІРІРѕРґРµ
            pinCode += number

            if (pinCode.length == 4) {
                // РџСЂРѕРІРµСЂРєР° РїР°СЂРѕР»СЏ
                if (pinCode == savedPin) {
                    onAuthSuccess()
                } else {
                    // РћС€РёР±РєР°
                    isError = true
                    pinCode = "" // РћС‡РёС‰Р°РµРј РїРѕР»Рµ
                }
            }
        }
    }

    fun onDeleteClick() {
        if (pinCode.isNotEmpty()) {
            pinCode = pinCode.dropLast(1)
        }
    }

    Column(
        modifier = Modifier
            .fillMaxSize()
            .background(MatuleWhite)
            .padding(horizontal = 20.dp),
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Spacer(modifier = Modifier.height(103.dp))

        Text(
            text = "Р’С…РѕРґ", // Р—Р°РіРѕР»РѕРІРѕРє РїРѕ РјР°РєРµС‚Сѓ
            style = Title1,
            color = MatuleBlack
        )

        // РџРѕРєР°Р·С‹РІР°РµРј С‚РµРєСЃС‚ РѕС€РёР±РєРё, РµСЃР»Рё РїР°СЂРѕР»СЊ РЅРµРІРµСЂРЅС‹Р№
        if (isError) {
            Spacer(modifier = Modifier.height(8.dp))
            Text(
                text = "РќРµРІРµСЂРЅС‹Р№ РїР°СЂРѕР»СЊ",
                style = BodyText,
                color = MatuleError,
                textAlign = TextAlign.Center
            )
        }

        Spacer(modifier = Modifier.height(50.dp))

        PinIndicator(codeLength = pinCode.length)

        Spacer(modifier = Modifier.weight(1f))

        NumberKeyboard(
            onNumberClick = { onNumberClick(it) },
            onDeleteClick = { onDeleteClick() }
        )

        Spacer(modifier = Modifier.height(50.dp))
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\auth\SignInScreen.kt ===

package com.aiden3630.presentation.auth

import androidx.compose.foundation.Image
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.tooling.preview.Preview
import androidx.compose.ui.unit.dp
import android.widget.Toast
import androidx.compose.ui.platform.LocalContext
import androidx.hilt.navigation.compose.hiltViewModel

import com.aiden3630.presentation.components.MatuleButton
import com.aiden3630.presentation.components.MatuleSocialButton
import com.aiden3630.presentation.components.MatuleTextField
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.theme.MatuleBlack
import com.aiden3630.presentation.theme.MatuleBlue
import com.aiden3630.presentation.theme.MatuleWhite
import com.aiden3630.presentation.R as UiKitR

@Composable
fun SignInScreen(
    onSignInClick: () -> Unit = {}, // РќР°РІРёРіР°С†РёСЏ
    onSignUpClick: () -> Unit = {},
    viewModel: SignInViewModel = hiltViewModel()
) {
    val context = LocalContext.current

    // collectAsState РїСЂРµРІСЂР°С‰Р°РµС‚ РїРѕС‚РѕРє РґР°РЅРЅС‹С… (Flow) РІ СЃРѕСЃС‚РѕСЏРЅРёРµ Compose
    val email by viewModel.emailState.collectAsState()
    val password by viewModel.passwordState.collectAsState()

    // РЎРѕСЃС‚РѕСЏРЅРёРµ РѕС€РёР±РєРё РІР°Р»РёРґР°С†РёРё
    var isEmailError by remember { mutableStateOf(false) }

    fun validateEmail(mail: String): Boolean {
        val emailRegex = "^[a-z0-9_]+@[a-z0-9_]+\\.ru$".toRegex()
        return mail.matches(emailRegex)
    }

    // РЎР»СѓС€Р°РµРј СЃРѕР±С‹С‚РёСЏ (РЈСЃРїРµС…/РћС€РёР±РєР°)
    LaunchedEffect(key1 = true) {
        viewModel.authEvent.collect { event ->
            when (event) {
                is AuthEvent.Success -> {
                    Toast.makeText(context, "РЈСЃРїРµС€РЅС‹Р№ РІС…РѕРґ!", Toast.LENGTH_SHORT).show()
                    onSignInClick() // РџРµСЂРµС…РѕРґРёРј РґР°Р»СЊС€Рµ
                }
                is AuthEvent.Error -> {
                    Toast.makeText(context, "РћС€РёР±РєР°: ${event.message}", Toast.LENGTH_LONG).show()
                }
            }
        }
    }

    Column(
        modifier = Modifier
            .fillMaxSize()
            .background(MatuleWhite)
            .padding(horizontal = 20.dp)
    ) {
        // Р—Р°РіРѕР»РѕРІРѕРє
        Spacer(modifier = Modifier.height(103.dp))

        Column(modifier = Modifier.fillMaxWidth()) {
            Row(
                verticalAlignment = Alignment.CenterVertically,
                modifier = Modifier.fillMaxWidth()
            ) {
                Image(
                    painter = painterResource(id = UiKitR.drawable.im_hand),
                    contentDescription = "Hello Hand",
                    modifier = Modifier
                        .size(32.dp)
                        .padding(end = 8.dp)
                )

                Text(
                    text = "Р”РѕР±СЂРѕ РїРѕР¶Р°Р»РѕРІР°С‚СЊ!",
                    style = Title1,
                    color = MatuleBlack
                )
            }

            Spacer(modifier = Modifier.height(23.dp))

            Text(
                text = "Р’РѕР№РґРёС‚Рµ, С‡С‚РѕР±С‹ РїРѕР»СЊР·РѕРІР°С‚СЊСЃСЏ С„СѓРЅРєС†РёСЏРјРё РїСЂРёР»РѕР¶РµРЅРёСЏ",
                style = BodyText,
                color = MatuleBlack
            )
        }

        // РџРѕР»СЏ РІРІРѕРґР°
        Spacer(modifier = Modifier.height(35.dp))

        // Email
        Text("Р’С…РѕРґ РїРѕ E-mail", style = Caption, color = MatuleBlack)
        Spacer(modifier = Modifier.height(4.dp))

        MatuleTextField(
            value = email, // Р—РЅР°С‡РµРЅРёРµ РёР· ViewModel
            onValueChange = {
                // РџРµСЂРµРґР°РµРј РёР·РјРµРЅРµРЅРёСЏ РІРѕ ViewModel
                viewModel.onEmailChange(it)
                isEmailError = false
            },
            placeholder = "example@mail.com",
            isError = isEmailError,
            errorMessage = if (isEmailError) "РќРµРІРµСЂРЅС‹Р№ С„РѕСЂРјР°С‚ E-mail" else null
        )

        Spacer(modifier = Modifier.height(24.dp))

        Text("РџР°СЂРѕР»СЊ", style = Caption, color = MatuleBlack)
        Spacer(modifier = Modifier.height(4.dp))
        MatuleTextField(
            value = password, // Р—РЅР°С‡РµРЅРёРµ РёР· ViewModel
            onValueChange = {
                viewModel.onPasswordChange(it) // РџРµСЂРµРґР°РµРј РёР·РјРµРЅРµРЅРёСЏ
            },
            placeholder = "вЂўвЂўвЂўвЂўвЂўвЂўвЂўвЂў",
            isPassword = true
        )

        Spacer(modifier = Modifier.height(30.dp))

        // --- РљРќРћРџРљРђ РЎ РџР РћР’Р•Р РљРћР™ ---
        MatuleButton(
            text = "Р”Р°Р»РµРµ",
            onClick = {
                if (validateEmail(email)) {
                    // Р’С‹Р·С‹РІР°РµРј РјРµС‚РѕРґ РІС…РѕРґР° Р±РµР· Р°СЂРіСѓРјРµРЅС‚РѕРІ (VM СЃР°РјР° РІРѕР·СЊРјРµС‚ РёС… РёР· state)
                    viewModel.onSignInClick()
                } else {
                    isEmailError = true
                }
            },
            // РљРЅРѕРїРєР° Р°РєС‚РёРІРЅР°, РµСЃР»Рё РїРѕР»СЏ РЅРµ РїСѓСЃС‚С‹Рµ
            enabled = email.isNotEmpty() && password.isNotEmpty()
        )

        // РљРЅРѕРїРєР° "Р—Р°СЂРµРіРёСЃС‚СЂРёСЂРѕРІР°С‚СЊСЃСЏ"
        Spacer(modifier = Modifier.height(16.dp))
        Box(
            modifier = Modifier.fillMaxWidth(),
            contentAlignment = Alignment.Center
        ) {
            Text(
                text = "Р—Р°СЂРµРіРёСЃС‚СЂРёСЂРѕРІР°С‚СЊСЃСЏ",
                style = BodyText.copy(color = MatuleBlue),
                modifier = Modifier.clickable { onSignUpClick() }
            )
        }
        Spacer(modifier = Modifier.height(30.dp))

        // РЎРѕС†СЃРµС‚Рё
        Text(
            text = "РР»Рё РІРѕР№РґРёС‚Рµ СЃ РїРѕРјРѕС‰СЊСЋ",
            style = Caption,
            modifier = Modifier.fillMaxWidth(),
            textAlign = TextAlign.Center
        )

        Spacer(modifier = Modifier.height(20.dp))

        MatuleSocialButton(
            text = "Р’РѕР№С‚Рё СЃ VK",
            iconRes = UiKitR.drawable.ic_vk,
            onClick = { viewModel.onSocialLogin() }
        )

        Spacer(modifier = Modifier.height(12.dp))

        MatuleSocialButton(
            text = "Р’РѕР№С‚Рё СЃ Yandex",
            iconRes = UiKitR.drawable.im_yandex,
            onClick = { viewModel.onSocialLogin() }
        )

        Spacer(modifier = Modifier.height(20.dp))
    }
}

@Preview(showBackground = true)
@Composable
fun SignInScreenPreview() {
    SignInScreen()
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\auth\SignInViewModel.kt ===

package com.aiden3630.presentation.auth

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.aiden3630.data.manager.TokenManager
import com.aiden3630.domain.repository.AuthRepository

import dagger.hilt.android.lifecycle.HiltViewModel
import kotlinx.coroutines.channels.Channel
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.flow.receiveAsFlow
import kotlinx.coroutines.launch
import javax.inject.Inject

@HiltViewModel
class SignInViewModel @Inject constructor(
    private val repository: AuthRepository,
    private val tokenManager: TokenManager,
    private val notificationService: com.aiden3630.presentation.utils.NotificationService// рџ‘€ Р”РѕР±Р°РІР»СЏРµРј TokenManager
) : ViewModel() {

    private val _authEvent = Channel<AuthEvent>()
    val authEvent = _authEvent.receiveAsFlow()

    // РЎРѕСЃС‚РѕСЏРЅРёСЏ РґР»СЏ РїРѕР»РµР№
    private val _emailState = MutableStateFlow("")
    val emailState = _emailState.asStateFlow()

    private val _passwordState = MutableStateFlow("")
    val passwordState = _passwordState.asStateFlow()

    init {
        // РџСЂРё Р·Р°РїСѓСЃРєРµ Р·Р°РіСЂСѓР¶Р°РµРј СЃРѕС…СЂР°РЅРµРЅРЅС‹Рµ РґР°РЅРЅС‹Рµ
        viewModelScope.launch {
            tokenManager.getEmail().collect { savedEmail ->
                _emailState.value = savedEmail
            }
        }
        viewModelScope.launch {
            tokenManager.getPassword().collect { savedPass ->
                _passwordState.value = savedPass
            }
        }
    }

    // РњРµС‚РѕРґС‹ РґР»СЏ РѕР±РЅРѕРІР»РµРЅРёСЏ С‚РµРєСЃС‚Р° РёР· UI
    fun onEmailChange(newValue: String) {
        _emailState.value = newValue
    }

    fun onPasswordChange(newValue: String) {
        _passwordState.value = newValue
    }

    fun onSignInClick() {
        // Р‘РµСЂРµРј С‚РµРєСѓС‰РёРµ Р·РЅР°С‡РµРЅРёСЏ
        val email = _emailState.value
        val password = _passwordState.value

        viewModelScope.launch {
            try {
                // РЎРѕС…СЂР°РЅСЏРµРј РІРІРµРґРµРЅРЅС‹Рµ РґР°РЅРЅС‹Рµ РїРµСЂРµРґ РІС…РѕРґРѕРј
                tokenManager.saveUserData(email, password)

                // РџСЂРѕР±СѓРµРј РІРѕР№С‚Рё
                repository.signIn(email, password)
                notificationService.showNotification("Р’С…РѕРґ РІС‹РїРѕР»РЅРµРЅ", "Р”РѕР±СЂРѕ РїРѕР¶Р°Р»РѕРІР°С‚СЊ РІ Matule!")
                _authEvent.send(AuthEvent.Success)
            } catch (e: Exception) {
                _authEvent.send(AuthEvent.Error(e.message ?: "РћС€РёР±РєР°"))
            }
        }
    }
    fun onSocialLogin() {
        viewModelScope.launch {
            // РРјРёС‚РёСЂСѓРµРј Р·Р°РґРµСЂР¶РєСѓ СЃРµС‚Рё
            kotlinx.coroutines.delay(500)
            // Р“РѕРІРѕСЂРёРј "РЈСЃРїРµС…"
            _authEvent.send(AuthEvent.Success)
            notificationService.showNotification("Р’С…РѕРґ РІС‹РїРѕР»РЅРµРЅ", "Р”РѕР±СЂРѕ РїРѕР¶Р°Р»РѕРІР°С‚СЊ РІ Matule!")
        }
    }
}

sealed class AuthEvent {
    object Success : AuthEvent()
    data class Error(val message: String) : AuthEvent()
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\auth\SignUpScreen.kt ===

package com.aiden3630.presentation.auth

import android.widget.Toast
import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.verticalScroll
import androidx.compose.material3.DropdownMenu
import androidx.compose.material3.DropdownMenuItem
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Modifier
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import com.aiden3630.presentation.components.MatuleButton
import com.aiden3630.presentation.components.MatuleTextField
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.R as UiKitR
import androidx.hilt.navigation.compose.hiltViewModel
import com.aiden3630.presentation.theme.MatuleBlack
import com.aiden3630.presentation.theme.MatuleTextGray
import com.aiden3630.presentation.theme.MatuleWhite
import com.aiden3630.presentation.components.MatuleDatePicker
import com.aiden3630.presentation.utils.convertMillisToDate

@Composable
fun SignUpScreen(
    onNextClick: () -> Unit = {},
    onBackClick: () -> Unit = {},
    viewModel: SignUpViewModel = hiltViewModel()
) {
    val context = LocalContext.current
    val scope = rememberCoroutineScope()
    // РЎРѕСЃС‚РѕСЏРЅРёСЏ РІСЃРµС… РїРѕР»РµР№
    var name by remember { mutableStateOf("") }
    var surname by remember { mutableStateOf("") }
    var patronymic by remember { mutableStateOf("") }
    var birthDate by remember { mutableStateOf("") }
    var email by remember { mutableStateOf("") }
    var gender by remember { mutableStateOf("") }
    var isEmailError by remember { mutableStateOf(false) }
    fun validateEmail(mail: String): Boolean {
        val emailRegex = "^[a-z0-9_]+@[a-z0-9_]+\\.ru$".toRegex()
        return mail.matches(emailRegex)
    }
    var showDatePicker by remember { mutableStateOf(false) }

    LaunchedEffect(key1 = true) {
        viewModel.signUpEvent.collect { event ->
            when(event) {
                is AuthEvent.Success -> {
                    Toast.makeText(context, "РђРєРєР°СѓРЅС‚ СЃРѕР·РґР°РЅ!", Toast.LENGTH_SHORT).show()
                    onNextClick() // РРґРµРј СЃРѕР·РґР°РІР°С‚СЊ РїР°СЂРѕР»СЊ
                }
                is AuthEvent.Error -> {
                    Toast.makeText(context, event.message, Toast.LENGTH_LONG).show()
                }
            }
        }
    }

    Column(
        modifier = Modifier
            .fillMaxSize()
            .background(MatuleWhite)
            .verticalScroll(rememberScrollState())
            .padding(horizontal = 20.dp)
            .padding(bottom = 40.dp)
    ) {

        // Р—Р°РіРѕР»РѕРІРѕРє
        Spacer(modifier = Modifier.height(76.dp)) // РћС‚СЃС‚СѓРї СЃРІРµСЂС…Сѓ РїРѕ РјР°РєРµС‚Сѓ
        Text(
            text = "РЎРѕР·РґР°РЅРёРµ РџСЂРѕС„РёР»СЏ",
            style = Title1.copy(fontWeight = FontWeight.Bold),
            color = MatuleBlack
        )

        Spacer(modifier = Modifier.height(8.dp))

        // РћРїРёСЃР°РЅРёРµ (СЃРµСЂС‹Р№ С‚РµРєСЃС‚)
        Text(
            text = "Р‘РµР· РїСЂРѕС„РёР»СЏ РІС‹ РЅРµ СЃРјРѕР¶РµС‚Рµ СЃРѕР·РґР°РІР°С‚СЊ РїСЂРѕРµРєС‚С‹.",
            style = Caption,
            color = MatuleTextGray
        )
        Text(
            text = "Р’ РїСЂРѕС„РёР»Рµ Р±СѓРґСѓС‚ С…СЂР°РЅРёС‚СЊСЃСЏ СЂРµР·СѓР»СЊС‚Р°С‚С‹ РїСЂРѕРµРєС‚РѕРІ Рё РІР°С€Рё РѕРїРёСЃР°РЅРёСЏ.",
            style = Caption,
            color = MatuleTextGray
        )

        Spacer(modifier = Modifier.height(30.dp))

        // РџРѕР»СЏ РІРІРѕРґР°

        // РРјСЏ
        MatuleTextField(
            value = name,
            onValueChange = { name = it },
            placeholder = "РРјСЏ"
        )
        Spacer(modifier = Modifier.height(16.dp))

        // РћС‚С‡РµСЃС‚РІРѕ
        MatuleTextField(
            value = patronymic,
            onValueChange = { patronymic = it },
            placeholder = "РћС‚С‡РµСЃС‚РІРѕ"
        )
        Spacer(modifier = Modifier.height(16.dp))

        // Р¤Р°РјРёР»РёСЏ
        MatuleTextField(
            value = surname,
            onValueChange = { surname = it },
            placeholder = "Р¤Р°РјРёР»РёСЏ"
        )
        Spacer(modifier = Modifier.height(16.dp))

        // Р”Р°С‚Р° СЂРѕР¶РґРµРЅРёСЏ
        MatuleTextField(
            value = birthDate,
            onValueChange = {}, // РќРµ РґР°РµРј РїРёСЃР°С‚СЊ СЂСѓРєР°РјРё
            placeholder = "Р”Р°С‚Р° СЂРѕР¶РґРµРЅРёСЏ",
            readOnly = true, // РљР»Р°РІРёР°С‚СѓСЂР° РЅРµ РЅСѓР¶РЅР°
            onClick = { showDatePicker = true }, // РћС‚РєСЂС‹РІР°РµРј РєР°Р»РµРЅРґР°СЂСЊ
        )
        Spacer(modifier = Modifier.height(16.dp))

        var isGenderMenuExpanded by remember { mutableStateOf(false) }

        Box(modifier = Modifier.fillMaxWidth()) {
            MatuleTextField(
                value = gender,
                onValueChange = {}, // РџСѓСЃС‚Рѕ, С‚Р°Рє РєР°Рє РјС‹ РЅРµ РґР°РµРј РїРёСЃР°С‚СЊ СЂСѓРєР°РјРё
                placeholder = "РџРѕР»",
                readOnly = true, // РљР»Р°РІРёР°С‚СѓСЂР° РЅРµ РѕС‚РєСЂРѕРµС‚СЃСЏ
                onClick = { isGenderMenuExpanded = true }, // РџСЂРё РєР»РёРєРµ РѕС‚РєСЂС‹РІР°РµРј РјРµРЅСЋ
                trailingIcon = {
                    Icon(
                        painter = painterResource(id = UiKitR.drawable.ic_chevron_down),
                        contentDescription = null,
                        tint = MatuleTextGray
                    )
                }
            )

            // РЎР°РјРѕ РјРµРЅСЋ
            DropdownMenu(
                expanded = isGenderMenuExpanded,
                onDismissRequest = { isGenderMenuExpanded = false },
                modifier = Modifier
                    .background(MatuleWhite)
                    .fillMaxWidth(0.9f)
            ) {
                DropdownMenuItem(
                    text = { Text("РњСѓР¶СЃРєРѕР№", style = BodyText) },
                    onClick = {
                        gender = "РњСѓР¶СЃРєРѕР№"
                        isGenderMenuExpanded = false
                    }
                )
                DropdownMenuItem(
                    text = { Text("Р–РµРЅСЃРєРёР№", style = BodyText) },
                    onClick = {
                        gender = "Р–РµРЅСЃРєРёР№"
                        isGenderMenuExpanded = false
                    }
                )
            }
        }
        Spacer(modifier = Modifier.height(16.dp))

        // РџРѕС‡С‚Р°
        MatuleTextField(
            value = email,
            onValueChange = {
                email = it
                isEmailError = false // РЎР±СЂР°СЃС‹РІР°РµРј РѕС€РёР±РєСѓ РїСЂРё РІРІРѕРґРµ
            },
            placeholder = "РџРѕС‡С‚Р°",
            isError = isEmailError, // РљСЂР°СЃРЅР°СЏ СЂР°РјРєР°
            errorMessage = if (isEmailError) "РСЃРїРѕР»СЊР·СѓР№С‚Рµ a-z, 0-9 Рё РґРѕРјРµРЅ .ru" else null
        )

        Spacer(modifier = Modifier.height(40.dp))

        // РљРЅРѕРїРєР° Р”Р°Р»РµРµ
        MatuleButton(
            text = "Р”Р°Р»РµРµ",
            onClick = {
                if (validateEmail(email)) {
                    viewModel.saveTmpUserInfo(email, name, surname)
                    onNextClick()
                } else {
                    isEmailError = true
                }
            },
            enabled = name.isNotEmpty() && surname.isNotEmpty() && email.isNotEmpty()
        )
        if (showDatePicker) {
            MatuleDatePicker(
                onDateSelected = { millis ->
                    if (millis != null) {
                        birthDate = convertMillisToDate(millis)
                    }
                },
                onDismiss = { showDatePicker = false }
            )
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\auth\SignUpViewModel.kt ===

package com.aiden3630.presentation.auth

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.aiden3630.domain.repository.AuthRepository
import dagger.hilt.android.lifecycle.HiltViewModel
import kotlinx.coroutines.channels.Channel
import kotlinx.coroutines.flow.receiveAsFlow
import kotlinx.coroutines.launch
import javax.inject.Inject

@HiltViewModel
class SignUpViewModel @Inject constructor(
    private val repository: AuthRepository,
    private val tokenManager: com.aiden3630.data.manager.TokenManager,
    private val notificationService: com.aiden3630.presentation.utils.NotificationService
) : ViewModel() {

    private val _signUpEvent = Channel<AuthEvent>()
    val signUpEvent = _signUpEvent.receiveAsFlow()

    fun onSignUpClick(name: String, surname: String, email: String, pass: String) {
        viewModelScope.launch {
            try {
                repository.signUp(email, pass, name, surname)
                notificationService.showNotification("Р РµРіРёСЃС‚СЂР°С†РёСЏ", "Р’С‹ СѓСЃРїРµС€РЅРѕ Р·Р°СЂРµРіРёСЃС‚СЂРёСЂРѕРІР°Р»РёСЃСЊ!")
                _signUpEvent.send(AuthEvent.Success)
            } catch (e: Exception) {
                _signUpEvent.send(AuthEvent.Error(e.message ?: "РћС€РёР±РєР° СЂРµРіРёСЃС‚СЂР°С†РёРё"))
            }
        }
    }
    fun saveTmpUserInfo(email: String, name: String, surname: String) {
        viewModelScope.launch {
            tokenManager.saveUserInfo(email, name, surname)
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\components\CartItem.kt ===

package com.aiden3630.presentation.components

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.theme.MatuleBlack
import com.aiden3630.presentation.theme.MatuleError
import com.aiden3630.presentation.theme.MatuleInputBg
import com.aiden3630.presentation.theme.MatuleWhite
import com.aiden3630.presentation.R as UiKitR

@Composable
fun CartItem(
    title: String,
    price: String,
    count: Int,
    onPlusClick: () -> Unit,
    onMinusClick: () -> Unit,
    onDeleteClick: () -> Unit
) {
    Box(
        modifier = Modifier
            .fillMaxWidth()
            .height(138.dp) // Р’С‹СЃРѕС‚Р° РїРѕ РјР°РєРµС‚Сѓ
            .shadow(4.dp, RoundedCornerShape(12.dp), spotColor = Color(0xFFE4E8F5))
            .background(MatuleWhite, RoundedCornerShape(12.dp))
            .padding(16.dp)
    ) {
        Column(modifier = Modifier.fillMaxSize()) {
            Row(modifier = Modifier.fillMaxWidth()) {
                // РќР°Р·РІР°РЅРёРµ С‚РѕРІР°СЂР°
                Text(
                    text = title,
                    style = Headline.copy(fontWeight = FontWeight.Medium),
                    modifier = Modifier.weight(1f),
                    maxLines = 2
                )

                // РРєРѕРЅРєР° СѓРґР°Р»РµРЅРёСЏ
                Icon(
                    painter = painterResource(id = UiKitR.drawable.ic_delete),
                    contentDescription = "Delete",
                    tint = MatuleError,
                    modifier = Modifier
                        .size(20.dp)
                        .clickable { onDeleteClick() }
                )
            }

            Spacer(modifier = Modifier.weight(1f))

            // Р¦РµРЅР° Рё РЎС‡РµС‚С‡РёРє
            Row(
                modifier = Modifier.fillMaxWidth(),
                verticalAlignment = Alignment.CenterVertically
            ) {
                Text(
                    text = price,
                    style = Title3.copy(fontWeight = FontWeight.SemiBold),
                    color = MatuleBlack
                )

                Spacer(modifier = Modifier.weight(1f))

                // РЎС‡РµС‚С‡РёРє
                Row(
                    verticalAlignment = Alignment.CenterVertically,
                    modifier = Modifier
                        .background(MatuleInputBg, RoundedCornerShape(8.dp))
                        .padding(horizontal = 8.dp, vertical = 4.dp)
                ) {
                    Icon(
                        painter = painterResource(id = UiKitR.drawable.ic_minus),
                        contentDescription = "Minus",
                        modifier = Modifier.size(20.dp).clickable { onMinusClick() },
                        tint = MatuleBlack
                    )

                    Spacer(modifier = Modifier.width(12.dp))
                    Text(text = "$count С€С‚", style = BodyText)
                    Spacer(modifier = Modifier.width(12.dp))

                    Icon(
                        painter = painterResource(id = UiKitR.drawable.ic_plus),
                        contentDescription = "Plus",
                        modifier = Modifier.size(20.dp).clickable { onPlusClick() },
                        tint = MatuleBlack
                    )
                }
            }
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\components\MatuleBottomBar.kt ===

package com.aiden3630.presentation.components

import androidx.annotation.DrawableRes
import androidx.compose.foundation.layout.size
import androidx.compose.material3.*
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.theme.MatuleBlue
import com.aiden3630.presentation.theme.MatuleGrayIcon
import com.aiden3630.presentation.theme.MatuleWhite

// РњРѕРґРµР»СЊ РґР°РЅРЅС‹С… РґР»СЏ РѕРґРЅРѕР№ РІРєР»Р°РґРєРё
data class BottomTab(
    val route: String,
    val title: String,
    @DrawableRes val icon: Int
)

@Composable
fun MatuleBottomBar(
    currentRoute: String?,
    onNavigate: (String) -> Unit,
    tabs: List<BottomTab>
) {
    NavigationBar(
        containerColor = MatuleWhite,
        contentColor = MatuleBlue,
        tonalElevation = 8.dp
    ) {
        tabs.forEach { tab ->
            val selected = currentRoute == tab.route

            NavigationBarItem(
                selected = selected,
                onClick = { onNavigate(tab.route) },
                icon = {
                    Icon(
                        painter = painterResource(id = tab.icon),
                        contentDescription = tab.title,
                        modifier = Modifier.size(24.dp)
                    )
                },
                label = {
                    Text(
                        text = tab.title,
                        style = Caption2.copy(fontSize = 10.sp) // РњР°Р»РµРЅСЊРєРёР№ С‚РµРєСЃС‚
                    )
                },
                colors = NavigationBarItemDefaults.colors(
                    selectedIconColor = MatuleBlue,
                    selectedTextColor = MatuleBlue,
                    indicatorColor = MatuleWhite,
                    unselectedIconColor = MatuleGrayIcon,
                    unselectedTextColor = MatuleGrayIcon
                )
            )
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\components\MatuleButton.kt ===

package com.aiden3630.presentation.components

import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.theme.MatuleBlue
import com.aiden3630.presentation.theme.MatuleBlueDisable
import com.aiden3630.presentation.theme.MatuleWhite

@Composable
fun MatuleButton(
    text: String,
    onClick: () -> Unit,
    modifier: Modifier = Modifier,
    enabled: Boolean = true
) {
    Button(
        onClick = onClick,
        enabled = enabled,
        modifier = modifier
            .fillMaxWidth() // РљРЅРѕРїРєР° РЅР° РІСЃСЋ С€РёСЂРёРЅСѓ
            .height(56.dp), // Р’С‹СЃРѕС‚Р° РїРѕ РјР°РєРµС‚Сѓ
        shape = RoundedCornerShape(14.dp), // Р—Р°РєСЂСѓРіР»РµРЅРёРµ
        colors = ButtonDefaults.buttonColors(
            containerColor = MatuleBlue,         // РЎРёРЅРёР№ С„РѕРЅ
            contentColor = MatuleWhite,          // Р‘РµР»С‹Р№ С‚РµРєСЃС‚
            disabledContainerColor = MatuleBlueDisable, // Р‘Р»РµРґРЅРѕ-СЃРёРЅРёР№
            disabledContentColor = MatuleWhite
        )
    ) {
        Text(
            text = text,
            style = ButtonText // РЎС‚РёР»СЊ С‚РµРєСЃС‚Р° РєРЅРѕРїРєРё
        )
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\components\MatuleChip.kt ===

package com.aiden3630.presentation.components

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.theme.MatuleBlack
import com.aiden3630.presentation.theme.MatuleBlue
import com.aiden3630.presentation.theme.MatuleInputBg
import com.aiden3630.presentation.theme.MatuleWhite

@Composable
fun MatuleChip(
    text: String,
    isSelected: Boolean,
    onClick: () -> Unit
) {
    Box(
        modifier = Modifier
            .clip(RoundedCornerShape(10.dp))
            .background(if (isSelected) MatuleBlue else MatuleInputBg)
            .clickable { onClick() }
            .padding(horizontal = 20.dp, vertical = 14.dp),
        contentAlignment = Alignment.Center
    ) {
        Text(
            text = text,
            style = BodyText.copy(
                fontSize = 15.sp,
                fontWeight = FontWeight.Medium
            ),
            color = if (isSelected) MatuleWhite else MatuleBlack
        )
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\components\MatuleDatePicker.kt ===

package com.aiden3630.presentation.components

import androidx.compose.material3.DatePicker
import androidx.compose.material3.DatePickerDefaults
import androidx.compose.material3.DatePickerDialog
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Text
import androidx.compose.material3.TextButton
import androidx.compose.material3.rememberDatePickerState
import androidx.compose.runtime.Composable
import androidx.compose.ui.graphics.Color
import com.aiden3630.presentation.theme.MatuleBlue

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun MatuleDatePicker(
    onDateSelected: (Long?) -> Unit,
    onDismiss: () -> Unit
) {
    val datePickerState = rememberDatePickerState()

    DatePickerDialog(
        onDismissRequest = onDismiss,
        confirmButton = {
            TextButton(
                onClick = {
                    onDateSelected(datePickerState.selectedDateMillis)
                    onDismiss()
                }
            ) {
                Text("РћРљ", color = MatuleBlue)
            }
        },
        dismissButton = {
            TextButton(onClick = onDismiss) {
                Text("РћС‚РјРµРЅР°", color = MatuleBlue)
            }
        },
        colors = DatePickerDefaults.colors(
            containerColor = Color.White
        )
    ) {
        DatePicker(
            state = datePickerState,
            colors = DatePickerDefaults.colors(
                containerColor = Color.White
            )
        )
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\components\MatuleSearchField.kt ===

package com.aiden3630.presentation.components

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.text.BasicTextField
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.SolidColor
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.theme.MatuleBlack
import com.aiden3630.presentation.theme.MatuleBlue
import com.aiden3630.presentation.theme.MatuleInputBg
import com.aiden3630.presentation.theme.MatulePlaceholder
import com.aiden3630.presentation.theme.MatuleTextGray
import com.aiden3630.presentation.R
@Composable
fun MatuleSearchField(
    value: String,
    onValueChange: (String) -> Unit,
    modifier: Modifier = Modifier,
    placeholder: String = "РСЃРєР°С‚СЊ РѕРїРёСЃР°РЅРёСЏ"
) {
    Box(
        modifier = modifier
            .fillMaxWidth()
            .height(52.dp)
            .background(MatuleInputBg, RoundedCornerShape(14.dp)),
        contentAlignment = Alignment.CenterStart
    ) {
        Row(
            modifier = Modifier
                .fillMaxWidth()
                .padding(horizontal = 14.dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            // РРєРѕРЅРєР° Р›СѓРїС‹
            Icon(
                painter = painterResource(id = R.drawable.ic_search),
                contentDescription = "Search",
                tint = MatuleTextGray,
                modifier = Modifier.size(24.dp)
            )

            Spacer(modifier = Modifier.width(12.dp))

            // РџРѕР»Рµ РІРІРѕРґР°
            BasicTextField(
                value = value,
                onValueChange = onValueChange,
                modifier = Modifier.weight(1f),
                singleLine = true,
                textStyle = BodyText.copy(color = MatuleBlack),
                cursorBrush = SolidColor(MatuleBlue),
                decorationBox = { innerTextField ->
                    if (value.isEmpty()) {
                        Text(
                            text = placeholder,
                            style = BodyText.copy(color = MatulePlaceholder)
                        )
                    }
                    innerTextField()
                }
            )
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\components\MatuleSocialButton.kt ===

package com.aiden3630.presentation.components

import androidx.annotation.DrawableRes
import androidx.compose.foundation.BorderStroke
import androidx.compose.foundation.Image
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.theme.MatuleBlack
import com.aiden3630.presentation.theme.MatuleInputStroke
import com.aiden3630.presentation.theme.MatuleWhite

@Composable
fun MatuleSocialButton(
    text: String,
    @DrawableRes iconRes: Int,
    onClick: () -> Unit,
    modifier: Modifier = Modifier
) {
    Button(
        onClick = onClick,
        modifier = modifier
            .fillMaxWidth()
            .height(60.dp),
        shape = RoundedCornerShape(12.dp),
        colors = ButtonDefaults.buttonColors(
            containerColor = MatuleWhite,
            contentColor = MatuleBlack
        ),
        border = BorderStroke(1.dp, MatuleInputStroke)
    ) {
        Image(
            painter = painterResource(id = iconRes),
            contentDescription = null,
            modifier = Modifier.size(24.dp)
        )
        Spacer(modifier = Modifier.width(12.dp))
        Text(
            text = text,
            style = BodyText.copy(fontWeight = FontWeight.Medium), // Р§СѓС‚СЊ Р¶РёСЂРЅРµРµ РѕР±С‹С‡РЅРѕРіРѕ
            fontSize = 17.sp,
            color = MatuleBlack
        )
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\components\MatuleTextField.kt ===

package com.aiden3630.presentation.components

import androidx.compose.foundation.background
import androidx.compose.foundation.border
import androidx.compose.foundation.clickable
import androidx.compose.foundation.interaction.MutableInteractionSource
import androidx.compose.foundation.interaction.collectIsPressedAsState
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.text.BasicTextField
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.focus.onFocusChanged
import androidx.compose.ui.graphics.SolidColor
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.input.PasswordVisualTransformation
import androidx.compose.ui.text.input.VisualTransformation
import androidx.compose.ui.unit.dp
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.theme.MatuleBlack
import com.aiden3630.presentation.theme.MatuleBlue
import com.aiden3630.presentation.theme.MatuleBlueFocused
import com.aiden3630.presentation.theme.MatuleError
import com.aiden3630.presentation.theme.MatuleInputBg
import com.aiden3630.presentation.theme.MatuleInputIcon
import com.aiden3630.presentation.theme.MatuleInputStroke
import com.aiden3630.presentation.theme.MatulePlaceholder
import com.aiden3630.presentation.theme.MatuleRedBg
import com.aiden3630.presentation.R

@Composable
fun MatuleTextField(
    value: String,
    onValueChange: (String) -> Unit,
    placeholder: String,
    modifier: Modifier = Modifier,
    isPassword: Boolean = false,
    isError: Boolean = false,
    errorMessage: String? = null,
    trailingIcon: @Composable (() -> Unit)? = null,
    readOnly: Boolean = false, // Р•СЃР»Рё true, РєР»Р°РІРёР°С‚СѓСЂР° РЅРµ РѕС‚РєСЂРѕРµС‚СЃСЏ
    onClick: (() -> Unit)? = null // Р§С‚Рѕ РґРµР»Р°С‚СЊ РїСЂРё РєР»РёРєРµ РЅР° РїРѕР»Рµ
) {
    var isFocused by remember { mutableStateOf(false) }
    var isPasswordVisible by remember { mutableStateOf(false) }

    // Р”Р»СЏ РѕС‚СЃР»РµР¶РёРІР°РЅРёСЏ РЅР°Р¶Р°С‚РёСЏ РІ СЂРµР¶РёРјРµ readOnly
    val interactionSource = remember { MutableInteractionSource() }
    if (readOnly && onClick != null) {
        val isPressed by interactionSource.collectIsPressedAsState()
        if (isPressed) {
            LaunchedEffect(Unit) { onClick() }
        }
    }

    Column(modifier = modifier.fillMaxWidth()) {

        Box(
            modifier = Modifier
                .fillMaxWidth()
                .height(48.dp)
                .background(
                    color = if (isError) MatuleRedBg else MatuleInputBg,
                    shape = RoundedCornerShape(14.dp)
                )
                .border(
                    width = 1.dp,
                    color = when {
                        isError -> MatuleError
                        isFocused -> MatuleBlueFocused
                        else -> MatuleInputStroke
                    },
                    shape = RoundedCornerShape(14.dp)
                )
                .clickable(enabled = readOnly && onClick != null) { onClick?.invoke() },
            contentAlignment = Alignment.CenterStart
        ) {
            BasicTextField(
                value = value,
                onValueChange = onValueChange,
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(horizontal = 14.dp)
                    .padding(end = if (isPassword || trailingIcon != null) 40.dp else 0.dp)
                    .onFocusChanged { isFocused = it.isFocused },
                singleLine = true,
                readOnly = readOnly, // Р—Р°РїСЂРµС‰Р°РµС‚ РєР»Р°РІРёР°С‚СѓСЂСѓ
                enabled = !readOnly, // РћС‚РєР»СЋС‡Р°РµРј СЃС‚Р°РЅРґР°СЂС‚РЅРѕРµ РїРѕРІРµРґРµРЅРёРµ РІРІРѕРґР°, РµСЃР»Рё readOnly
                textStyle = BodyText.copy(color = MatuleBlack),
                cursorBrush = SolidColor(MatuleBlue),
                visualTransformation = if (isPassword && !isPasswordVisible) PasswordVisualTransformation('*') else VisualTransformation.None,
                decorationBox = { innerTextField ->
                    if (value.isEmpty()) {
                        Text(
                            text = placeholder,
                            style = BodyText.copy(color = MatulePlaceholder)
                        )
                    }
                    innerTextField()
                }
            )

            // РРєРѕРЅРєРё
            Box(modifier = Modifier.align(Alignment.CenterEnd).padding(end = 12.dp)) {
                if (isPassword) {
                    IconButton(onClick = { isPasswordVisible = !isPasswordVisible }) {
                        Icon(
                            painter = painterResource(id = if (isPasswordVisible) R.drawable.ic_eye else R.drawable.ic_eye_off),
                            contentDescription = "Toggle password",
                            tint = MatuleInputIcon
                        )
                    }
                } else if (trailingIcon != null) {
                    trailingIcon()
                }
            }
        }

        if (isError && errorMessage != null) {
            Text(
                text = errorMessage,
                color = MatuleError,
                style = Caption,
                modifier = Modifier.padding(start = 14.dp, top = 4.dp)
            )
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\components\MatuleToggle.kt ===

package com.aiden3630.presentation.components

import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.width
import androidx.compose.material3.Switch
import androidx.compose.material3.SwitchDefaults
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.unit.dp
import com.aiden3630.presentation.theme.MatuleBlue
import com.aiden3630.presentation.theme.MatuleInputStroke
import com.aiden3630.presentation.theme.MatuleWhite

@Composable
fun MatuleToggle(
    checked: Boolean,
    onCheckedChange: (Boolean) -> Unit
) {
    // РСЃРїРѕР»СЊР·СѓРµРј СЃС‚Р°РЅРґР°СЂС‚РЅС‹Р№ Switch, РЅРѕ РєСЂР°СЃРёРј РµРіРѕ РїРѕРґ РјР°РєРµС‚
    Switch(
        checked = checked,
        onCheckedChange = onCheckedChange,
        colors = SwitchDefaults.colors(
            checkedThumbColor = MatuleWhite,
            checkedTrackColor = MatuleBlue,
            uncheckedThumbColor = MatuleWhite,
            uncheckedTrackColor = MatuleInputStroke,
            uncheckedBorderColor = Color.Transparent,
            checkedBorderColor = Color.Transparent
        ),
        modifier = Modifier
            .width(48.dp) // Р Р°Р·РјРµСЂС‹ РёР· CSS
            .height(28.dp)
    )
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\components\ProductCard.kt ===

package com.aiden3630.presentation.components

import androidx.compose.foundation.BorderStroke
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.style.TextOverflow
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.aiden3630.presentation.theme.*

@Composable
fun ProductCard(
    title: String,
    price: String,
    category: String = "РњСѓР¶СЃРєР°СЏ РѕРґРµР¶РґР°", // Р”РѕР±Р°РІРёР» РїРѕР»Рµ РґР»СЏ РєР°С‚РµРіРѕСЂРёРё
    isInCart: Boolean = false,
    onAddClick: () -> Unit = {},
    onRemoveClick: () -> Unit = {},
    onClick: () -> Unit = {}
) {
    Box(
        modifier = Modifier
            .fillMaxWidth()
            .height(136.dp) // Р’С‹СЃРѕС‚Р° РєР°СЂС‚РѕС‡РєРё
            .shadow(
                elevation = 4.dp,
                shape = RoundedCornerShape(12.dp),
                spotColor = Color(0xFFE4E8F5)
            )
            .background(MatuleWhite, RoundedCornerShape(12.dp))
            .clip(RoundedCornerShape(12.dp))
            .clickable { onClick() }
            .padding(16.dp)
    ) {
        // Р’РµСЂС…РЅСЏСЏ С‡Р°СЃС‚СЊ: РќР°Р·РІР°РЅРёРµ Рё РљР°С‚РµРіРѕСЂРёСЏ
        Column(
            modifier = Modifier
                .fillMaxWidth()
                .padding(bottom = 40.dp)
        ) {
            // РќР°Р·РІР°РЅРёРµ С‚РѕРІР°СЂР°
            Text(
                text = title,
                style = Headline.copy(
                    fontWeight = FontWeight.Medium,
                    fontSize = 16.sp
                ),
                maxLines = 2,
                overflow = TextOverflow.Ellipsis
            )

            Spacer(modifier = Modifier.height(6.dp))

            // РљР°С‚РµРіРѕСЂРёСЏ
            Text(
                text = category,
                style = Caption.copy(color = MatuleTextGray)
            )
        }

        // Р¦РµРЅР°
        Text(
            text = price,
            style = Title3.copy(fontWeight = FontWeight.SemiBold),
            color = MatuleBlack,
            modifier = Modifier.align(Alignment.BottomStart)
        )

        // РљРЅРѕРїРєР°
        val buttonModifier = Modifier
            .align(Alignment.BottomEnd)
            .height(40.dp)
            .width(110.dp)

        if (isInCart) {
            Button(
                onClick = onRemoveClick,
                modifier = buttonModifier,
                shape = RoundedCornerShape(10.dp),
                colors = ButtonDefaults.buttonColors(containerColor = MatuleWhite),
                border = BorderStroke(1.dp, MatuleBlue),
                contentPadding = PaddingValues(0.dp)
            ) {
                Text(
                    text = "РЈР±СЂР°С‚СЊ",
                    style = Caption.copy(fontWeight = FontWeight.SemiBold, color = MatuleBlue)
                )
            }
        } else {
            Button(
                onClick = onAddClick,
                modifier = buttonModifier,
                shape = RoundedCornerShape(10.dp),
                colors = ButtonDefaults.buttonColors(containerColor = MatuleBlue),
                contentPadding = PaddingValues(0.dp)
            ) {
                Text(
                    text = "Р”РѕР±Р°РІРёС‚СЊ",
                    style = Caption.copy(fontWeight = FontWeight.SemiBold, color = MatuleWhite)
                )
            }
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\components\ProjectCard.kt ===

package com.aiden3630.presentation.components

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.theme.MatuleBlack
import com.aiden3630.presentation.theme.MatuleBlue
import com.aiden3630.presentation.theme.MatuleInputBg
import com.aiden3630.presentation.theme.MatuleTextGray
import com.aiden3630.presentation.theme.MatuleWhite
import coil.compose.AsyncImage

@Composable
fun ProjectCard(
    title: String,
    date: String,
    imageUri: String? = null,
    onClick: () -> Unit
) {
    Box(
        modifier = Modifier
            .fillMaxWidth()
            .height(180.dp)
            .shadow(4.dp, RoundedCornerShape(12.dp), spotColor = Color(0xFFE4E8F5))
            .background(MatuleWhite, RoundedCornerShape(12.dp))
            .clickable { onClick() }
            .padding(16.dp)
    ) {
        Column(modifier = Modifier.fillMaxSize()) {

            Text(
                text = title,
                style = Headline.copy(fontWeight = FontWeight.SemiBold),
                color = MatuleBlack
            )

            Spacer(modifier = Modifier.height(12.dp))

            Box(
                modifier = Modifier
                    .fillMaxWidth()
                    .weight(1f)
                    .clip(RoundedCornerShape(8.dp))
                    .background(MatuleInputBg),
                contentAlignment = Alignment.Center
            ) {
                if (imageUri != null) {
                    AsyncImage(
                        model = imageUri,
                        contentDescription = null,
                        contentScale = ContentScale.Crop,
                        modifier = Modifier.fillMaxSize()
                    )
                }
            }

            Spacer(modifier = Modifier.height(12.dp))

            // РќРёР¶РЅСЏСЏ СЃС‚СЂРѕРєР°
            Row(
                modifier = Modifier.fillMaxWidth(),
                verticalAlignment = Alignment.CenterVertically,
                horizontalArrangement = Arrangement.SpaceBetween
            ) {
                Text(
                    text = date,
                    style = Caption,
                    color = MatuleTextGray
                )

                Button(
                    onClick = onClick,
                    modifier = Modifier.height(36.dp).width(100.dp),
                    shape = RoundedCornerShape(8.dp),
                    colors = ButtonDefaults.buttonColors(containerColor = MatuleBlue),
                    contentPadding = PaddingValues(0.dp)
                ) {
                    Text(
                        text = "РћС‚РєСЂС‹С‚СЊ",
                        style = Caption.copy(color = MatuleWhite, fontWeight = FontWeight.SemiBold)
                    )
                }
            }
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\CartScreen.kt ===

package com.aiden3630.presentation.main

import android.widget.Toast
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Button
import androidx.compose.material3.ButtonDefaults
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import com.aiden3630.presentation.components.CartItem
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.theme.MatuleBackground
import com.aiden3630.presentation.theme.MatuleBlack
import com.aiden3630.presentation.theme.MatuleBlue
import com.aiden3630.presentation.theme.MatuleWhite
import com.aiden3630.presentation.R as UiKitR
import androidx.hilt.navigation.compose.hiltViewModel
import com.aiden3630.presentation.main.CartViewModel

@Composable
fun CartScreen(
    onBackClick: () -> Unit = {},onGoHome: () -> Unit = {},
    viewModel: CartViewModel = hiltViewModel()
) {
    // РџРѕР»СѓС‡Р°РµРј РґР°РЅРЅС‹Рµ РёР· VM
    val context = LocalContext.current
    val items by viewModel.cartItems.collectAsState()
    val totalSum by viewModel.totalSum.collectAsState()

    LaunchedEffect(true) {
        viewModel.cartEvent.collect { event ->
            when (event) {
                is CartEvent.OrderSuccess -> {
                    Toast.makeText(context, "Р—Р°РєР°Р· СѓСЃРїРµС€РЅРѕ РѕС„РѕСЂРјР»РµРЅ!", Toast.LENGTH_LONG).show()
                    onGoHome() // РЈС…РѕРґРёРј РЅР° РіР»Р°РІРЅСѓСЋ
                }
            }
        }
    }
    Column(
        modifier = Modifier
            .fillMaxSize()
            .background(MatuleBackground)
            .statusBarsPadding()
            .padding(horizontal = 20.dp)
    ) {
        // РҐРµРґРµСЂ
        Spacer(modifier = Modifier.height(20.dp))
        Box(modifier = Modifier.fillMaxWidth()) {
            Box(
                modifier = Modifier
                    .size(32.dp)
                    .background(MatuleWhite, RoundedCornerShape(8.dp))
                    .clickable { onBackClick() }
                    .align(Alignment.CenterStart),
                contentAlignment = Alignment.Center
            ) {
                Icon(
                    painter = painterResource(id = UiKitR.drawable.ic_chevron_left),
                    contentDescription = "Back",
                    tint = MatuleBlack
                )
            }
            Text(text = "РљРѕСЂР·РёРЅР°", style = Title2, modifier = Modifier.align(Alignment.Center))

            // РРєРѕРЅРєР° РјСѓСЃРѕСЂРєРё СЃРїСЂР°РІР°
            Icon(
                painter = painterResource(id = UiKitR.drawable.ic_delete),
                contentDescription = "Clear",
                tint = MatuleBlack,
                modifier = Modifier.align(Alignment.CenterEnd).size(24.dp) .clickable { viewModel.onClearCartClick() }
            )
        }

        Spacer(modifier = Modifier.height(30.dp))
        Text(text = "${items.size} С‚РѕРІР°СЂРѕРІ", style = BodyText)
        Spacer(modifier = Modifier.height(16.dp))

        // РЎРїРёСЃРѕРє С‚РѕРІР°СЂРѕРІ
        if (items.isEmpty()) {
            Box(modifier = Modifier.weight(1f).fillMaxWidth(), contentAlignment = Alignment.Center) {
                Text("РљРѕСЂР·РёРЅР° РїСѓСЃС‚Р°", style = Title3, color = MatuleTextGray)
            }
        } else {
            LazyColumn(
                modifier = Modifier.weight(1f),
                verticalArrangement = Arrangement.spacedBy(16.dp)
            ) {
                items(items.size) { index ->
                    val cartItem = items[index]
                    CartItem(
                        title = cartItem.product.title,
                        price = "${cartItem.product.price} в‚Ѕ",
                        count = cartItem.quantity,
                        onPlusClick = { viewModel.onPlusClick(cartItem.product) },
                        onMinusClick = { viewModel.onMinusClick(cartItem.product) },
                        onDeleteClick = { viewModel.onDeleteClick(cartItem.product) }
                    )
                }
            }
        }

        // РС‚РѕРіРѕ
        if (items.isNotEmpty()) {
            Column {
                Row(
                    modifier = Modifier.fillMaxWidth(),
                    horizontalArrangement = Arrangement.SpaceBetween
                ) {
                    Text("РЎСѓРјРјР°", style = Title2)
                    Text("$totalSum в‚Ѕ", style = Title2)
                }
                Spacer(modifier = Modifier.height(30.dp))
                Button(
                    onClick = { viewModel.checkout() },
                    modifier = Modifier.fillMaxWidth().height(56.dp),
                    shape = RoundedCornerShape(14.dp),
                    colors = ButtonDefaults.buttonColors(containerColor = MatuleBlue)
                ) {
                    Text("РџРµСЂРµР№С‚Рё Рє РѕС„РѕСЂРјР»РµРЅРёСЋ Р·Р°РєР°Р·Р°", style = ButtonText)
                }
                Spacer(modifier = Modifier.height(20.dp))
            }
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\CartViewModel.kt ===

package com.aiden3630.presentation.main

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.aiden3630.data.manager.CartManager
import com.aiden3630.domain.model.Product
import com.aiden3630.presentation.utils.NotificationService
import dagger.hilt.android.lifecycle.HiltViewModel
import kotlinx.coroutines.channels.Channel
import kotlinx.coroutines.flow.SharingStarted
import kotlinx.coroutines.flow.receiveAsFlow
import kotlinx.coroutines.flow.stateIn
import kotlinx.coroutines.launch
import javax.inject.Inject
@HiltViewModel
class CartViewModel @Inject constructor(
    private val cartManager: CartManager,
    private val notificationService: NotificationService
) : ViewModel() {

    // РџРѕРґРїРёСЃС‹РІР°РµРјСЃСЏ РЅР° РёР·РјРµРЅРµРЅРёСЏ РІ РјРµРЅРµРґР¶РµСЂРµ
    val cartItems = cartManager.cartItems
    private val _cartEvent = Channel<CartEvent>()
    val cartEvent = _cartEvent.receiveAsFlow()

    val totalSum = cartManager.totalPrice
        .stateIn(viewModelScope, SharingStarted.Lazily, 0)

    fun onPlusClick(product: Product) {
        cartManager.addToCart(product)
    }

    fun onMinusClick(product: Product) {
        cartManager.decreaseQuantity(product)
    }

    fun onDeleteClick(product: Product) {
        cartManager.removeFromCart(product)
    }

    fun onClearCartClick() {
        cartManager.clearCart()
    }
    fun checkout() {
        viewModelScope.launch {
            // Р—Р°РїРѕРјРёРЅР°РµРј СЃСѓРјРјСѓ РїРµСЂРµРґ РѕС‡РёСЃС‚РєРѕР№, С‡С‚РѕР±С‹ РїРѕРєР°Р·Р°С‚СЊ РІ СѓРІРµРґРѕРјР»РµРЅРёРё
            val currentSum = totalSum.value

            // Р§РёСЃС‚РёРј РєРѕСЂР·РёРЅСѓ
            cartManager.clearCart()

            // РЈРІРµРґРѕРјР»РµРЅРёРµ
            notificationService.showNotification(
                title = "Р—Р°РєР°Р· СѓСЃРїРµС€РЅРѕ РѕС„РѕСЂРјР»РµРЅ!",
                message = "РЎСѓРјРјР° Р·Р°РєР°Р·Р°: $currentSum в‚Ѕ. РЎРїР°СЃРёР±Рѕ Р·Р° РїРѕРєСѓРїРєСѓ!"
            )

            // РћС‚РїСЂР°РІР»СЏРµРј СЃРѕР±С‹С‚РёРµ РґР»СЏ РЅР°РІРёРіР°С†РёРё
            _cartEvent.send(CartEvent.OrderSuccess)
        }
    }
}
sealed class CartEvent {
    object OrderSuccess : CartEvent()
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\CatalogScreen.kt ===

package com.aiden3630.presentation.main

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.LazyRow
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.hilt.navigation.compose.hiltViewModel
import com.aiden3630.domain.model.Product
import com.aiden3630.presentation.components.MatuleChip
import com.aiden3630.presentation.components.MatuleSearchField
import com.aiden3630.presentation.components.ProductCard
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.R as UiKitR

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun CatalogScreen(
    onCartClick: () -> Unit = {},
    onProfileClick: () -> Unit = {},
    cartViewModel: CartViewModel = hiltViewModel(),
    catalogViewModel: CatalogViewModel = hiltViewModel()
) {
    val searchText by catalogViewModel.searchText.collectAsState()
    val selectedCategory by catalogViewModel.selectedCategory.collectAsState()
    val products by catalogViewModel.filteredProducts.collectAsState()

    val cartItems by cartViewModel.cartItems.collectAsState()
    val cartTotal by cartViewModel.totalSum.collectAsState()

    var selectedProductForSheet by remember { mutableStateOf<Product?>(null) }
    val sheetState = rememberModalBottomSheetState(skipPartiallyExpanded = true)

    val categories = listOf("Р’СЃРµ", "РњСѓР¶С‡РёРЅР°Рј", "Р–РµРЅС‰РёРЅР°Рј", "Р”РµС‚СЏРј", "РђРєСЃРµСЃСЃСѓР°СЂС‹")

    Box(modifier = Modifier.fillMaxSize()) {

        LazyColumn(
            modifier = Modifier
                .fillMaxSize()
                .background(MatuleWhite)
                .padding(horizontal = 20.dp),
            contentPadding = PaddingValues(bottom = 100.dp)
        ) {
            // РҐРµРґРµСЂ
            item {
                Spacer(modifier = Modifier.height(20.dp))
                Row(
                    verticalAlignment = Alignment.CenterVertically,
                    modifier = Modifier.fillMaxWidth()
                ) {
                    MatuleSearchField(
                        value = searchText,
                        onValueChange = { catalogViewModel.onSearchTextChange(it) },
                        modifier = Modifier.weight(1f)
                    )

                    Spacer(modifier = Modifier.width(14.dp))

                    Box(
                        modifier = Modifier
                            .size(48.dp)
                            .clickable { onProfileClick() },
                        contentAlignment = Alignment.CenterEnd
                    ) {
                        Icon(
                            painter = painterResource(id = UiKitR.drawable.ic_profile_black),
                            contentDescription = "Profile",
                            tint = MatuleBlack,
                            modifier = Modifier.size(32.dp)
                        )
                    }
                }
                Spacer(modifier = Modifier.height(24.dp))
            }

            // РљР°С‚РµРіРѕСЂРёРё
            item {
                LazyRow(horizontalArrangement = Arrangement.spacedBy(16.dp)) {
                    items(categories.size) { index ->
                        MatuleChip(
                            text = categories[index],
                            isSelected = selectedCategory == categories[index],
                            onClick = {
                                catalogViewModel.onCategoryChange(categories[index])
                            }
                        )
                    }
                }
                Spacer(modifier = Modifier.height(24.dp))
            }

            // РўРѕРІР°СЂС‹
            if (products.isEmpty()) {
                item {
                    Box(modifier = Modifier.fillMaxWidth().padding(top = 20.dp), contentAlignment = Alignment.Center) {
                        Text(
                            text = "РќРёС‡РµРіРѕ РЅРµ РЅР°Р№РґРµРЅРѕ",
                            style = BodyText,
                            color = MatuleTextGray
                        )
                    }
                }
            } else {
                items(items = products) { product: Product ->

                    val isProductInCart = cartItems.any { cartItem -> cartItem.product.id == product.id }

                    ProductCard(
                        title = product.title,
                        price = "${product.price} в‚Ѕ",
                        category = product.category,
                        isInCart = isProductInCart,

                        onAddClick = { cartViewModel.onPlusClick(product) },
                        onRemoveClick = { cartViewModel.onDeleteClick(product) },
                        onClick = { selectedProductForSheet = product }
                    )
                    Spacer(modifier = Modifier.height(16.dp))
                }
            }
        }

        // РљРЅРѕРїРєР° РљРѕСЂР·РёРЅС‹
        if (cartTotal > 0) {
            Box(
                modifier = Modifier
                    .align(Alignment.BottomCenter)
                    .padding(bottom = 20.dp, start = 20.dp, end = 20.dp)
                    .fillMaxWidth()
                    .height(56.dp)
                    .shadow(10.dp, RoundedCornerShape(12.dp), spotColor = Color(0x40000000))
                    .background(MatuleBlue, RoundedCornerShape(12.dp))
                    .clickable { onCartClick() }
            ) {
                Row(
                    modifier = Modifier.align(Alignment.CenterStart).padding(start = 16.dp),
                    verticalAlignment = Alignment.CenterVertically
                ) {
                    Icon(
                        painter = painterResource(id = UiKitR.drawable.ic_cart),
                        contentDescription = null,
                        tint = MatuleWhite,
                        modifier = Modifier.size(24.dp)
                    )
                    Spacer(modifier = Modifier.width(16.dp))
                    Text("Р’ РєРѕСЂР·РёРЅСѓ", style = Title3.copy(color = MatuleWhite, fontWeight = FontWeight.SemiBold))
                }
                Text("$cartTotal в‚Ѕ", style = Title3.copy(color = MatuleWhite, fontWeight = FontWeight.SemiBold), modifier = Modifier.align(Alignment.CenterEnd).padding(end = 16.dp))
            }
        }

        // РЁС‚РѕСЂРєР°
        if (selectedProductForSheet != null) {
            ModalBottomSheet(
                onDismissRequest = { selectedProductForSheet = null },
                sheetState = sheetState,
                containerColor = MatuleWhite,
                shape = RoundedCornerShape(topStart = 24.dp, topEnd = 24.dp)
            ) {
                ProductDetailsSheet(
                    title = selectedProductForSheet!!.title,
                    price = "${selectedProductForSheet!!.price} в‚Ѕ",
                    description = selectedProductForSheet!!.description,
                    onDismiss = { selectedProductForSheet = null },
                    onAddToCart = {
                        cartViewModel.onPlusClick(selectedProductForSheet!!)
                        selectedProductForSheet = null
                    }
                )
            }
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\CatalogViewModel.kt ===

package com.aiden3630.presentation.main

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.aiden3630.domain.model.Product
import com.aiden3630.domain.repository.ShopRepository
import dagger.hilt.android.lifecycle.HiltViewModel
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.SharingStarted
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.flow.combine
import kotlinx.coroutines.flow.stateIn
import kotlinx.coroutines.launch
import javax.inject.Inject

@HiltViewModel
class CatalogViewModel @Inject constructor(
    private val shopRepository: ShopRepository
) : ViewModel() {

    private val _allProducts = MutableStateFlow<List<Product>>(emptyList())

    private val _searchText = MutableStateFlow("")
    val searchText = _searchText.asStateFlow()

    private val _selectedCategory = MutableStateFlow("Р’СЃРµ")
    val selectedCategory = _selectedCategory.asStateFlow()

    // РќР°С€ РѕС‚С„РёР»СЊС‚СЂРѕРІР°РЅРЅС‹Р№ СЃРїРёСЃРѕРє
    val filteredProducts = combine(_allProducts, _searchText, _selectedCategory) { products, text, category ->
        products.filter { product ->
            val matchesSearch = product.title.contains(text, ignoreCase = true)
            val matchesCategory = if (category == "Р’СЃРµ") true else product.category == category
            matchesSearch && matchesCategory
        }
    }.stateIn(viewModelScope, SharingStarted.WhileSubscribed(5000), emptyList())

    init {
        loadProducts()
    }

    private fun loadProducts() {
        viewModelScope.launch {
            shopRepository.getProducts().collect { list ->
                _allProducts.value = list
            }
        }
    }

    fun onSearchTextChange(text: String) { _searchText.value = text }
    fun onCategoryChange(category: String) { _selectedCategory.value = category }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\CreateProjectScreen.kt ===

package com.aiden3630.presentation.main

import android.Manifest
import android.net.Uri
import android.widget.Toast
import androidx.activity.compose.rememberLauncherForActivityResult
import androidx.activity.result.contract.ActivityResultContracts
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.verticalScroll
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.hilt.navigation.compose.hiltViewModel
import coil.compose.AsyncImage
import com.aiden3630.presentation.components.MatuleButton
import com.aiden3630.presentation.components.MatuleDatePicker
import com.aiden3630.presentation.components.MatuleTextField
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.utils.convertMillisToDate
import com.aiden3630.presentation.utils.createImageFile
import com.aiden3630.presentation.R as UiKitR

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun CreateProjectScreen(
    onBackClick: () -> Unit = {},
    viewModel: CreateProjectViewModel = hiltViewModel()
) {

    val context = LocalContext.current

    // --- РЎРѕСЃС‚РѕСЏРЅРёСЏ РїРѕР»РµР№ ---
    var type by remember { mutableStateOf("") }
    var name by remember { mutableStateOf("") }
    var dateStart by remember { mutableStateOf("") }
    var dateEnd by remember { mutableStateOf("") }
    var toWhom by remember { mutableStateOf("") }
    var source by remember { mutableStateOf("") }
    var category by remember { mutableStateOf("") }

    // Р”Р»СЏ РєР°Р»РµРЅРґР°СЂСЏ
    var dateFieldType by remember { mutableStateOf<String?>(null) }

    // РЎРѕСЃС‚РѕСЏРЅРёРµ РєР°СЂС‚РёРЅРєРё
    var selectedImageUri by remember { mutableStateOf<Uri?>(null) }
    var tempCameraUri by remember { mutableStateOf<Uri?>(null) }

    // РЎРѕСЃС‚РѕСЏРЅРёРµ С€С‚РѕСЂРєРё
    var showPhotoSheet by remember { mutableStateOf(false) }
    val sheetState = rememberModalBottomSheetState(skipPartiallyExpanded = true)

    // РЎРїРёСЃРєРё
    val typeOptions = listOf("Р’СЏР·Р°РЅРёРµ СЃРїРёС†Р°РјРё", "Р’СЏР·Р°РЅРёРµ РєСЂСЋС‡РєРѕРј", "РЁРёС‚СЊРµ", "Р’С‹С€РёРІРєР°")
    val whoOptions = listOf("РЎРµР±Рµ", "Р’ РїРѕРґР°СЂРѕРє", "РќР° РїСЂРѕРґР°Р¶Сѓ", "Р”РµС‚СЏРј")
    val categoryOptions = listOf("РћРґРµР¶РґР°", "РРіСЂСѓС€РєРё", "РђРєСЃРµСЃСЃСѓР°СЂС‹", "Р”РѕРј")

    val galleryLauncher = rememberLauncherForActivityResult(
        contract = ActivityResultContracts.GetContent()
    ) { uri: Uri? ->
        uri?.let { selectedImageUri = it }
    }

    val cameraLauncher = rememberLauncherForActivityResult(
        contract = ActivityResultContracts.TakePicture()
    ) { success ->
        if (success && tempCameraUri != null) {
            selectedImageUri = tempCameraUri
        }
    }

    val permissionLauncher = rememberLauncherForActivityResult(
        contract = ActivityResultContracts.RequestPermission()
    ) { isGranted ->
        if (isGranted) {
            val uri = context.createImageFile()
            tempCameraUri = uri
            cameraLauncher.launch(uri)
        } else {
            Toast.makeText(context, "РќСѓР¶РµРЅ РґРѕСЃС‚СѓРї Рє РєР°РјРµСЂРµ", Toast.LENGTH_SHORT).show()
        }
    }

    Column(
        modifier = Modifier
            .fillMaxSize()
            .background(MatuleWhite)
            .padding(horizontal = 20.dp)
            .verticalScroll(rememberScrollState())
    ) {
        // РҐРµРґРµСЂ
        Spacer(modifier = Modifier.height(20.dp))
        Box(modifier = Modifier.fillMaxWidth()) {
            Icon(
                painter = painterResource(id = UiKitR.drawable.ic_chevron_left),
                contentDescription = "Back",
                modifier = Modifier
                    .size(24.dp)
                    .clickable { onBackClick() }
                    .align(Alignment.CenterStart)
            )
            Text(
                text = "РЎРѕР·РґР°С‚СЊ РїСЂРѕРµРєС‚",
                style = Title2,
                modifier = Modifier.align(Alignment.Center)
            )
        }
        Spacer(modifier = Modifier.height(30.dp))

        // РџРѕР»СЏ
        InputLabel("РўРёРї")
        ProjectDropdown(value = type, onValueChange = { type = it }, placeholder = "Р’С‹Р±РµСЂРёС‚Рµ С‚РёРї", options = typeOptions)
        Spacer(modifier = Modifier.height(16.dp))

        InputLabel("РќР°Р·РІР°РЅРёРµ РїСЂРѕРµРєС‚Р°")
        MatuleTextField(value = name, onValueChange = { name = it }, placeholder = "Р’РІРµРґРёС‚Рµ РёРјСЏ")
        Spacer(modifier = Modifier.height(16.dp))

        InputLabel("Р”Р°С‚Р° РЅР°С‡Р°Р»Р°")
        MatuleTextField(
            value = dateStart,
            onValueChange = {},
            placeholder = "Р”Р”.РњРњ.Р“Р“Р“Р“",
            readOnly = true,
            onClick = { dateFieldType = "start" }
        )
        Spacer(modifier = Modifier.height(16.dp))

        InputLabel("Р”Р°С‚Р° РћРєРѕРЅС‡Р°РЅРёСЏ")
        MatuleTextField(
            value = dateEnd,
            onValueChange = {},
            placeholder = "Р”Р”.РњРњ.Р“Р“Р“Р“",
            readOnly = true,
            onClick = { dateFieldType = "end" }
        )
        Spacer(modifier = Modifier.height(16.dp))

        InputLabel("РљРѕРјСѓ")
        ProjectDropdown(value = toWhom, onValueChange = { toWhom = it }, placeholder = "Р’С‹Р±РµСЂРёС‚Рµ РєРѕРјСѓ", options = whoOptions)
        Spacer(modifier = Modifier.height(16.dp))

        InputLabel("РСЃС‚РѕС‡РЅРёРє РѕРїРёСЃР°РЅРёСЏ")
        MatuleTextField(value = source, onValueChange = { source = it }, placeholder = "example.com")
        Spacer(modifier = Modifier.height(16.dp))

        InputLabel("РљР°С‚РµРіРѕСЂРёСЏ")
        ProjectDropdown(value = category, onValueChange = { category = it }, placeholder = "Р’С‹Р±РµСЂРёС‚Рµ РєР°С‚РµРіРѕСЂРёСЋ", options = categoryOptions)
        Spacer(modifier = Modifier.height(24.dp))

        // Р¤РѕС‚Рѕ
        Box(
            modifier = Modifier
                .size(200.dp)
                .clip(RoundedCornerShape(12.dp))
                .background(MatuleInputBg)
                .clickable { showPhotoSheet = true }
                .align(Alignment.CenterHorizontally),
            contentAlignment = Alignment.Center
        ) {
            if (selectedImageUri != null) {
                AsyncImage(
                    model = selectedImageUri,
                    contentDescription = "Project Image",
                    contentScale = ContentScale.Crop,
                    modifier = Modifier.fillMaxSize()
                )
            } else {
                Icon(
                    painter = painterResource(id = UiKitR.drawable.ic_plus),
                    contentDescription = "Add Photo",
                    tint = MatuleTextGray,
                    modifier = Modifier.size(48.dp)
                )
            }
        }

        Spacer(modifier = Modifier.height(40.dp))

        // РљРЅРѕРїРєР° РџРѕРґС‚РІРµСЂРґРёС‚СЊ
        MatuleButton(
            text = "РџРѕРґС‚РІРµСЂРґРёС‚СЊ",
            onClick = {
                viewModel.createProject(
                    context = context,
                    name = name,
                    type = type,
                    dateStart = dateStart,
                    imageUri = selectedImageUri
                ) {
                    Toast.makeText(context, "РџСЂРѕРµРєС‚ СЃРѕР·РґР°РЅ!", Toast.LENGTH_SHORT).show()
                    onBackClick()
                }
            },
            enabled = name.isNotEmpty()
        )
        Spacer(modifier = Modifier.height(40.dp))
    }

    // РљР°Р»РµРЅРґР°СЂСЊ
    if (dateFieldType != null) {
        MatuleDatePicker(
            onDateSelected = { millis ->
                if (millis != null) {
                    val formattedDate = convertMillisToDate(millis)
                    if (dateFieldType == "start") dateStart = formattedDate else dateEnd = formattedDate
                }
            },
            onDismiss = { dateFieldType = null }
        )
    }

    // РЁС‚РѕСЂРєР° Р¤РѕС‚Рѕ
    if (showPhotoSheet) {
        ModalBottomSheet(
            onDismissRequest = { showPhotoSheet = false },
            sheetState = sheetState,
            containerColor = MatuleWhite
        ) {
            Column(
                modifier = Modifier.fillMaxWidth().padding(20.dp),
                horizontalAlignment = Alignment.CenterHorizontally
            ) {
                Text("Р—Р°РіСЂСѓР·РёС‚СЊ С„РѕС‚Рѕ", style = Title2)
                Spacer(modifier = Modifier.height(20.dp))
                MatuleButton(text = "РЎРґРµР»Р°С‚СЊ С„РѕС‚Рѕ", onClick = {
                    showPhotoSheet = false
                    permissionLauncher.launch(Manifest.permission.CAMERA)
                })
                Spacer(modifier = Modifier.height(12.dp))
                MatuleButton(text = "Р’С‹Р±СЂР°С‚СЊ РёР· РіР°Р»РµСЂРµРё", onClick = {
                    showPhotoSheet = false
                    galleryLauncher.launch("image/*")
                })
                Spacer(modifier = Modifier.height(40.dp))
            }
        }
    }
}

// Р’СЃРїРѕРјРѕРіР°С‚РµР»СЊРЅС‹Рµ С„СѓРЅРєС†РёРё
@Composable
fun InputLabel(text: String) {
    Text(
        text = text,
        style = Caption,
        color = MatuleTextGray,
        modifier = Modifier.padding(bottom = 6.dp)
    )
}

@Composable
fun ProjectDropdown(value: String, onValueChange: (String) -> Unit, placeholder: String, options: List<String>) {
    var expanded by remember { mutableStateOf(false) }
    Box(modifier = Modifier.fillMaxWidth()) {
        MatuleTextField(
            value = value,
            onValueChange = {},
            placeholder = placeholder,
            readOnly = true,
            onClick = { expanded = true },
            trailingIcon = {
                Icon(painter = painterResource(id = UiKitR.drawable.ic_chevron_down), contentDescription = null, tint = MatuleTextGray)
            }
        )
        DropdownMenu(
            expanded = expanded,
            onDismissRequest = { expanded = false },
            modifier = Modifier.background(MatuleWhite).fillMaxWidth(0.9f)
        ) {
            options.forEach { option ->
                DropdownMenuItem(
                    text = { Text(option, style = BodyText) },
                    onClick = { onValueChange(option); expanded = false }
                )
            }
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\CreateProjectViewModel.kt ===

package com.aiden3630.presentation.main

import android.content.Context
import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.aiden3630.domain.repository.ProjectRepository
import com.aiden3630.presentation.utils.saveUriToInternalStorage
import dagger.hilt.android.lifecycle.HiltViewModel
import kotlinx.coroutines.launch
import android.net.Uri
import javax.inject.Inject

@HiltViewModel
class CreateProjectViewModel @Inject constructor(
    private val repository: ProjectRepository,
    private val notificationService: com.aiden3630.presentation.utils.NotificationService
) : ViewModel() {
    fun createProject(
        context: Context, // РџРµСЂРµРґР°РµРј РєРѕРЅС‚РµРєСЃС‚
        name: String,
        type: String,
        dateStart: String,
        imageUri: Uri?,
        onSuccess: () -> Unit
    ) {
        viewModelScope.launch {
            val savedImagePath = if (imageUri != null) {
                saveUriToInternalStorage(context, imageUri)
            } else {
                null
            }

            repository.createProject(name, type, dateStart, savedImagePath)
            notificationService.showNotification("РќРѕРІС‹Р№ РїСЂРѕРµРєС‚", "РџСЂРѕРµРєС‚ '$name' СѓСЃРїРµС€РЅРѕ СЃРѕР·РґР°РЅ!")

            onSuccess()
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\HomeScreen.kt ===

package com.aiden3630.presentation.main

import androidx.compose.foundation.Image
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.LazyRow
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import androidx.hilt.navigation.compose.hiltViewModel
import com.aiden3630.presentation.components.MatuleChip
import com.aiden3630.presentation.components.MatuleSearchField
import com.aiden3630.presentation.components.ProductCard
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.R as UiKitR
import androidx.compose.ui.zIndex
import androidx.compose.foundation.lazy.items

@Composable
fun HomeScreen(
    onCartClick: () -> Unit = {},
    cartViewModel: CartViewModel = hiltViewModel(),
    homeViewModel: HomeViewModel = hiltViewModel()
) {
    val searchText by homeViewModel.searchText.collectAsState()
    val selectedCategory by homeViewModel.selectedCategory.collectAsState()
    val products by homeViewModel.filteredProducts.collectAsState()

    // Р”Р°РЅРЅС‹Рµ РґР»СЏ РєРѕСЂР·РёРЅС‹ (СЃСѓРјРјР° Рё СЃРїРёСЃРѕРє РїРѕРєСѓРїРѕРє)
    val cartItems by cartViewModel.cartItems.collectAsState()
    val cartTotal by cartViewModel.totalSum.collectAsState()

    val categories = listOf("Р’СЃРµ", "РњСѓР¶С‡РёРЅР°Рј", "Р–РµРЅС‰РёРЅР°Рј", "Р”РµС‚СЏРј")


    Box(modifier = Modifier.fillMaxSize()) {

        LazyColumn(
            modifier = Modifier
                .fillMaxSize()
                .background(MatuleWhite)
                .padding(horizontal = 20.dp),
            contentPadding = PaddingValues(bottom = 100.dp)
        ) {
            // РџРѕРёСЃРє
            item {
                Spacer(modifier = Modifier.height(20.dp))
                MatuleSearchField(
                    value = searchText,
                    onValueChange = {
                        homeViewModel.onSearchTextChange(it)
                    }
                )
                Spacer(modifier = Modifier.height(24.dp))
            }

            // Р‘Р°РЅРЅРµСЂС‹
            item {
                Text(text = "РђРєС†РёРё Рё РЅРѕРІРѕСЃС‚Рё", style = Title3)
                Spacer(modifier = Modifier.height(16.dp))

                LazyRow(horizontalArrangement = Arrangement.spacedBy(16.dp)) {
                    item {
                        BannerItem(
                            title = "РЁРѕСЂС‚С‹\nР’С‚РѕСЂРЅРёРє",
                            price = "4000 в‚Ѕ",
                            gradient = Brush.linearGradient(listOf(Color(0xFF97D9F0), Color(0xFF92E9D4))),
                            imageRes = UiKitR.drawable.im_banner_1
                        )
                    }
                    item {
                        BannerItem(
                            title = "Р СѓР±Р°С€РєР°\nР’РѕСЃРєСЂРµСЃРµРЅСЊРµ",
                            price = "8000 в‚Ѕ",
                            gradient = Brush.linearGradient(listOf(Color(0xFF76B3FF), Color(0xFFCDE3FF))),
                            imageRes = UiKitR.drawable.im_banner_1
                        )
                    }
                }
                Spacer(modifier = Modifier.height(24.dp))
            }

            // РљР°С‚РµРіРѕСЂРёРё
            item {
                Text(text = "РљР°С‚Р°Р»РѕРі РѕРїРёСЃР°РЅРёР№", style = Title3)
                Spacer(modifier = Modifier.height(16.dp))
                LazyRow(horizontalArrangement = Arrangement.spacedBy(16.dp)) {
                    items(categories.size) { index ->
                        MatuleChip(
                            text = categories[index],
                            isSelected = selectedCategory == categories[index],
                            onClick = {
                                homeViewModel.onCategoryChange(categories[index])
                            }
                        )
                    }
                }
                Spacer(modifier = Modifier.height(24.dp))
            }

            // РўРѕРІР°СЂС‹
            if (products.isEmpty()) {
                // Р•СЃР»Рё РЅРёС‡РµРіРѕ РЅРµ РЅР°Р№РґРµРЅРѕ
                item {
                    Box(modifier = Modifier.fillMaxWidth().height(100.dp), contentAlignment = Alignment.Center) {
                        Text("РќРёС‡РµРіРѕ РЅРµ РЅР°Р№РґРµРЅРѕ", style = BodyText, color = MatuleTextGray)
                    }
                }
            } else {
                items(products) { product ->

                    val isProductInCart = cartItems.any { cartItem -> cartItem.product.id == product.id }

                    ProductCard(
                        title = product.title,
                        price = "${product.price} в‚Ѕ",
                        category = product.category,
                        isInCart = isProductInCart,

                        onAddClick = {
                            cartViewModel.onPlusClick(product)
                        },

                        onRemoveClick = {
                            cartViewModel.onDeleteClick(product)
                        },

                        onClick = {}
                    )
                    Spacer(modifier = Modifier.height(16.dp))
                }
            }
        }

        // РџР»Р°РІР°СЋС‰Р°СЏ РєРЅРѕРїРєР°
        if (cartTotal > 0) {
            Box(
                modifier = Modifier
                    .align(Alignment.BottomCenter)
                    .padding(bottom = 20.dp, start = 20.dp, end = 20.dp)
                    .fillMaxWidth()
                    .height(56.dp)
                    .shadow(10.dp, RoundedCornerShape(12.dp), spotColor = Color(0x40000000))
                    .background(MatuleBlue, RoundedCornerShape(12.dp))
                    .clickable { onCartClick() }
            ) {
                Row(
                    modifier = Modifier
                        .align(Alignment.CenterStart)
                        .padding(start = 16.dp),
                    verticalAlignment = Alignment.CenterVertically
                ) {
                    Icon(
                        painter = painterResource(id = UiKitR.drawable.ic_cart),
                        contentDescription = null,
                        tint = MatuleWhite,
                        modifier = Modifier.size(24.dp)
                    )
                    Spacer(modifier = Modifier.width(16.dp))
                    Text(
                        text = "Р’ РєРѕСЂР·РёРЅСѓ",
                        style = Title3.copy(color = MatuleWhite, fontWeight = FontWeight.SemiBold)
                    )
                }

                // РЎСѓРјРјР° РѕР±РЅРѕРІР»СЏРµС‚СЃСЏ СЃР°РјР°, С‚Р°Рє РєР°Рє cartTotal - СЌС‚Рѕ State
                Text(
                    text = "$cartTotal в‚Ѕ",
                    style = Title3.copy(color = MatuleWhite, fontWeight = FontWeight.SemiBold),
                    modifier = Modifier
                        .align(Alignment.CenterEnd)
                        .padding(end = 16.dp)
                )
            }
        }
    }
}

// РљРѕРјРїРѕРЅРµРЅС‚ Р±Р°РЅРЅРµСЂР°
@Composable
fun BannerItem(
    title: String,
    price: String,
    gradient: Brush,
    imageRes: Int
) {
    Box(
        modifier = Modifier
            .width(270.dp)
            .height(152.dp)
            .clip(RoundedCornerShape(12.dp))
            .background(gradient)
            .clickable { }
    ) {
        // РўРµРєСЃС‚
        Column(
            modifier = Modifier
                .padding(16.dp)
                .fillMaxHeight()
                .width(140.dp)
                .zIndex(2f) // РўРµРєСЃС‚ РїРѕРІРµСЂС… РєР°СЂС‚РёРЅРєРё
        ) {
            Text(
                text = title,
                style = Title2.copy(color = MatuleWhite, fontSize = 20.sp),
                lineHeight = 24.sp
            )
            Spacer(modifier = Modifier.weight(1f))
            Text(
                text = price,
                style = Title2.copy(color = MatuleWhite, fontSize = 20.sp)
            )
        }

        // РљР°СЂС‚РёРЅРєР°
        Image(
            painter = painterResource(id = imageRes),
            contentDescription = null,
            // РСЃРїРѕР»СЊР·СѓРµРј Fit, С‡С‚РѕР±С‹ Р±Р°РЅРєР° РЅРµ Р±С‹Р»Р° "Р¶РёСЂРЅРѕР№", РЅРѕ Р·Р°РЅРёРјР°Р»Р° РІС‹СЃРѕС‚Сѓ
            contentScale = androidx.compose.ui.layout.ContentScale.Fit,
            modifier = Modifier
                .align(Alignment.BottomEnd)
                .height(160.dp)
                .offset(x = 5.dp, y = 5.dp)
        )
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\HomeViewModel.kt ===

package com.aiden3630.presentation.main

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.aiden3630.domain.model.Product
import com.aiden3630.domain.repository.ShopRepository
import dagger.hilt.android.lifecycle.HiltViewModel
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.SharingStarted
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.flow.combine
import kotlinx.coroutines.flow.stateIn
import kotlinx.coroutines.launch
import javax.inject.Inject

@HiltViewModel
class HomeViewModel @Inject constructor(
    private val shopRepository: ShopRepository
) : ViewModel() {

    // РСЃС…РѕРґРЅС‹Рµ РґР°РЅРЅС‹Рµ Р·Р°РіСЂСѓР¶Р°СЋС‚СЃСЏ РёР· Р РµРїРѕР·РёС‚РѕСЂРёСЏ
    private val _allProducts = MutableStateFlow<List<Product>>(emptyList())

    // РЎРѕСЃС‚РѕСЏРЅРёРµ РїРѕРёСЃРєР° Рё РєР°С‚РµРіРѕСЂРёРё
    private val _searchText = MutableStateFlow("")
    val searchText = _searchText.asStateFlow()

    private val _selectedCategory = MutableStateFlow("Р’СЃРµ")
    val selectedCategory = _selectedCategory.asStateFlow()

    // РЈРјРЅС‹Р№ СЃРїРёСЃРѕРє
    val filteredProducts = combine(_allProducts, _searchText, _selectedCategory) { products, text, category ->
        products.filter { product ->
            // РЈСЃР»РѕРІРёРµ 1: РџРѕРёСЃРє РїРѕ РЅР°Р·РІР°РЅРёСЋ (РёРіРЅРѕСЂРёСЂСѓСЏ СЂРµРіРёСЃС‚СЂ)
            val matchesSearch = product.title.contains(text, ignoreCase = true)

            // РЈСЃР»РѕРІРёРµ 2: Р¤РёР»СЊС‚СЂ РїРѕ РєР°С‚РµРіРѕСЂРёРё (РµСЃР»Рё "Р’СЃРµ", С‚Рѕ Р±РµСЂРµРј РІСЃС‘)
            val matchesCategory = if (category == "Р’СЃРµ") true else product.category == category

            matchesSearch && matchesCategory
        }
    }.stateIn(
        scope = viewModelScope,
        started = SharingStarted.WhileSubscribed(5000),
        initialValue = emptyList()
    )

    init {
        loadProducts()
    }

    private fun loadProducts() {
        viewModelScope.launch {
            shopRepository.getProducts().collect { list ->
                _allProducts.value = list
            }
        }
    }

    // РњРµС‚РѕРґС‹ РґР»СЏ UI
    fun onSearchTextChange(text: String) {
        _searchText.value = text
    }

    fun onCategoryChange(category: String) {
        _selectedCategory.value = category
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\MainScreen.kt ===

package com.aiden3630.presentation.main

import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.padding
import androidx.compose.material3.Scaffold
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.getValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.navigation.compose.NavHost
import androidx.navigation.compose.composable
import androidx.navigation.compose.currentBackStackEntryAsState
import androidx.navigation.compose.rememberNavController
import com.aiden3630.presentation.Route
import com.aiden3630.presentation.components.BottomTab
import com.aiden3630.presentation.components.MatuleBottomBar
import com.aiden3630.presentation.R as UiKitR
@Composable
fun MainScreen(onNavigateToCart: () -> Unit = {}, onNavigateToCreateProject: () -> Unit = {}, onLogout: () -> Unit = {}, onNavigateToProjectDetails: (String) -> Unit = {}) {
    // РЈ РіР»Р°РІРЅРѕРіРѕ СЌРєСЂР°РЅР° СЃРІРѕР№ СЃРѕР±СЃС‚РІРµРЅРЅС‹Р№ NavController
    val bottomNavController = rememberNavController()


    // РџРѕР»СѓС‡Р°РµРј С‚РµРєСѓС‰РёР№ РјР°СЂС€СЂСѓС‚, С‡С‚РѕР±С‹ РїРѕРґСЃРІРµС‚РёС‚СЊ РёРєРѕРЅРєСѓ
    val navBackStackEntry by bottomNavController.currentBackStackEntryAsState()
    val currentRoute = navBackStackEntry?.destination?.route

    // РЎРїРёСЃРѕРє РІРєР»Р°РґРѕРє
    val tabs = listOf(
        BottomTab(Route.HOME_TAB, "Р“Р»Р°РІРЅР°СЏ", UiKitR.drawable.ic_home),
        BottomTab(Route.CATALOG_TAB, "РљР°С‚Р°Р»РѕРі", UiKitR.drawable.ic_catalog),
        BottomTab(Route.PROJECTS_TAB, "РџСЂРѕРµРєС‚С‹", UiKitR.drawable.ic_projects),
        BottomTab(Route.PROFILE_TAB, "РџСЂРѕС„РёР»СЊ", UiKitR.drawable.ic_profile)
    )

    Scaffold(
        bottomBar = {
            MatuleBottomBar(
                currentRoute = currentRoute,
                onNavigate = { route ->
                    bottomNavController.navigate(route) {
                        popUpTo(bottomNavController.graph.startDestinationId) { saveState = true }
                        launchSingleTop = true
                        restoreState = true
                    }
                },
                tabs = tabs
            )
        }
    ) { innerPadding ->
        // РљРѕРЅС‚РµРЅС‚ РІРєР»Р°РґРѕРє
        NavHost(
            navController = bottomNavController,
            startDestination = Route.HOME_TAB,
            modifier = Modifier.padding(innerPadding)
        ) {
            // Р“Р»Р°РІРЅР°СЏ
            composable(Route.HOME_TAB) {
                HomeScreen(
                    onCartClick = onNavigateToCart
                )
            }

            // РљР°С‚Р°Р»РѕРі (Р’РјРµСЃС‚Рѕ РР·Р±СЂР°РЅРЅРѕРіРѕ)
            composable(Route.CATALOG_TAB) {
                CatalogScreen(
                    onCartClick = onNavigateToCart,
                    onProfileClick = {
                        bottomNavController.navigate(Route.PROFILE_TAB) {
                            popUpTo(bottomNavController.graph.startDestinationId) { saveState = true }
                            launchSingleTop = true
                            restoreState = true
                        }
                    }
                )
            }
            // РџСЂРѕРµРєС‚С‹
            composable(Route.PROJECTS_TAB) {
                ProjectsScreen(
                    onAddProjectClick = onNavigateToCreateProject,
                    onProjectClick = { projectId ->
                        onNavigateToProjectDetails(projectId)
                    }
                )
            }

            // РџСЂРѕС„РёР»СЊ
            composable(Route.PROFILE_TAB) {
                ProfileScreen(
                    onLogoutClick = onLogout
                )
            }
        }
    }
}


@Composable
fun PlaceholderScreen(text: String) {
    Box(
        modifier = Modifier.fillMaxSize(),
        contentAlignment = Alignment.Center
    ) {
        Text(text = text)
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\ProductDetailsSheet.kt ===

package com.aiden3630.presentation.main

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.verticalScroll
import androidx.compose.material3.*
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.aiden3630.presentation.components.MatuleButton
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.R as UiKitR

@Composable
fun ProductDetailsSheet(
    title: String,
    price: String,
    description: String,
    onDismiss: () -> Unit,
    onAddToCart: () -> Unit
) {
    Column(
        modifier = Modifier
            .fillMaxWidth()
            .fillMaxHeight(0.9f)
            .background(MatuleWhite, RoundedCornerShape(topStart = 24.dp, topEnd = 24.dp))
    ) {
        // РЁР°РїРєР°
        Box(modifier = Modifier.fillMaxWidth().padding(top = 16.dp, end = 16.dp)) {
            Icon(
                painter = painterResource(id = UiKitR.drawable.ic_close),
                contentDescription = "Close",
                tint = MatuleGrayIcon,
                modifier = Modifier.align(Alignment.CenterEnd).size(24.dp).clickable { onDismiss() }
            )
        }

        Text(
            text = title,
            style = Title1.copy(fontSize = 24.sp, fontWeight = FontWeight.Bold),
            modifier = Modifier.padding(horizontal = 20.dp)
        )

        // РљРѕРЅС‚РµРЅС‚
        Column(
            modifier = Modifier
                .weight(1f)
                .verticalScroll(rememberScrollState())
                .padding(horizontal = 20.dp, vertical = 24.dp)
        ) {
            Text(
                text = "РћРїРёСЃР°РЅРёРµ",
                style = Caption,
                color = MatuleTextGray
            )

            Spacer(modifier = Modifier.height(8.dp))

            Text(
                text = description,
                style = BodyText.copy(lineHeight = 22.sp),
                color = MatuleBlack
            )
        }
        // РљРЅРѕРїРєР°
        Box(modifier = Modifier.fillMaxWidth().padding(20.dp)) {
            MatuleButton(text = "Р”РѕР±Р°РІРёС‚СЊ Р·Р° $price", onClick = onAddToCart)
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\ProfileScreen.kt ===

package com.aiden3630.presentation.main

import android.content.Intent
import android.net.Uri
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import com.aiden3630.presentation.components.MatuleToggle
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.R as UiKitR
import androidx.compose.ui.draw.rotate
import androidx.compose.ui.graphics.Color
import androidx.hilt.navigation.compose.hiltViewModel
import com.aiden3630.presentation.theme.MatuleBlack
import com.aiden3630.presentation.theme.MatuleError
import com.aiden3630.presentation.theme.MatuleInputBg
import com.aiden3630.presentation.theme.MatuleTextGray
import com.aiden3630.presentation.theme.MatuleWhite
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.verticalScroll

@Composable
fun ProfileScreen( onLogoutClick: () -> Unit = {}, viewModel: ProfileViewModel = hiltViewModel()) {
    val context = LocalContext.current
    var isNotificationsEnabled by remember { mutableStateOf(true) }
    val state by viewModel.state.collectAsState()
    val scrollState = rememberScrollState()

    // Р¤СѓРЅРєС†РёСЏ РґР»СЏ РѕС‚РєСЂС‹С‚РёСЏ PDF (СЃСЃС‹Р»РєРё)
    fun openPdf(url: String) {
        val intent = Intent(Intent.ACTION_VIEW, Uri.parse(url))
        context.startActivity(intent)
    }

    Column(
        modifier = Modifier
            .fillMaxSize()
            .background(MatuleWhite)
            .verticalScroll(scrollState)
            .padding(horizontal = 20.dp),
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Spacer(modifier = Modifier.height(20.dp))

        // РЁР°РїРєР° (РРјСЏ Рё РџРѕС‡С‚Р°)
        Column(
            modifier = Modifier.fillMaxWidth(),
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            // РђРІР°С‚Р°СЂРєР°
            Box(
                modifier = Modifier
                    .size(80.dp)
                    .clip(CircleShape)
                    .background(MatuleInputBg),
                contentAlignment = Alignment.Center
            ) {
                Icon(
                    painter = painterResource(id = UiKitR.drawable.ic_profile_black),
                    contentDescription = null,
                    modifier = Modifier.size(40.dp),
                    tint = MatuleBlack
                )
            }
            Spacer(modifier = Modifier.height(16.dp))

            // РћР±СЉРµРґРёРЅСЏРµРј РРјСЏ Рё Р¤Р°РјРёР»РёСЋ
            Text(text = "${state.name} ${state.surname}", style = Title1)

            Spacer(modifier = Modifier.height(4.dp))

            // РџРѕС‡С‚Р°
            Text(text = state.email, style = Headline, color = MatuleTextGray)
        }

        Spacer(modifier = Modifier.height(40.dp))

        // РњРµРЅСЋ

        // РњРѕРё Р·Р°РєР°Р·С‹
        ProfileMenuItem(
            title = "РњРѕРё Р·Р°РєР°Р·С‹",
            iconRes = UiKitR.drawable.ic_notification
        )

        Spacer(modifier = Modifier.height(16.dp))

        // РЈРІРµРґРѕРјР»РµРЅРёСЏ (СЃ С‚РѕРіРіР»РѕРј)
        Row(
            modifier = Modifier
                .fillMaxWidth()
                .height(56.dp)
                .background(MatuleWhite, RoundedCornerShape(12.dp))
                .padding(horizontal = 10.dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            // РРєРѕРЅРєР°
            Icon(
                painter = painterResource(id = UiKitR.drawable.ic_settings),
                contentDescription = null,
                tint = Color.Unspecified,
                modifier = Modifier.size(24.dp)
            )
            Spacer(modifier = Modifier.width(16.dp))

            Text(text = "РЈРІРµРґРѕРјР»РµРЅРёСЏ", style = Title3, modifier = Modifier.weight(1f))

            MatuleToggle(
                checked = state.isNotificationsEnabled,
                onCheckedChange = { isEnabled ->
                    viewModel.toggleNotifications(isEnabled)
                }
            )
        }

        Spacer(modifier = Modifier.weight(1f))

        // РќРёР·
        Spacer(modifier = Modifier.height(40.dp))

        Text(
            text = "РџРѕР»РёС‚РёРєР° РєРѕРЅС„РёРґРµРЅС†РёР°Р»СЊРЅРѕСЃС‚Рё",
            style = Caption,
            color = MatuleTextGray,
            modifier = Modifier.clickable {
                // РЎСЃС‹Р»РєР° РЅР° PDF
                openPdf("https://google.com")
            }
        )

        Spacer(modifier = Modifier.height(16.dp))

        Text(
            text = "РџРѕР»СЊР·РѕРІР°С‚РµР»СЊСЃРєРѕРµ СЃРѕРіР»Р°С€РµРЅРёРµ",
            style = Caption,
            color = MatuleTextGray,
            modifier = Modifier.clickable {
                openPdf("https://google.com")
            }
        )

        Spacer(modifier = Modifier.height(30.dp))

        Text(
            text = "Р’С‹С…РѕРґ",
            style = Title3.copy(color = MatuleError),
            modifier = Modifier.clickable {
                //РћС‡РёС‰Р°РµРј С‚РѕРєРµРЅ РїСЂРё РІС‹С…РѕРґРµ
                viewModel.logout()
                onLogoutClick()
            }
        )

        Spacer(modifier = Modifier.height(110.dp))
    }
}

// Р’СЃРїРѕРјРѕРіР°С‚РµР»СЊРЅС‹Р№ РєРѕРјРїРѕРЅРµРЅС‚ РґР»СЏ РїСѓРЅРєС‚Р° РјРµРЅСЋ
@Composable
fun ProfileMenuItem(title: String, iconRes: Int) {
    Row(
        modifier = Modifier
            .fillMaxWidth()
            .height(56.dp)
            .background(MatuleWhite)
            .clickable { }
            .padding(horizontal = 10.dp),
        verticalAlignment = Alignment.CenterVertically
    ) {
        Icon(
            painter = painterResource(id = iconRes),
            contentDescription = null,
            tint = Color.Unspecified,
            modifier = Modifier.size(24.dp)
        )
        Spacer(modifier = Modifier.width(16.dp))
        Text(text = title, style = Title3, modifier = Modifier.weight(1f))

        // РЎС‚СЂРµР»РѕС‡РєР° РІРїСЂР°РІРѕ
        Icon(
            painter = painterResource(id = UiKitR.drawable.ic_chevron_left),
            contentDescription = null,
            tint = MatuleBlack,
            modifier = Modifier.size(24.dp).rotate(180f)
        )
    }
}



// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\ProfileViewModel.kt ===

package com.aiden3630.presentation.main

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import dagger.hilt.android.lifecycle.HiltViewModel
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import javax.inject.Inject
import com.aiden3630.data.manager.TokenManager

@HiltViewModel
class ProfileViewModel @Inject constructor(
    private val tokenManager: TokenManager
) : ViewModel() {

    // РЎРѕСЃС‚РѕСЏРЅРёРµ UI
    private val _state = MutableStateFlow(ProfileState())
    val state = _state.asStateFlow()

    init {
        loadProfile()
    }

    private fun loadProfile() {
        viewModelScope.launch {
            // РЎРѕР±РёСЂР°РµРј РґР°РЅРЅС‹Рµ РёР· DataStore
            tokenManager.getName().collect { name ->
                _state.value = _state.value.copy(name = name)
            }
        }
        viewModelScope.launch {
            tokenManager.getSurname().collect { surname ->
                _state.value = _state.value.copy(surname = surname)
            }
        }
        viewModelScope.launch {
            tokenManager.getEmail().collect { email ->
                _state.value = _state.value.copy(email = email)
            }
        }
        viewModelScope.launch {
            tokenManager.getNotificationsEnabled().collect { enabled ->
                _state.value = _state.value.copy(isNotificationsEnabled = enabled)
            }
        }
    }
    fun toggleNotifications(enabled: Boolean) {
        viewModelScope.launch {
            tokenManager.saveNotificationsEnabled(enabled)
        }
    }


    fun logout() {
        viewModelScope.launch {
            tokenManager.clearSession()
        }
    }
}

// РљР»Р°СЃСЃ РґР»СЏ С…СЂР°РЅРµРЅРёСЏ РґР°РЅРЅС‹С… РЅР° СЌРєСЂР°РЅРµ
data class ProfileState(
    val name: String = "",
    val surname: String = "",
    val email: String = "",
    val isNotificationsEnabled: Boolean = true
)


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\ProjectDetailsScreen.kt ===

package com.aiden3630.presentation.main

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.verticalScroll
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.unit.dp
import androidx.hilt.navigation.compose.hiltViewModel
import coil.compose.AsyncImage
import com.aiden3630.presentation.theme.*
import java.io.File

@Composable
fun ProjectDetailsScreen(
    projectId: String,
    onBackClick: () -> Unit,
    viewModel: ProjectDetailsViewModel = hiltViewModel()
) {
    // Р—Р°РіСЂСѓР¶Р°РµРј РїСЂРѕРµРєС‚ РїСЂРё СЃС‚Р°СЂС‚Рµ
    LaunchedEffect(projectId) {
        viewModel.loadProject(projectId)
    }

    val project by viewModel.project.collectAsState()

    if (project == null) {
        // РџРѕРєР°Р·С‹РІР°РµРј Р·Р°РіСЂСѓР·РєСѓ, РїРѕРєР° РёС‰РµРј РїСЂРѕРµРєС‚
        Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {
            CircularProgressIndicator(color = MatuleBlue)
        }
    } else {
        // РџРѕРєР°Р·С‹РІР°РµРј РґР°РЅРЅС‹Рµ
        Column(
            modifier = Modifier
                .fillMaxSize()
                .background(MatuleWhite)
                .verticalScroll(rememberScrollState())
                .padding(20.dp)
        ) {
            // РљРЅРѕРїРєР° РЅР°Р·Р°Рґ (РјРѕР¶РЅРѕ РґРѕР±Р°РІРёС‚СЊ РёРєРѕРЅРєСѓ РєР°Рє РІРµР·РґРµ)
            TextButton(onClick = onBackClick) {
                Text("РќР°Р·Р°Рґ", color = MatuleBlue)
            }

            Spacer(modifier = Modifier.height(10.dp))

            // РљР°СЂС‚РёРЅРєР°
            if (project!!.imageUri != null) {
                AsyncImage(
                    model = File(project!!.imageUri!!), // Р§РёС‚Р°РµРј РёР· С„Р°Р№Р»Р°
                    contentDescription = null,
                    contentScale = ContentScale.Crop,
                    modifier = Modifier
                        .fillMaxWidth()
                        .height(250.dp)
                        .clip(RoundedCornerShape(16.dp))
                )
            } else {
                Box(
                    Modifier
                        .fillMaxWidth()
                        .height(250.dp)
                        .background(MatuleInputBg, RoundedCornerShape(16.dp))
                )
            }

            Spacer(modifier = Modifier.height(24.dp))

            Text(text = project!!.name, style = Title1)
            Spacer(modifier = Modifier.height(8.dp))
            Text(text = "РљР°С‚РµРіРѕСЂРёСЏ: ${project!!.category}", style = BodyText, color = MatuleTextGray)
            Spacer(modifier = Modifier.height(8.dp))
            Text(text = "РќР°С‡Р°Р»Рѕ: ${project!!.dateStart}", style = BodyText)
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\ProjectDetailsViewModel.kt ===

package com.aiden3630.presentation.main

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.aiden3630.domain.model.UserProject
import com.aiden3630.domain.repository.ProjectRepository
import dagger.hilt.android.lifecycle.HiltViewModel
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch
import javax.inject.Inject

@HiltViewModel
class ProjectDetailsViewModel @Inject constructor(
    private val repository: ProjectRepository
) : ViewModel() {

    private val _project = MutableStateFlow<UserProject?>(null)
    val project = _project.asStateFlow()

    fun loadProject(id: String) {
        viewModelScope.launch {
            val result = repository.getProjectById(id)
            _project.value = result
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\ProjectsScreen.kt ===

package com.aiden3630.presentation.main

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.res.painterResource
import androidx.compose.ui.unit.dp
import androidx.hilt.navigation.compose.hiltViewModel

import com.aiden3630.domain.model.UserProject
import com.aiden3630.presentation.main.ProjectsViewModel

import com.aiden3630.presentation.components.ProjectCard
import com.aiden3630.presentation.theme.*
import com.aiden3630.presentation.R as UiKitR

@Composable
fun ProjectsScreen(
    onAddProjectClick: () -> Unit = {},
    onProjectClick: (String) -> Unit = {},
    viewModel: ProjectsViewModel = hiltViewModel()
) {
    val projects by viewModel.projects.collectAsState()

    LazyColumn(
        modifier = Modifier
            .fillMaxSize()
            .background(MatuleWhite)
            .padding(horizontal = 20.dp),
        contentPadding = PaddingValues(bottom = 100.dp)
    ) {
        // РҐРµРґРµСЂ
        item {
            Spacer(modifier = Modifier.height(20.dp))
            Box(
                modifier = Modifier
                    .fillMaxWidth()
                    .height(48.dp)
            ) {
                Text(
                    text = "РџСЂРѕРµРєС‚С‹",
                    style = Title2,
                    color = MatuleBlack,
                    modifier = Modifier.align(Alignment.Center)
                )

                Icon(
                    painter = painterResource(id = UiKitR.drawable.ic_plus),
                    contentDescription = "Add Project",
                    tint = MatuleBlue,
                    modifier = Modifier
                        .size(24.dp)
                        .align(Alignment.CenterEnd)
                        .clickable { onAddProjectClick() }
                )
            }
            Spacer(modifier = Modifier.height(24.dp))
        }

        // РЎРїРёСЃРѕРє РїСЂРѕРµРєС‚РѕРІ
        if (projects.isEmpty()) {
            item {
                Box(
                    modifier = Modifier
                        .fillMaxWidth()
                        .height(200.dp),
                    contentAlignment = Alignment.Center
                ) {
                    Text(
                        text = "РЈ РІР°СЃ РїРѕРєР° РЅРµС‚ РїСЂРѕРµРєС‚РѕРІ",
                        style = BodyText,
                        color = MatuleTextGray
                    )
                }
            }
        } else {
            items(projects) { project ->
                ProjectCard(
                    title = project.name,
                    date = project.dateStart,
                    imageUri = project.imageUri,
                    onClick = {
                        onProjectClick(project.id)
                    }
                )
                Spacer(modifier = Modifier.height(16.dp))
            }
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\main\ProjectsViewModel.kt ===

package com.aiden3630.presentation.main

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.aiden3630.domain.model.UserProject
import com.aiden3630.domain.repository.ProjectRepository
import dagger.hilt.android.lifecycle.HiltViewModel
import kotlinx.coroutines.flow.SharingStarted
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.flow.stateIn
import javax.inject.Inject

@HiltViewModel
class ProjectsViewModel @Inject constructor(
    repository: ProjectRepository
) : ViewModel() {

    val projects: StateFlow<List<UserProject>> = repository.getAllProjects()
        .stateIn(
            scope = viewModelScope,
            started = SharingStarted.WhileSubscribed(5000),
            initialValue = emptyList()
        )
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\splash\SplashScreen.kt ===

package com.aiden3630.presentation.splash

import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.hilt.navigation.compose.hiltViewModel
import androidx.navigation.NavController
import com.aiden3630.presentation.Route
import com.aiden3630.presentation.theme.MatuleHeadingStyle
import com.aiden3630.presentation.theme.SplashBackground
import kotlinx.coroutines.delay

@Composable
fun SplashScreen(
    navController: NavController,
    viewModel: SplashViewModel = hiltViewModel() // РљР»Р°СЃСЃ, РєРѕС‚РѕСЂС‹Р№ СѓРјРµРµС‚ РїРµСЂРµРєР»СЋС‡Р°С‚СЊ СЌРєСЂР°РЅС‹
) {
    // Р›РѕРіРёРєР° С‚Р°Р№РјРµСЂР°
    val destination by viewModel.startDestination.collectAsState()

    LaunchedEffect(destination) {
        if (destination != null) {
            navController.navigate(destination!!) {
                // РЈРґР°Р»СЏРµРј РЎРїР»СЌС€ РёР· РёСЃС‚РѕСЂРёРё, С‡С‚РѕР±С‹ РЅРµР»СЊР·СЏ Р±С‹Р»Рѕ РІРµСЂРЅСѓС‚СЊСЃСЏ РЅР°Р·Р°Рґ
                popUpTo(Route.SPLASH) { inclusive = true }
            }
        }
    }

    // Р’РЅРµС€РЅРёР№ РІРёРґ
    SplashBackground {
        Box(
            modifier = Modifier.fillMaxSize(),
            contentAlignment = Alignment.Center
        ) {
            Text(
                text = "Matule",
                style = MatuleHeadingStyle
            )
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\splash\SplashViewModel.kt ===

package com.aiden3630.presentation.splash

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.aiden3630.presentation.Route
import com.aiden3630.data.manager.TokenManager
import dagger.hilt.android.lifecycle.HiltViewModel
import kotlinx.coroutines.delay
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.flow.first
import kotlinx.coroutines.launch
import javax.inject.Inject

@HiltViewModel
class SplashViewModel @Inject constructor(
    private val tokenManager: TokenManager
) : ViewModel() {

    private val _startDestination = MutableStateFlow<String?>(null)
    val startDestination = _startDestination.asStateFlow()

    init {
        checkSession()
    }

    private fun checkSession() {
        viewModelScope.launch {
            // Р–РґРµРј 2 СЃРµРєСѓРЅРґС‹
            delay(2000)

            // Р§РёС‚Р°РµРј С‚РѕРєРµРЅ РёР· РїР°РјСЏС‚Рё (Р±РµСЂРµРј РїРµСЂРІРѕРµ Р·РЅР°С‡РµРЅРёРµ)
            val token = tokenManager.getToken().first()

            // РџСЂРёРЅРёРјР°РµРј СЂРµС€РµРЅРёРµ
            if (!token.isNullOrEmpty()) {
                // РўРѕРєРµРЅ РµСЃС‚СЊ = РРґРµРј РІРІРѕРґРёС‚СЊ РџРРќ-РљРћР”
                _startDestination.value = Route.SIGN_IN_PIN
            } else {
                // РўРѕРєРµРЅР° РЅРµС‚ = РРґРµРј РЅР° Р’РҐРћР”/Р Р•Р“РРЎРўР РђР¦РР®
                _startDestination.value = Route.SIGN_IN
            }
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\theme\Color.kt ===

package com.aiden3630.presentation.theme

import androidx.compose.ui.graphics.Color

// ---  Brand Colors ---
val MatuleBlue = Color(0xFF1A6FEE)         // Accent (РћСЃРЅРѕРІРЅРѕР№ СЃРёРЅРёР№)
val MatuleBlueDisable = Color(0xFFC5D2FF)  // Accent Inactive (Р‘Р»РµРґРЅРѕ-СЃРёРЅРёР№)
val MatuleSuccess = Color(0xFF00B412)      // Success (Р—РµР»РµРЅС‹Р№)
val MatuleError = Color(0xFFFF4646)        // Error (РљСЂР°СЃРЅС‹Р№)

// ---  Text Colors ---
val MatuleBlack = Color(0xFF2B2B2B)        // Black (РћСЃРЅРѕРІРЅРѕР№ С‚РµРєСЃС‚) - РѕСЃС‚Р°РІРёРј РєР°Рє Р±С‹Р»Рѕ, РІ РїР°Р»РёС‚СЂРµ #2D2C2C СЌС‚Рѕ С‚РѕР¶Рµ Black
val MatuleTextGray = Color(0xFF8787A1)     // Description (РЎРµСЂС‹Р№ С‚РµРєСЃС‚)
val MatulePlaceholder = Color(0xFF98989A)  // Placeholder (Р—Р°РіР»СѓС€РєР°)
val MatuleWhite = Color(0xFFFFFFFF)        // White

// ---  Backgrounds & Strokes ---
val MatuleInputBg = Color(0xFFF7F7FA)      // РРЅРїСѓС‚ Р±Рі (Р¤РѕРЅ РїРѕР»СЏ РІРІРѕРґР°)
val MatuleInputStroke = Color(0xFFE6E6E6)  // РРЅРїСѓС‚ СЃС‚СЂРѕРє (Р Р°РјРєР° РїРѕР»СЏ)
val MatuleInputIcon = Color(0xFFBFC7D1)    // РРЅРїСѓС‚ РёРєРѕРЅРєРё
val MatuleCardStroke = Color(0xFFF2F2F2) // РљР°СЂРґ СЃС‚СЂРѕРє (Р Р°РјРєР° РєР°СЂС‚РѕС‡РµРє?)
val MatuleGrayIcon = Color(0xFFB8C1CC)
// РћСЃС‚Р°Р»СЊРЅРѕРµ (С‡С‚Рѕ РЅРµ РІ РїР°Р»РёС‚СЂРµ, РЅРѕ РЅСѓР¶РЅРѕ)
val MatuleBackground = Color(0xFFF7F7F9)   // РћР±С‰РёР№ С„РѕРЅ
val MatuleBlueFocused = MatuleBlue         // Р¤РѕРєСѓСЃ (РѕР±С‹С‡РЅРѕ СЂР°РІРµРЅ Р°РєС†РµРЅС‚Сѓ)
val MatuleRedBg = Color(0x1AFF4646)        // Р¤РѕРЅ РѕС€РёР±РєРё (10% РїСЂРѕР·СЂР°С‡РЅРѕСЃС‚СЊ)


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\theme\SplashBackground.kt ===

package com.aiden3630.presentation.theme

import androidx.compose.foundation.Canvas
import androidx.compose.foundation.background
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.geometry.Offset
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.tooling.preview.Preview

@Composable
fun SplashBackground(
    modifier: Modifier = Modifier,
    content: @Composable () -> Unit = {}
) {
    // РЎР›РћР™ 2 (РЎСЂРµРґРЅРёР№ - РІРµСЂС‚РёРєР°Р»СЊРЅС‹Р№)
    val layer2Middle = Brush.verticalGradient(
        0.0f to Color(0xFF74C8E4),
        0.5052f to Color(0xFF73D5BC),
        1.0f to Color(0xFF74C8E4)
    )

    // РЎР›РћР™ 1 (Р’РµСЂС…РЅРёР№ - РІРµСЂС‚РёРєР°Р»СЊРЅС‹Р№, СЃ РїСЂРѕР·СЂР°С‡РЅРѕСЃС‚СЊСЋ)
    val layer1Top = Brush.verticalGradient(
        0.0f to Color(red = 98, green = 105, blue = 240, alpha = 13),
        0.2917f to Color(red = 55, green = 64, blue = 245, alpha = 166),
        0.50f to Color(0xFF2254F5),
        0.7135f to Color(red = 55, green = 64, blue = 245, alpha = 166),
        1.0f to Color(red = 98, green = 105, blue = 240, alpha = 13)
    )

    Box(
        modifier = modifier.fillMaxSize()
    ) {
        Canvas(modifier = Modifier.fillMaxSize()) {
            val layer3Bottom = Brush.linearGradient(
                colors = listOf(
                    Color(0xFFA1CAFF),
                    Color(0xFF4D9CFF),
                    Color(0xFFA1CAFF)
                ),
                start = Offset(size.width, 0f),
                end = Offset(0f, size.height)
            )
            drawRect(brush = layer3Bottom)
        }

        Box(
            modifier = Modifier
                .fillMaxSize()
                .background(layer2Middle, alpha = 0.6f)
                .background(layer1Top)
        ) {
            content()
        }
    }
}

@Preview(showBackground = true)
@Composable
private fun SplashPreview() {
    SplashBackground()
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\theme\Type.kt ===

package com.aiden3630.presentation.theme

import androidx.compose.ui.text.TextStyle
import androidx.compose.ui.text.font.Font
import androidx.compose.ui.text.font.FontFamily
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.sp
import com.aiden3630.presentation.R


// РћРїСЂРµРґРµР»РµРЅРёРµ СЃРµРјРµР№СЃС‚РІ С€СЂРёС„С‚РѕРІ

// РЎРїРµС†РёР°Р»СЊРЅС‹Р№ С€СЂРёС„С‚ РґР»СЏ Р·Р°СЃС‚Р°РІРєРё
val SfProDisplay = FontFamily(
    Font(R.font.sf_pro_display, FontWeight.Normal))
// РћСЃРЅРѕРІРЅРѕР№ С€СЂРёС„С‚ РїСЂРёР»РѕР¶РµРЅРёСЏ
val Roboto = FontFamily(
    Font(R.font.roboto_regular, FontWeight.Normal),   // 400
    Font(R.font.roboto_medium, FontWeight.Medium),    // 500
    Font(R.font.roboto_bold, FontWeight.SemiBold),    // 600
    Font(R.font.roboto_bold, FontWeight.Bold),        // 700
    Font(R.font.roboto_bold, FontWeight.ExtraBold)    // 800
)

// РЎС‚РёР»СЊ Р—Р°СЃС‚Р°РІРєРё (РЎРїСЂРёРЅС‚ 3)

val MatuleHeadingStyle = TextStyle(
    fontFamily = SfProDisplay,
    fontWeight = FontWeight.Normal,
    fontSize = 40.sp,
    lineHeight = 64.sp,
    letterSpacing = 1.04.sp,
    color = MatuleWhite,
    textAlign = TextAlign.Center
)

// РЎС‚РёР»Рё UI Kit (РЎРїСЂРёРЅС‚ 1)

// Title 1 (24px)
val Title1 = TextStyle(
    fontFamily = Roboto,
    fontWeight = FontWeight.SemiBold, // 600
    fontSize = 24.sp,
    lineHeight = 28.sp,
    color = MatuleBlack
)

// Title 2 (20px)
val Title2 = TextStyle(
    fontFamily = Roboto,
    fontWeight = FontWeight.SemiBold, // 600
    fontSize = 20.sp,
    lineHeight = 28.sp,
    color = MatuleBlack
)

// Title 3 (17px)
val Title3 = TextStyle(
    fontFamily = Roboto,
    fontWeight = FontWeight.Medium,   // 500
    fontSize = 17.sp,
    lineHeight = 24.sp,
    color = MatuleBlack
)

// Headline (16px) - Р—Р°РіРѕР»РѕРІРєРё СЂР°Р·РґРµР»РѕРІ
val Headline = TextStyle(
    fontFamily = Roboto,
    fontWeight = FontWeight.Medium,   // 500
    fontSize = 16.sp,
    lineHeight = 20.sp,
    color = MatuleBlack
)

// Body / Text (15px) - РћСЃРЅРѕРІРЅРѕР№ С‚РµРєСЃС‚
val BodyText = TextStyle(
    fontFamily = Roboto,
    fontWeight = FontWeight.Normal,   // 400
    fontSize = 15.sp,
    lineHeight = 20.sp,
    color = MatuleBlack
)

// Caption (14px) - РџРѕРґРїРёСЃРё / Hint
val Caption = TextStyle(
    fontFamily = Roboto,
    fontWeight = FontWeight.Normal,   // 400
    fontSize = 14.sp,
    lineHeight = 20.sp,
    color = MatuleTextGray
)

// Caption 2 (12px) - РњРµР»РєРёРµ РїРѕРґРїРёСЃРё
val Caption2 = TextStyle(
    fontFamily = Roboto,
    fontWeight = FontWeight.Normal,   // 400
    fontSize = 12.sp,
    lineHeight = 16.sp,
    color = MatuleTextGray
)

// РљРЅРѕРїРєРё (Button Text) - РѕР±С‹С‡РЅРѕ 17px РёР»Рё 14px Semibold
val ButtonText = TextStyle(
    fontFamily = Roboto,
    fontWeight = FontWeight.SemiBold,
    fontSize = 17.sp,
    lineHeight = 24.sp,
    color = MatuleWhite
)


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\utils\DateUtils.kt ===

package com.aiden3630.presentation.utils
import java.text.SimpleDateFormat
import java.util.Date
import java.util.Locale

fun convertMillisToDate(millis: Long): String {
    val formatter = SimpleDateFormat("dd.MM.yyyy", Locale.getDefault())
    return formatter.format(Date(millis))
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\utils\ImageSaver.kt ===

package com.aiden3630.presentation.utils

import android.content.Context
import android.net.Uri
import java.io.File
import java.io.FileOutputStream

fun saveUriToInternalStorage(context: Context, uri: Uri): String? {
    return try {
        // РЎРѕР·РґР°РµРј СѓРЅРёРєР°Р»СЊРЅРѕРµ РёРјСЏ С„Р°Р№Р»Р°
        val fileName = "project_img_${System.currentTimeMillis()}.jpg"

        // РћС‚РєСЂС‹РІР°РµРј РїРѕС‚РѕРє С‡С‚РµРЅРёСЏ РёР· РІСЂРµРјРµРЅРЅРѕРіРѕ Uri
        val inputStream = context.contentResolver.openInputStream(uri) ?: return null

        // РЎРѕР·РґР°РµРј С„Р°Р№Р» РІРѕ РІРЅСѓС‚СЂРµРЅРЅРµР№ РїР°РјСЏС‚Рё
        val file = File(context.filesDir, fileName)
        val outputStream = FileOutputStream(file)

        // РљРѕРїРёСЂСѓРµРј
        inputStream.copyTo(outputStream)

        inputStream.close()
        outputStream.close()

        // Р’РѕР·РІСЂР°С‰Р°РµРј Р°Р±СЃРѕР»СЋС‚РЅС‹Р№ РїСѓС‚СЊ Рє С„Р°Р№Р»Сѓ (СЃС‚СЂРѕРєСѓ)
        file.absolutePath
    } catch (e: Exception) {
        e.printStackTrace()
        null
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\utils\NotificationService.kt ===

package com.aiden3630.presentation.utils

import android.app.NotificationChannel
import android.app.NotificationManager
import android.content.Context
import android.os.Build
import androidx.core.app.NotificationCompat
import com.aiden3630.presentation.R
import dagger.hilt.android.qualifiers.ApplicationContext
import javax.inject.Inject
import javax.inject.Singleton
import com.aiden3630.data.manager.TokenManager
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.flow.first
import kotlinx.coroutines.launch

@Singleton
class NotificationService @Inject constructor(
    @ApplicationContext private val context: Context, private val tokenManager: com.aiden3630.data.manager.TokenManager
) {
    companion object {
        const val CHANNEL_ID = "matule_channel_id"
        const val CHANNEL_NAME = "Matule Notifications"
    }

    private val notificationManager =
        context.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager

    init {
        createNotificationChannel()
    }

    private fun createNotificationChannel() {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
            val channel = NotificationChannel(
                CHANNEL_ID,
                CHANNEL_NAME,
                NotificationManager.IMPORTANCE_HIGH
            ).apply {
                description = "РЈРІРµРґРѕРјР»РµРЅРёСЏ Рѕ СЃС‚Р°С‚СѓСЃРµ Р·Р°РєР°Р·РѕРІ Рё Р°РєРєР°СѓРЅС‚Р°"
            }
            notificationManager.createNotificationChannel(channel)
        }
    }

    fun showNotification(title: String, message: String) {
        // Р—Р°РїСѓСЃРєР°РµРј РєРѕСЂСѓС‚РёРЅСѓ, С‡С‚РѕР±С‹ РїСЂРѕС‡РёС‚Р°С‚СЊ РЅР°СЃС‚СЂРѕР№РєСѓ РёР· DataStore
        CoroutineScope(Dispatchers.IO).launch {
            val isEnabled = tokenManager.getNotificationsEnabled().first()

            if (isEnabled) {
                // Р•СЃР»Рё СЂР°Р·СЂРµС€РµРЅРѕ = РїРѕРєР°Р·С‹РІР°РµРј
                val notification = NotificationCompat.Builder(context, CHANNEL_ID)
                    .setSmallIcon(R.drawable.ic_launcher_round)
                    .setContentTitle(title)
                    .setContentText(message)
                    .setPriority(NotificationCompat.PRIORITY_HIGH)
                    .setAutoCancel(true)
                    .build()

                val notificationManager = context.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
                notificationManager.notify(System.currentTimeMillis().toInt(), notification)
            }
        }
    }
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\utils\UriUtils.kt ===

package com.aiden3630.presentation.utils

import android.content.Context
import android.net.Uri
import androidx.core.content.FileProvider
import java.io.File
import java.text.SimpleDateFormat
import java.util.Date
import java.util.Locale

fun Context.createImageFile(): Uri {
    val timeStamp = SimpleDateFormat("yyyyMMdd_HHmmss", Locale.getDefault()).format(Date())
    val imageFileName = "JPEG_" + timeStamp + "_"
    val image = File.createTempFile(
        imageFileName,
        ".jpg",
        externalCacheDir
    )
    return FileProvider.getUriForFile(
        this,
        "${packageName}.provider",
        image
    )
}


// === FILE: \presentation\src\main\java\com\aiden3630\presentation\Route.kt ===

package com.aiden3630.presentation

object Route {
    const val SPLASH = "splash"
    const val SIGN_IN = "sign_in"
    const val SIGN_UP = "sign_up"
    const val CREATE_PASSWORD = "create_password"
    const val CREATE_PIN = "create_pin"

    const val SIGN_IN_PIN = "sign_in_pin"
    const val HOME = "home"

    const val HOME_TAB = "home_tab"
    const val FAVORITE_TAB = "favorite_tab"
    const val CART = "cart_tab"
    const val PROFILE_TAB = "profile_tab"
    const val CATALOG_TAB = "catalog_tab"
    const val PROJECTS_TAB = "projects_tab"
    const val CREATE_PROJECT = "create_project"
    const val PROJECT_DETAILS = "project_details/{projectId}"
}


// === FILE: \presentation\build.gradle.kts ===


plugins {
    alias(libs.plugins.android.library)
    alias(libs.plugins.kotlin.android)
    alias(libs.plugins.compose.compiler) // рџ‘€ 1. РџР›РђР“РРќ РљРћРњРџРР›РЇРўРћР Рђ
    alias(libs.plugins.google.devtools.ksp)
}

android {
    namespace = "com.aiden3630.presentation"
    compileSdk = 35

    defaultConfig {
        minSdk = 33
        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
    }

    // рџ‘‡ 2. Р’РљР›Р®Р§Р•РќРР• Р¤РЈРќРљР¦РР COMPOSE
    buildFeatures {
        compose = true
    }

    // рџ‘‡ Р­РўРћ РўРћР–Р• Р’РђР–РќРћ (РЅР°СЃС‚СЂРѕР№РєРё Java)
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
    kotlinOptions {
        jvmTarget = "11"
    }
}


dependencies {
    implementation(project(":domain"))
    implementation(project(":data"))

    // 2. Р‘Р°Р·РѕРІС‹Рµ Android Р±РёР±Р»РёРѕС‚РµРєРё
    implementation(libs.androidx.core.ktx)
    implementation(libs.androidx.lifecycle.runtime.ktx)

    // 3. рџ”Ґ COMPOSE (Р’РѕС‚ СЌС‚РѕРіРѕ РЅРµ С…РІР°С‚Р°Р»Рѕ!)
    implementation(platform(libs.androidx.compose.bom))
    implementation(libs.androidx.ui)
    implementation(libs.androidx.ui.graphics)
    implementation(libs.androidx.ui.tooling.preview)
    implementation(libs.androidx.material3) // РўСѓС‚ Р¶РёРІСѓС‚ Text, Button, Column...

    // 4. РќР°РІРёРіР°С†РёСЏ Рё Hilt
    implementation(libs.androidx.navigation.compose)
    implementation(libs.hilt.android)
    implementation(libs.androidx.hilt.navigation.compose)
    ksp(libs.hilt.compiler)
    implementation("io.coil-kt:coil-compose:2.5.0")
    androidTestImplementation(libs.androidx.ui.test.junit4)
    debugImplementation(libs.androidx.ui.test.manifest)
}


// === FILE: \build.gradle.kts ===

// Top-level build file where you can add configuration options common to all sub-projects/modules.
plugins {
    alias(libs.plugins.android.application) apply false
    alias(libs.plugins.kotlin.android) apply false
    alias(libs.plugins.android.library) apply false
    alias(libs.plugins.compose.compiler) apply false
    alias(libs.plugins.jetbrains.kotlin.serialization) apply false
    alias(libs.plugins.google.devtools.ksp) apply false
    alias(libs.plugins.hilt.android) apply false
}


// === FILE: \settings.gradle.kts ===

pluginManagement {
    repositories {
        google {
            content {
                includeGroupByRegex("com\\.android.*")
                includeGroupByRegex("com\\.google.*")
                includeGroupByRegex("androidx.*")
            }
        }
        mavenCentral()
        gradlePluginPortal()
    }
}
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        google()
        mavenCentral()
    }
}

rootProject.name = "Chempionat"
include(":app")
include(":domain")
include(":data")
include(":presentation")
